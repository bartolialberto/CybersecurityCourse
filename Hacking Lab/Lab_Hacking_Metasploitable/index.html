
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://bartolialberto.github.io/CybersecurityCourse/Hacking%20Lab/Lab_Hacking_Metasploitable/">
      
      
        <link rel="prev" href="../../Topics/">
      
      
        <link rel="next" href="../Lab_Virtual_Machines/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.2, mkdocs-material-9.1.5">
    
    
      
        <title>Metasploitable3 Hacking Lab - Cybersecurity Course - University of Trieste</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7a7fce14.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  


  <script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-7FK5GG9NWX"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-7FK5GG9NWX",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-7FK5GG9NWX",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>

  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="orange" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#metasploitable3-hacking-lab" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="https://bartoli.inginf.units.it" title="Cybersecurity Course - University of Trieste" class="md-header__button md-logo" aria-label="Cybersecurity Course - University of Trieste" data-md-component="logo">
      
  <img src="../../bernabeu small.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Cybersecurity Course - University of Trieste
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Metasploitable3 Hacking Lab
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://bartoli.inginf.units.it" title="Cybersecurity Course - University of Trieste" class="md-nav__button md-logo" aria-label="Cybersecurity Course - University of Trieste" data-md-component="logo">
      
  <img src="../../bernabeu small.png" alt="logo">

    </a>
    Cybersecurity Course - University of Trieste
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Topics/" class="md-nav__link">
        Topics
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          1 - Hacking Lab
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          1 - Hacking Lab
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Metasploitable3 Hacking Lab
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Metasploitable3 Hacking Lab
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#preliminaries" class="md-nav__link">
    Preliminaries
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#our-attack-tools" class="md-nav__link">
    Our Attack Tools
  </a>
  
    <nav class="md-nav" aria-label="Our Attack Tools">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#metasploit" class="md-nav__link">
    Metasploit
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#meterpreter" class="md-nav__link">
    Meterpreter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#very-brief-example" class="md-nav__link">
    Very brief example
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-references" class="md-nav__link">
    Key references
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#attacking-metasploitable3" class="md-nav__link">
    Attacking metasploitable3
  </a>
  
    <nav class="md-nav" aria-label="Attacking metasploitable3">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#preliminaries_1" class="md-nav__link">
    Preliminaries
  </a>
  
    <nav class="md-nav" aria-label="Preliminaries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-to-use-tutorials" class="md-nav__link">
    How to use tutorials
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metasploitable3-vulnerabilities" class="md-nav__link">
    Metasploitable3 vulnerabilities
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enumeration" class="md-nav__link">
    Enumeration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#smb-exploitation-eternalblue" class="md-nav__link">
    SMB Exploitation (EternalBlue)
  </a>
  
    <nav class="md-nav" aria-label="SMB Exploitation (EternalBlue)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#understand-process-structure" class="md-nav__link">
    Understand process structure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#suggestions" class="md-nav__link">
    Suggestions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#online-password-guessing" class="md-nav__link">
    Online password guessing
  </a>
  
    <nav class="md-nav" aria-label="Online password guessing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ssh" class="md-nav__link">
    SSH
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql" class="md-nav__link">
    MySQL
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#password-stealing" class="md-nav__link">
    Password stealing
  </a>
  
    <nav class="md-nav" aria-label="Password stealing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#windows" class="md-nav__link">
    Windows
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql_1" class="md-nav__link">
    MySQL
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#offline-password-guessing" class="md-nav__link">
    Offline password guessing
  </a>
  
    <nav class="md-nav" aria-label="Offline password guessing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-to-use-the-obtained-passwords" class="md-nav__link">
    How to use the obtained passwords
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pass-the-hash" class="md-nav__link">
    Pass-the-hash
  </a>
  
    <nav class="md-nav" aria-label="Pass-the-hash">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#important-remark-on-windows-password-hashes" class="md-nav__link">
    Important remark on Windows password hashes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Lab_Virtual_Machines/" class="md-nav__link">
        Metasploitable3 Hacking Lab - Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Vulnerable%20Platforms/" class="md-nav__link">
        Vulnerable Platforms
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          2 - Access Control
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          2 - Access Control
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Access%20Control/Resources%20-%20Access%20Control/" class="md-nav__link">
        Access Control - Resources
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          3 - MITRE ATT&CK
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          3 - MITRE ATT&CK
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../MITRE%20ATTACK/ATTACK%20-%20MITRE/" class="md-nav__link">
        MITRE ATT&CK
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../MITRE%20ATTACK/ICS/" class="md-nav__link">
        ICS - Industrial Control Systems
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          4 - Malware
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          4 - Malware
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Malware/Execution%20and%20other%20tactics/" class="md-nav__link">
        Execution and Other Tactics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Malware/Initial%20Access%20Advanced/" class="md-nav__link">
        Initial Access - Advanced Techniques
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Malware/Initial%20Access/" class="md-nav__link">
        Initial Access
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Malware/Malware%20detection/" class="md-nav__link">
        Malware detection
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Malware/Malware_Case_Studies/" class="md-nav__link">
        Intrusions and Malware - Case studies
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
      
      
      
        <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
          5 - Passwords
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          5 - Passwords
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Passwords/Passwords/" class="md-nav__link">
        Passwords
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
      
      
      
        <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
          6 - Authentication - NTLM Kerberos
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          6 - Authentication - NTLM Kerberos
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Authentication%20-%20NTLM%20Kerberos/Authentication%20-%20Windows/" class="md-nav__link">
        Authentication - Windows
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Authentication%20-%20NTLM%20Kerberos/Kerberos/" class="md-nav__link">
        Kerberos
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Authentication%20-%20NTLM%20Kerberos/NTLM/" class="md-nav__link">
        NTLM
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
      
      
      
        <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
          7 - Lateral Movement and AD Abuse
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          7 - Lateral Movement and AD Abuse
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Lateral%20Movement%20and%20AD%20Abuse/AD_abuse/" class="md-nav__link">
        AD Abuse
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Lateral%20Movement%20and%20AD%20Abuse/Discovery/" class="md-nav__link">
        Discovery
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Lateral%20Movement%20and%20AD%20Abuse/Lateral%20Movement/" class="md-nav__link">
        Lateral Movement
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
      
      
      
        <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
          8 - MFA
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          8 - MFA
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../MFA/MFA/" class="md-nav__link">
        Multifactor Authentication (MFA)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
      
      
      
        <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
          9 - Memory Corruption
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_11">
          <span class="md-nav__icon md-icon"></span>
          9 - Memory Corruption
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Memory%20Corruption/Memory%20Corruption%20-%20Case%20studies/" class="md-nav__link">
        Memory corruption - Case studies
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Memory%20Corruption/Resources%20-%20Memory%20corruption_/" class="md-nav__link">
        Memory Corruption
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12" >
      
      
      
        <label class="md-nav__link" for="__nav_12" id="__nav_12_label" tabindex="0">
          10 - Vulnerabilities
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_12">
          <span class="md-nav__icon md-icon"></span>
          10 - Vulnerabilities
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Vulnerabilities/Resources%20-%20Vulnerabilities%20Intro/" class="md-nav__link">
        Vulnerabilities Introduction - Resources
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Vulnerabilities/Resources%20-%20Vulnerability%20Management/" class="md-nav__link">
        Vulnerability Management - Resources
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Vulnerabilities/Vulnerability%20-%20Case%20studies/" class="md-nav__link">
        Vulnerabilities - Case Studies
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13" >
      
      
      
        <label class="md-nav__link" for="__nav_13" id="__nav_13_label" tabindex="0">
          11 - Defense
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_13_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_13">
          <span class="md-nav__icon md-icon"></span>
          11 - Defense
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Defense/Defense%20-%20Resources/" class="md-nav__link">
        Defense - Resources
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_14" >
      
      
      
        <label class="md-nav__link" for="__nav_14" id="__nav_14_label" tabindex="0">
          Labs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_14_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_14">
          <span class="md-nav__icon md-icon"></span>
          Labs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Labs/Automated%20Malware%20Analysis/" class="md-nav__link">
        Automated Malware Analysis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Labs/BURP/" class="md-nav__link">
        BURP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Labs/MITRE_ATTACK_Navigator/" class="md-nav__link">
        MITRE ATT&CK NAVIGATOR.
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Labs/OWASP%20Juice%20Shop/" class="md-nav__link">
        OWASP Juice Shop
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../docsify/" class="md-nav__link">
        Report (Docsify-This)
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#preliminaries" class="md-nav__link">
    Preliminaries
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#our-attack-tools" class="md-nav__link">
    Our Attack Tools
  </a>
  
    <nav class="md-nav" aria-label="Our Attack Tools">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#metasploit" class="md-nav__link">
    Metasploit
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#meterpreter" class="md-nav__link">
    Meterpreter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#very-brief-example" class="md-nav__link">
    Very brief example
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-references" class="md-nav__link">
    Key references
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#attacking-metasploitable3" class="md-nav__link">
    Attacking metasploitable3
  </a>
  
    <nav class="md-nav" aria-label="Attacking metasploitable3">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#preliminaries_1" class="md-nav__link">
    Preliminaries
  </a>
  
    <nav class="md-nav" aria-label="Preliminaries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-to-use-tutorials" class="md-nav__link">
    How to use tutorials
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metasploitable3-vulnerabilities" class="md-nav__link">
    Metasploitable3 vulnerabilities
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enumeration" class="md-nav__link">
    Enumeration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#smb-exploitation-eternalblue" class="md-nav__link">
    SMB Exploitation (EternalBlue)
  </a>
  
    <nav class="md-nav" aria-label="SMB Exploitation (EternalBlue)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#understand-process-structure" class="md-nav__link">
    Understand process structure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#suggestions" class="md-nav__link">
    Suggestions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#online-password-guessing" class="md-nav__link">
    Online password guessing
  </a>
  
    <nav class="md-nav" aria-label="Online password guessing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ssh" class="md-nav__link">
    SSH
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql" class="md-nav__link">
    MySQL
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#password-stealing" class="md-nav__link">
    Password stealing
  </a>
  
    <nav class="md-nav" aria-label="Password stealing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#windows" class="md-nav__link">
    Windows
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysql_1" class="md-nav__link">
    MySQL
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#offline-password-guessing" class="md-nav__link">
    Offline password guessing
  </a>
  
    <nav class="md-nav" aria-label="Offline password guessing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-to-use-the-obtained-passwords" class="md-nav__link">
    How to use the obtained passwords
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pass-the-hash" class="md-nav__link">
    Pass-the-hash
  </a>
  
    <nav class="md-nav" aria-label="Pass-the-hash">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#important-remark-on-windows-password-hashes" class="md-nav__link">
    Important remark on Windows password hashes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="metasploitable3-hacking-lab">Metasploitable3 Hacking Lab</h1>
<p>This page is best understood after having attended the accompanying lecture.</p>
<h2 id="preliminaries">Preliminaries</h2>
<p>For executing the suggested activities you need:</p>
<ol>
<li>VirtualBox (or another hypervisor) installed.</li>
<li>Some minimal (really minimal) familiarity with virtual machines and VirtualBox usage.</li>
<li>Two VMs installed, one acting as attacked machine (metasploitable3) and the other acting as attacker machine (Kali Linux). </li>
</ol>
<p><a href="../Lab_Virtual_Machines/">This accompanying page</a> describes the required installation steps.</p>
<h2 id="our-attack-tools">Our Attack Tools</h2>
<h3 id="metasploit">Metasploit</h3>
<p>The main tool for attacking metasploitable3 is <em>metasploit</em>. This is a professional tool structured as a modular framework. There are a a number of <em>modules</em> available, each specialized for executing a specific attack to a specific software. Metasploit is a very powerful and complex tool. This document is based on a tiny subset of its capabilities.</p>
<p>There are several ways for using metasploit, the most common one being a command-line interface.</p>
<p>Broadly speaking, one should:</p>
<ol>
<li>Specify the <em>module</em> or the <em>exploit</em> to be used. This is done by typing a sort of path name for the module.</li>
<li>Set every option of the module that is not set by default or whose default value is not appropriate. This is done by executing the <code>set option-name</code> command as many times as needed. For example, in most cases considered in this document, it is necessary to execute <code>set rhosts IP-address-target</code>.</li>
<li>Run the module. This is done by typing <code>run</code> or <code>exploit</code>, depending on the specific module being used.</li>
</ol>
<h3 id="meterpreter">Meterpreter</h3>
<p>Metasploit contains a remote shell software called <em>meterpreter</em>.</p>
<p>The default payload of many metasploit exploits is a meterpreter server. If the exploit injection succeeds, there will be a meterpreter session between the attacker machine and the attacked machine, that is:</p>
<ul>
<li>a meterpreter client running within metasploit, on the attacker machine; it is a shell client connected to the meterpreter server;</li>
<li>a meterpreter server running on the attacked machine and launched with the exploit; it is a shell server;</li>
</ul>
<p>As a result, the attacker will be able to execute many powerful operations on the attacked machine with a simple command-line interface. The set of commands available with meterpreter are described in the documentation (see "Useful links" below).</p>
<p>Meterpreter is a very sophisticated tool. Just to mention a few of its features (not discussed in this document):</p>
<ul>
<li>Communication between client and server may occur over several different transport protocols (http, https, tls).</li>
<li>The meterpreter server side usually is not run as a separate process. It is instead executed in the context of an existing process, by overwriting its memory. This fact makes its detection by defenders more difficult than, e.g., when spawning a shell (i.e., a new process).</li>
<li>The meterpreter server can be migrated from the process where it is being executed to another process in execution on the target machine.</li>
</ul>
<h3 id="very-brief-example">Very brief example</h3>
<p>The following screenshot shows:</p>
<ol>
<li>Launch metasploitn in command-line mode (<code>msfconsole -q</code>).</li>
<li>Select a specific exploit for the elasticsearch server (<code>use</code>).</li>
<li>Set the rhosts option, for targeting the metasploitable3 VM.</li>
<li>Run the exploit. Since the payload has not been specified the default one will be used, i.e., a meterpreter server.</li>
<li>Injection is successful and a meterpreter session is open (presence of the <code>meterpreter &gt;</code> prompt).</li>
<li>Execute the meterpreter <code>shell</code> command for launching a shell on the attacked machine (this spawns a new process on that machine; as observed above, launching a shell is usually not necessary, one could obtain more or less the same functionality by executing only meterpreter commands). Interaction with this shell is not shown in the figure.</li>
</ol>
<p><img alt="56e15719c4544f58d133d9edc23c0ca5.png" src="../../_resources/56e15719c4544f58d133d9edc23c0ca5-1.png" /></p>
<h3 id="key-references">Key references</h3>
<ul>
<li><a href="https://www.offensive-security.com/metasploit-unleashed/metasploit-fundamentals/">Metasploit full guide</a></li>
<li><a href="https://www.infosecmatter.com/metasploit-module-library/">Metasploit module library</a></li>
<li><a href="https://www.offensive-security.com/metasploit-unleashed/meterpreter-basics/">Meterpreter basic commands</a></li>
</ul>
<h2 id="attacking-metasploitable3">Attacking metasploitable3</h2>
<h3 id="preliminaries_1">Preliminaries</h3>
<h4 id="how-to-use-tutorials">How to use tutorials</h4>
<p>Many pages on the web provide forms of walkthrough or tutorials or solutions to one or more of the vulnerabilities in metasploitable3. Although such pages may be useful for learning purposes, they are hardly useful for understanding and generalizing. They typically consist of a long sequence of “use this tool with those options” steps. As a consequence, one may succeed in exploiting that specific vulnerability in that specific case, but without understanding why that approach works, whether other approaches would work as well, whether that approach may be applied to other scenarios and so on.</p>
<p>My suggestion is to look at tutorials only for having a general idea of what should be done. One should then try to proceed autonomously, of course, with frequent interactions with search engines for finding examples of usage of the numerous hacking tools available.</p>
<p>The indications below suggest attacks that could be useful for a beginner. Such indications do not take the form of a detailed, precise sequence of steps. They provide instead some general indications, sometimes with a few potentially useful links. One should understand autonomously what to do, by using search engines and, most importantly, by taking personal notes of what has been done, what worked, what did not work.</p>
<h4 id="metasploitable3-vulnerabilities">Metasploitable3 vulnerabilities</h4>
<p>Vulnerabilities of metasploitable3 are listed in <a href="https://github.com/rapid7/metasploitable3/wiki/Vulnerabilities">this Github page</a>. The listing is very synthetic: it does not provide sufficient information for understanding the nature of a vulnerability, nor does it provide any indications for exploiting it.</p>
<p>Many vulnerabilities are due to insecure default configuration of servers or to weak passwords.</p>
<p>The credentials of (almost) all Windows users defined in metasploitable3 are provided in <a href="https://github.com/rapid7/metasploitable3/wiki/Configuration#credentials">this Github page</a>. These credentials may or may not be valid for accessing a given service of metasploitable3. For example, the SMB file-sharing service is accessed with credentials of Windows users while web servers or database servers usually are based on users and credentials stored and managed separately from those of Windows.</p>
<p>Of course, one should pretend that credentials are <em>not</em> known. My suggestion is using this knowledge only as follows:</p>
<ul>
<li>When executing a password guessing attack, have a look at those credentials to have an idea of how long the attack might take (of course, in a real attack such an indication would not be available). You might want to prepare a dictionary containing the credentials that are known to be valid (again, in a real attack this knowledge in not available) and one of the dictionaries available in Kali Linux (see the <a href="https://www.kali.org/tools/wordlists/">wordlists </a>package).</li>
<li>If logging on the Windows VM were necessary for some reason, then use the credentials of the <code>vagrant</code> user (password <code>vagrant</code>);</li>
</ul>
<h3 id="enumeration">Enumeration</h3>
<p>The very first steps are as follows:</p>
<ol>
<li>Finding the IP address of the target machine.</li>
<li>Listing the servers (i.e., port numbers and protocols) that can be accessed and attacked. </li>
</ol>
<p>One of the ways these steps may be executed is with the <code>nmap</code> command. The information obtained with these steps is necessary for the attacks described in the next sections.</p>
<p>These steps are usually called "enumeration" (the MITRE ATT&amp;CK framework discussed later in this course uses a different term for the corresponding tactic, i.e., "discovery").</p>
<p>Suggestions:</p>
<ul>
<li>First of all you need to find the IP address and network number of your Kali machine (<code>ifconfig</code> command).</li>
<li>Then you need to determine which other hosts are connected to your network. This can be done with <code>nmap network-number-of-your-interface</code> (with /24 syntax). You will probably find 3 IP addresses: one for your Kali machine; one for the target (metasploitable3 VM) and the third one for what?</li>
<li>How to determine which of the two addresses that do not belong to your Kali machine belongs to the target? (hints: which ports are open at those addresses?)</li>
<li>Finally, execute a scan on IP-address-target by running <code>nmap</code>  with default options.</li>
</ul>
<p>Further suggestions: </p>
<ul>
<li>Execute another scan with <code>nmap -sV -p- IP-address-target</code>. This command takes much longer and generates much more network traffic but provides a more detailed description. Try to understand the difference in depth and coverage of the scan between the two cases.</li>
<li>Metasploitable3 has a vulnerable service listening on ports 9200/9300. Is that service detected by <code>nmap</code> in both executions? If yes, is it identified correctly (search on the web what is the typical usage for those ports)?</li>
<li>Capture the traffic generated by nmap with default options by running wireshark on the attacking machine. This is useful for understanding the amount of “noise” that could be detected by a defender.</li>
</ul>
<p>Useful link: <a href="https://www.redhat.com/sysadmin/quick-nmap-inventory">Running a quick NMAP scan to inventory my network</a>.</p>
<h3 id="smb-exploitation-eternalblue">SMB Exploitation (EternalBlue)</h3>
<p><a href="https://en.wikipedia.org/wiki/Server_Message_Block">SMB </a>is a communication protocol for sharing files and printers. A service that can be accessed with this protocol runs on basically all Windows systems. It exposes functionalities for accessing files, navigating through directories and alike (e.g., search “<a href="https://www.google.com/search?client=opera&amp;q=smb+commands+window">smb commands windows</a>”). As such, this service does <em>not</em> expose any functionality for executing arbitrary commands, launching a shell, managing users or devices and alike.</p>
<p>Vulnerability <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=cve-2017-0144">CVE-2017-0144</a> affects the Windows SMB server. This vulnerability can be exploited by an unauthenticated remote attacker for executing arbitrary code on the machine running the server (see also <a href="https://learn.microsoft.com/en-us/security-updates/securitybulletins/2017/ms17-010">Microsoft Security Bulletin MS17-010</a>).</p>
<p>An exploit for this vulnerability, developed by the NSA and secretly used for their attacks, was publicly released on 17/4/2017 by "<a href="https://en.wikipedia.org/wiki/The_Shadow_Brokers">The Shadow Brokers</a>", a hacking group whose real identities are not known. This exploit is widely known as “EternalBlue'' and was used in several large scale ransomware attacks a few months later (<a href="https://en.wikipedia.org/wiki/WannaCry_ransomware_attack">WannaCry</a> / <a href="https://en.wikipedia.org/wiki/Petya_and_NotPetya">NotPetya</a>). Interestingly, a patch for this vulnerability had already been made available by Microsoft at the time of those disrupting attacks. One of the reasons for the large-scale impact of those attacks is that hundreds of thousands of machines around the world had not applied the patch (<a href="https://bartoli-alberto.blogspot.com/2017/05/osservazione-sul-worm-wannacry.html">a few notes</a> by myself on this fact).</p>
<p>The metasploitable3 Windows VM has this vulnerability (no longer present in modern Windows platforms). Metasploit has a module containing an exploit for that vulnerability, where the default payload launches a Metepreter session with SYSTEM privilege (i.e., a shell with full control on the attacked system).</p>
<h4 id="understand-process-structure">Understand process structure</h4>
<p>The exploit payload is the meterpreter server. This payload is injected within the memory of the vulnerable program (SMB server). After injection, thus, the meterpreter client will be connected to the same process that runs the SMB server. No new process is created.</p>
<p>The meterpreter commands issued by the client machine will be executed by the vulnerable process at the other side, i.e., on the attacked machine. The operating system on the attacked machine will execute only those commands for which the vulnerable process has sufficient access rights. Since that process is associated with the <code>SYSTEM</code> identity, that process has the highest privilege level possible and thus every command can be executed.</p>
<p>One of the possible meterpreter commands is <code>shell</code>, which spawns a shell on the attacked machine. In this case a new process is created. The identity of that process is the same as the identity of its parent process (i.e., of the vulnerable process). Thus, the shell process will also have the SYSTEM identity.</p>
<p>One of the possible meterpreter commands is <code>migrate</code>, which move the meterpreter server within the memory of another running process on the attacked machine. In this case, the identity of the meterpreter server after migration will be that of the "destination process".</p>
<h4 id="suggestions">Suggestions</h4>
<p>Suggestions: </p>
<ul>
<li>Execute the metasploit <code>search</code> command of metasploit to have a look at the exploits available and possibly focus on those available for Windows targets.</li>
<li>Use the exploit <a href="https://www.infosecmatter.com/metasploit-module-library/?mm=exploit/windows/smb/ms17_010_eternalblue">exploit/windows/smb/ms17_010_eternalblue</a> for obtaining a meterpreter session on metasploitable3.</li>
<li>Ascertain the user associated with that session (meterpreter <code>getuid</code> command).</li>
<li>Take a moment to realize what has happened: by exploiting a mistake in a service for accessing files and printers, one has taken full control of the attacked machine.</li>
</ul>
<p>Then you can operate <em>on metasploitable3</em> by playing with meterpreter <em>from the attacker machine</em>. Some suggestions:</p>
<ul>
<li>Have a look at which files might have interesting content (<code>search -f *.pdf</code>  or <code>jpg</code> or whatever). Search may be rooted at a specified directory with the <code>-d</code> option.</li>
<li>Grab a screen of the desktop. To do so, there must be a user logged on metasploitable3, otherwise the screenshot will be fully black (no desktop); you might want to logon some user on metasploitable3, e.g., user <code>vagrant</code> with password <code>vagrant</code>. Details for grabbing the screenshot are described <a href="https://www.offensive-security.com/metasploit-unleashed/screen-capture/">here</a>: try to understand what you are doing and why.</li>
<li>Have a look at the event logs in metasploitable3. You need to logon on metasploitable3 as user <code>vagrant\vagrant</code> and then run the Windows “event viewer” (i.e., not from the attacker machine). Understanding the meaning of those "low-level" events and mapping them to "high-level" activities to them is very difficult (we will touch this topic very briefly near the end of this course). Just have a look and see that there are many events. Then execute the meterpreter <code>clearev</code> command and look at the event logs again. Try to imagine the implications.</li>
<li>Launch a shell on metasploitable3 with the meterpreter <code>shell</code> command and then execute some commands.</li>
</ul>
<p>Interesting commands to run from a meterpreter shell (the following suggestions require some simple web searches, or ChatGPT interactions, for figuring out the necessary details):</p>
<ul>
<li>Create a new user (search in the web for “windows create user command line” or ask ChatGPT with a suitable prompt, as indicated in the <a href="../../">index page</a>)</li>
<li>Assign administrator privilege to that user (search in the web for “windows modify user and account privileges command line” or ask ChatGPT)</li>
</ul>
<p>Note that the newly created user will be visible on the logon screen of metasploitable3. If one wants to keep the newly created user hidden (in that screen), then a certain system attribute of that user should be modified. This is possible but not trivial, I do not think it is interesting in this context. It may be more interesting to identify the corresponding events that have been generated in the Security log of metasploitable3 and then clearing the log as suggested above.</p>
<h3 id="online-password-guessing">Online password guessing</h3>
<p>There are many tools for executing an <em>online</em> password guessing attack, including <code>nmap</code>, <code>metasploit</code>, <code>Hydra</code> (all of them already installed in Kali). A tool of this kind must be able to execute the authentication exchange of the specific protocol considered and the tools mentioned above support many protocols. In general, one has to specify a list of users and a list of passwords as inputs. There are many such lists available and many possible ways for constructing them. Note that many web pages (somewhat improperly) use the term “brute force” for describing this kind of guessing attacks.</p>
<p>One could use some of the many wordlists available on Kali Linux (see the <a href="https://www.kali.org/tools/wordlists/">wordlists</a> package), but those attacks would take a very long time. For simplicity, I suggest to proceed as follows:</p>
<ul>
<li>Use the Kali <code>cewl</code> command for constructing a new wordlist from the content of the metasploitable3 configuration page:
<code>cewl -d 0 -w metasploitable3.txt https://github.com/rapid7/metasploitable3/wiki/Configuration</code> (option <code>-d 0</code> states that hyperlinks should not be followed)</li>
<li>Construct a much smaller wordlist (<code>metasploitable3-short.txt</code>) containing:<ul>
<li><code>vagrant</code>, <code>root</code>, <code>administrator</code>, <code>Administrator</code></li>
<li>5-10 words taken from <code>metasploitable3.txt</code> constructed as above.</li>
</ul>
</li>
<li>Use <code>metasploitable3-short.txt</code> in the attacks suggested below. This wordlist can be used as a user list or a password list, or both. </li>
</ul>
<p>In a real setting one could reasonably use <code>cewl</code> as indicated above for creating <code>metasploitable3.txt</code>. The step for shrinking this wordlist and obtaining <code>metasploitable3-short.txt</code> is obviously not realistic, though.</p>
<p>Useful link: <a href="https://www.hackingarticles.in/a-detailed-guide-on-hydra/">Detailed guide on Hydra</a>.</p>
<h4 id="ssh">SSH</h4>
<p>The SSH service is an attractive target for password guessing attacks because a success would provide a remote shell (whose level of privilege will depend on the privilege of the user whose credentials have been found).</p>
<p>Metasploitable3 has weak credentials for this service (of course, in a real setting this knowledge is not available).</p>
<p>Suggestions: </p>
<ul>
<li>Try to see whether the metasploitable3 SSH service is vulnerable to the exploit <a href="https://www.infosecmatter.com/metasploit-module-library/?mm=auxiliary/scanner/ssh/ssh_enumusers">auxiliary/scanner/ssh/ssh_enumusers</a>. This exploit takes a list of users as input and tells which of those users is a valid username for the targeted service.</li>
<li>If the above exploit succeeds, use the corresponding user list with the password list obtained in a previous section for executing a guessing attack. Such an attack may be executed either with Hydra or with metasploit (<a href="https://www.infosecmatter.com/metasploit-module-library/?mm=auxiliary/scanner/ssh/ssh_login">auxiiary/scanner/ssh/ssh_login</a>).</li>
<li>Always make sure to set the necessary options for checking whether a null password works.</li>
<li>If you manage to find valid credentials, you may connect to the SSH service with any SSH client or with the metasploit <a href="https://www.infosecmatter.com/metasploit-module-library/?mm=auxiliary/scanner/ssh/ssh_login">auxiiary/scanner/ssh/ssh_login</a> module, by setting the options username and password.</li>
</ul>
<p>SSH is often configured with <em>public key client authentication</em>. With this configuration, a SSH client must prove knowledge of a password <em>and</em> of a certain private key; the SSH server must know the matching public key of that client.
The mechanism is conceptually identical to TLS with mutual authentication (a topic no longer studied in "Computer Networks"): in the default TLS configuration, it is the server that proves knowledge of a private key; in the mutual TLS configuration, instead, each of the two sides prove knowledge of the respective private key to the other side.</p>
<p>SSH in metasploitable3 is not configured this way, thus obtaining a client password suffices for impersonating that client. Note that a guessing attack for obtaining the private key of a client is not meaningful (why?).</p>
<p>Useful link: <a href="https://www.hostinger.com/tutorials/ssh-tutorial-how-does-ssh-work">What Is SSH: Understanding Encryption, Ports and Connection</a>.</p>
<h4 id="mysql">MySQL</h4>
<p>The MySQL service is an attractive target for password guessing attacks, because a success would provide access to the corresponding databases. The content of those databases may often be very valuable to the attacker.</p>
<p>Furthermore, the content of a MySQL database is often useful for executing further attack steps. The reason is because services that store and manage credentials independent of the store of the operating system, often store their credentials in a database. This is usually the case of web applications, for example. A MySQL database, thus, often contain credentials of some other services running on the same machine as the MySQL server (section <a href="#password-stealing">Password Stealing</a>, MySQL). </p>
<p>Metasploitable3 has weak credentials for the MySQL service (of course, in a real setting this knowledge is not available).</p>
<p>Suggestions: </p>
<ul>
<li>Try to find credentials with Hydra or with metasploit (<a href="https://www.infosecmatter.com/metasploit-module-library/?mm=auxiliary/scanner/mysql/mysql_login">auxiliary/scanner/msysql/mysql_login</a>). Use <code>metasploitable3-short.txt</code> as user list and password list. Make sure to set the necessary options for checking whether a null password works.</li>
<li>If you manage to find valid credentials, you may connect to the MySQL service with any MySQL client (search the web for “kali mysql client”).</li>
</ul>
<h3 id="password-stealing">Password stealing</h3>
<h4 id="windows">Windows</h4>
<p>Credentials of all Windows users are stored in a portion of secondary storage called SAM (Security Account Manager). Passwords are stored in <em>hashed</em> form. The SAM usually contains two different hashes for each password, one of them for compatibility reasons not discussed here. The SAM content may be read (i.e., password hashes may be stolen) by specialized programs executed on the target machine under an identity with SYSTEM privilege. Several such programs exist.</p>
<p>Password hashes may be used for:</p>
<ul>
<li>Trying to obtain the corresponding password (<em>offline guessing</em>, also improperly called “brute force”, section <a href="#offline-password-guessing">Offline Password Guessing</a> ).</li>
<li>Impersonating the corresponding users <em>even without figuring out the respective passwords</em> (the so-called <em>pass the hash</em> attack that can be executed on Windows machines, section <a href="#pass-the-hash">Pass-the-Hash</a> ).</li>
</ul>
<p>Suggestions:</p>
<ul>
<li>Having obtained a meterpreter session as described in section <a href="#smb-exploitation-eternalblue">SMB Exploitation (EternalBlue)</a>, dump the SAM content with the meterpreter command <code>hashdump</code> and store its output in a text file on the attacking machine.</li>
</ul>
<h4 id="mysql_1">MySQL</h4>
<p>Services often manage accounts and credentials independently of the underlying operating system, i.e., Windows. The corresponding information must be stored in some secondary storage, usually on a database. This is usually the case of web applications, for example. A MySQL database, thus, often contain credentials of some other services running on the same machine as the MySQL server.</p>
<p>The target machine has a MySQL service running. This database could store such credentials (hint: it does store Wordpress credentials; Wordpress is an open source content management system widely used for building web sites).</p>
<p>Suggestions:</p>
<ul>
<li>Having obtained MySQL credentials as described in section <a href="#mysql-password-guessing">MySQL password guessing</a>, try to determine whether any such credentials have admin privilege on MySQL. Then, use those credentials for:<ul>
<li>Listing the databases on the MySQL service and see whether there is anyone that could contain credentials of some service.</li>
<li>Listing the tables of that database and see which one could contain credentials.</li>
<li>Inspect the schema of that table and prepare a SQL query for extracting the relevant columns.</li>
<li>Execute that query and store its output in a text file on the attacking machine.</li>
</ul>
</li>
</ul>
<p>Useful links:
- <a href="https://infosecwriteups.com/pwning-wordpress-passwords-2caf12216956">Pwning WordPress Passwords</a> (see first part)
- <a href="https://tremblinguterus.blogspot.com/2020/11/metasploitable-3-windows-walkthrough_87.html">Metasploitable 3 Windows Walkthrough: Part VI</a> (see second part).</p>
<h3 id="offline-password-guessing">Offline password guessing</h3>
<p>Offline password guessing is an attack that, given a password hash, attempts to obtain the corresponding password. Since hash functions are designed to be not invertible (an output value does not provide any information about the corresponding input), such attacks work by computing the hash of each password in an input password list until finding a value identical to the hash available. Of course, success of the attack depends on whether the password to be found is in the input password list and on the amount of computing resources available.</p>
<p>This guessing attack is called “offline” because during its execution there is no communication at all with the service where the targeted credentials are used.</p>
<p>Suggestions: </p>
<ul>
<li>Take the credentials extracted from MySQL in the previous section.</li>
<li>Execute the Kali command <code>hash-identifier</code> on one of the hashes in order to have an indication of the hash function used, i.e., of the program that could have originated that hash (we already have such information: Wordpress).</li>
<li>Use the password list constructed in section <a href="#online-password-guessing">Online password guessing</a> for executing an offline guessing on the Wordpress credentials. Suitable tools are <code>hashcat</code>and john the ripper (command <code>john</code>). In less than half an hour you should recover some password (in a real setting you would not know in advance whether the attack will succeed and how much time will be needed).</li>
</ul>
<p>The very same steps could be executed for an offline guessing attack on the Windows credentials extracted from the SAM.
However, the hash of a Windows password suffices for impersonating the corresponding user, even without knowing the password (see also  section <a href="#pass-the-hash">Pass the hash (pth)</a> ).</p>
<p>When using a tool for offline guessing keep in mind:
- The input file containing the hashes must be structured as required by the tool (<code>hashcat</code> expects to receive only the hashes, <code>john</code> can receive a SAM line with the suitable input option).
- The correct hash format is specified in input. 
- Usage of both <code>hashcat</code> and <code>john</code> is quite complex (e.g., <code>john</code> maintains a hidden cache of recently cracked hashes, so in repeated executions those hashes are not cracked again; and, a VM might not have enough memory to run hashcat).</p>
<h5 id="how-to-use-the-obtained-passwords">How to use the obtained passwords</h5>
<p>Assuming you obtained some wordpress credentials:</p>
<ol>
<li>Launch a browser and point it to http://IP-address-target:8585/wordpress (a website created with wordpress is usually available on the standard ports, i.e., 80/443; in metasploitable3 it has instead been configured to be available on port 8585 at that URL).</li>
<li>Try to find the login page.</li>
<li>Try to use one of the recovered credentials for becoming the admin of the web site.</li>
</ol>
<h3 id="pass-the-hash">Pass-the-hash</h3>
<p>Pass-the-hash is an attack in which an attacker impersonates a user against a Windows service by using only the password hash of that user (i.e., <em>without knowing the password</em> from which that hash was obtained).
 This topic will be studied in depth later in this course. In a nutshell:</p>
<ul>
<li>Windows uses several authentication protocols, including one called NTLMv2 that exists in all Windows versions.</li>
<li>NTLMv2 is such that the client must prove knowledge of the hash of a user password.</li>
<li>A “legitimate” client software designed for Windows takes a password as input, computes its hash and then executes NTLMv2 when needed. Thus, knowledge of a password hash is not sufficient with this kind of software, because such a software will compute the hash of the password hash before executing NTLMv2.</li>
<li>A client software for executing attacks, instead, takes instead a password hash as input and executes NTLMv2 directly, without computing a further hash of the input. There are many free tools that have been implemented for this purpose, one of them is shown below.</li>
</ul>
<p>Password hashes may be obtained by dumping the content of a SAM, as described in section <a href="#password-stealing">“Password stealing”</a>.</p>
<p>Suggestions: </p>
<ul>
<li>Take the hashes extracted from the SAM as in section <a href="#password-stealing">Password stealing</a>.</li>
<li>Use a command from the <code>win-pth</code> suite available in Kali for executing a command on the targeted machine, by using one of those hashes.</li>
</ul>
<p>Useful link: <a href="https://www.puckiestyle.nl/pass-the-hash/">https://www.puckiestyle.nl/pass-the-hash/</a></p>
<h5 id="important-remark-on-windows-password-hashes">Important remark on Windows password hashes</h5>
<p>There are other ways for obtaining Windows password hashes, i.e., by reading them from the memory of a certain system process called LSASS that contains the password hash of all the users that are currently logged in.</p>
<p>Several tools exist for executing this operation and they have to be executed under an identity with SYSTEM privilege. The one that is most widely known is called <code>mimikatz</code>.</p>
<p><em>This kind of attack may be particularly disruptive in enterprise environments</em>. The reason is because system administrators often execute maintenance operations from a remote location by using credentials with high privilege (which is a very bad practice). If a malicious program with SYSTEM privilege happens to be in execution on the machine where such operations are being executed, that malicious program will steal password hashes of an identity with high privilege; such hash may be typically used on every other machine of the enterprise, again with high privilege.</p>
<p>This simple fact may lead to total compromise of a large organization.</p>


  




                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["search.suggest", "search.highlight", "navigation.instant", "navigation.tracking"], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.407015b8.min.js"></script>
      
    
  </body>
</html>