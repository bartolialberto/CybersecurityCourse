{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Home","text":""},{"location":"#about-this-course","title":"About this Course","text":"<p>Start with this very concise description.</p> <p>The topics are listed in this page.</p> <p>Exam and slides: see my personal website.</p>"},{"location":"#how-to-use-this-website","title":"How to use this website","text":"<p>This website contains a curated set of references.</p> <p>References provide real-world examples, in-depth analysis, technical manuals and the like. They are intended to be a resource for those interested in delving deeper.</p> <p>Please always keep in mind that the content of this website is not needed for the exam: the slides are all that is needed in this respect.</p>"},{"location":"#do-not-be-frustrated","title":"Do not be frustrated","text":"<p>Many of the linked documents can only be fully understood with very specific technical skills (and sometimes theoretical knowledge) far beyond those required or provided by this course. Please try to focus on the topics relevant to the course. Most importantly, do not be frustrated if you do not manage to understand everything.</p> <p>In many cases I do not understand everything either.</p>"},{"location":"#ask-chatgpt","title":"Ask ChatGPT","text":"<p>Many technical documents on the web rely on very specific commands from Linux, Windows, Powershell, PHP, and other technologies. Understanding these commands or their output is often difficult. Asking ChatGPT (or Bard, or a similar technology) for clarification is often a great help.</p> <p>While there is no guarantee that the answer will be correct, in many cases the answer will be very useful (and indeed correct).</p> <p>A prompt technique that often works well is this: \"explain this:\" followed by a copy-and-pasted command, or command output, or piece of code.</p> <p>If you want instead to \"learn\" something, asking broad and general questions is not very useful (e.g. \"how does access control work in Windows?\"). It is usually much better to start general in order to delimit the overall scenario and then be very specific.</p> <ul> <li>Start with something like \"I want to understand Linux administration\", or \"I am a Windows user\", \"I am a Python programmer; I want to write a script that operates on Pandas dataframes\", etc.</li> <li>Then, make a very specific question. For example, \"In Windows, how can I list all users of a given group from the command line?\"</li> </ul> <p>Relying on ChatGPT/Bard for having a quick, approximate understanding of what a command (or even a piece of code) actually does is a strategy used also by a top security company, Mandiant: see Analyzing an Alert for a PowerShell Script (there might be a conflict of interest, though, as Mandiant is part of Google and this post promotes the use of Bard, also a Google service).</p> <p>I have occasionally provided a link to brief explanations provided by ChatGPT/Bard on specific topics, for ease of reading. As just pointed out, there is no guarantee that those explanations are correct: take them just as hints.</p>"},{"location":"Topics/","title":"Topics","text":""},{"location":"Topics/#topics","title":"Topics:","text":""},{"location":"Topics/#hacking","title":"Hacking","text":"<p>Hacking Preamble - Hacking Scenario - Hacking Lab - Attacking an Organization</p>"},{"location":"Topics/#access-control","title":"Access Control","text":"<p>Security Policy - O.S. Protection (in a nutshell) - Principle of Least Privilege - Access Control - O.S. Access Control Essentials - Access Control in Large Organizations - LDAP SSO</p>"},{"location":"Topics/#mitre-attack-ics-individuals","title":"MITRE Attack -  ICS individuals","text":"<p>Attacks - Attacking an Organization - Understanding MITRE ATT&amp;CK - Initial Access - Attacking an ICS</p>"},{"location":"Topics/#malware-basic","title":"Malware - Basic","text":"<p>Malware - Some Basic Malware Techniques - Tactic: Impact - Botnets</p>"},{"location":"Topics/#malware-detection","title":"Malware - Detection","text":"<p>Malware Detection - A quick look at AVs (antiviruses)</p>"},{"location":"Topics/#malware-advanced-initialaccess","title":"Malware - Advanced InitialAccess","text":"<p>Initial Access: Advanced Techniques - Supply Chain Compromise</p>"},{"location":"Topics/#threat-model","title":"Threat Model","text":"<p>Threat Model -  Understanding Threat Models</p>"},{"location":"Topics/#passwords","title":"Passwords","text":"<p>Password Attacks - Guessing Attacks Today - Online Guessing - Passwords: Where and how stored? - AuthDB Stealing (Password cracking)</p>"},{"location":"Topics/#mfa","title":"MFA","text":"<p>2FA (MFA) - OTP: Functionality - Security Key: Functionality - Smartphone Push notifications - Passwordless Login (Passkey)</p>"},{"location":"Topics/#auth-ntlm-kerberos","title":"Auth - NTLM Kerberos","text":"<p>Authentication - Authentication in Windows Active Directory - Private Key Crypto: A few \"practical\" remarks - NTLM - NTLM Attacks: Pass-the-hash and Relay - Kerberos - Credential Cache</p>"},{"location":"Topics/#lateral-movement-ad-abuse","title":"Lateral Movement AD Abuse","text":"<p>Lateral Movement - AD Attack Paths - AD Access Rights (in a nutshell of a nutshell) - AD Attack Examples</p>"},{"location":"Topics/#memory-corruption","title":"Memory corruption","text":"<p>Memory corruption - Memory Management (in a nutshell) Part 1 - Memory Corruption Vulnerabilities - Memory Management (in a nutshell) Part 2 - Memory Corruption: Stack Smashing - Defending against Memory Corruption vulns</p>"},{"location":"Topics/#vulnerabilities-intro-exploit-injection","title":"Vulnerabilities - Intro Exploit Injection","text":"<p>Vulnerabilities: Introduction - How to actually exploit?</p>"},{"location":"Topics/#vulnerabilities-cwe-cve-cvss","title":"Vulnerabilities - CWE CVE CVSS","text":"<p>What is the underlying mistake? (CWE)  - How to identify them unambiguously? (CVE) - What is the risk of a given vuln? (CVSS) - Which software is more secure?</p>"},{"location":"Topics/#vulnerabilities-idor","title":"Vulnerabilities - IDOR","text":"<p>IDOR (Insecure Direct Object Ref.)</p>"},{"location":"Topics/#vulnerabilities-management","title":"Vulnerabilities - Management","text":"<p>Vulnerability Lifecycle - Responsible disclosure and Zero-days - Patch Management - Vulnerability Management in Organizations - Software Dependencies</p>"},{"location":"Topics/#vulnerabilities-fundamental-issues","title":"Vulnerabilities - Fundamental Issues","text":"<p>Why do  vulnerabilities exist? - \"Shifting left\"</p>"},{"location":"Topics/#defense","title":"Defense","text":"<p>Automated Attacks - Common Technical Issues and Defense Frameworks - Attack Economics and Attack Categories - Strategic Framework: Defender Mindset - Understanding Cybersecurity</p>"},{"location":"Topics/#3-case-studies-appendix","title":"3 Case Studies - Appendix","text":""},{"location":"Topics/#total-number-of-slides-1818","title":"Total number of slides: 1818","text":"<ul> <li>Hacking : 99</li> <li>Access Control : 152</li> <li>MITRE Attack -  ICS individuals : 98</li> <li>Malware - Basic : 114</li> <li>Malware - Detection : 38</li> <li>Malware - Advanced InitialAccess : 38</li> <li>Threat Model : 41</li> <li>Passwords : 141</li> <li>MFA : 143</li> <li>Auth - NTLM Kerberos : 195</li> <li>Lateral Movement AD Abuse : 133</li> <li>Memory corruption : 141</li> <li>Vulnerabilities - Intro Exploit Injection : 91</li> <li>Vulnerabilities - CWE CVE CVSS : 41</li> <li>Vulnerabilities - IDOR : 46</li> <li>Vulnerabilities - Management : 109</li> <li>Vulnerabilities - Fundamental Issues : 35</li> <li>Defense : 139</li> <li>3 Case Studies - Appendix : 24</li> </ul>"},{"location":"docsify/","title":"Report (Docsify-This)","text":""},{"location":"docsify/#technical-specifications","title":"Technical Specifications","text":"<ul> <li>The report must be a single web page containing one or more images (length constraints are specified elsewhere).</li> <li>The web page must be published on the web with the Docsify\u2060\u2013\u2060This service. This service takes as input the URL of a single Markdown file, possibly referencing the URLs of one or more images, and publishes that Markdown file as a web page (have a quick look at the Docsify\u2060\u2013\u2060This now and then come back here; everything will be much clearer).</li> <li>The Markdown page and images containing your report must be published on the web (for consumption by Docsify\u2060\u2013\u2060This) as a Github public repository.</li> </ul> <p>The entire process is very simple. </p>"},{"location":"docsify/#how-to-develop-the-required-markdown-content","title":"How to develop the required Markdown content","text":"<p>One of the many possible workflows is as follows:</p> <ol> <li>Create a Github account (if you do not have one already).</li> <li>Scroll down the Docsify\u2060\u2013\u2060This page until you find the list of the available templates. These are public Github repositories that can be cloned and used as a starting point.</li> <li>Click on the \"One Page template\" and clone the Github repository, that will now become a public repository in your Github account. </li> <li>Start editing the <code>home.md</code> file. This file contains a concise yet very useful Markdown guide that will certainly suffice to your needs. I suggest you to throw away the portion that references an image hosted elsewhere and focus on how to reference images hosted on this repository (you will have to insert screenshots in your report).</li> <li>Copy the URL of the Github page that corresponds to that file, paste it in  Docsify\u2060\u2013\u2060This and see what happens.</li> </ol> <p>Regarding step 4, keep in mind that you will have to edit <code>home.md</code>, this file will have to reference several screenshots and you will certainly need many iterations before obtaining the final result.</p> <p>You may edit the content either directly on the Github web site, or on your PC with one of the many editors capable of rendering Markdown content. In the latter case you will have to upload your work to your Github repository, which can be done either \"manually\" or automatically by using Git, \"the\" professional tool for synchronizing local folders with a Github repository.</p>"},{"location":"docsify/#local-development-with-git","title":"Local development with Git","text":"<p>Most software development tools provide integrated support for Git and I encourage you to use one of those tools (e.g., PyCharm, Visual Studio Code). You first have to install Git on your machine (independent of the development tool) and then use the development tool. They all follow the same pattern:</p> <ol> <li>Clone your existing repository based on its URL. You will be driven to the Github authentication page and you will have to authorize your tool to operate on that repository; then you will have to choose the local folder that will store the content of the repository.</li> <li>Work on your local files, previewing the result with your development tool.</li> <li>When you want to copy the intermediate result on Github, \"stage\" your local changes, \"commit\" them with an explanatory message and then \"push\" everything on Github. All these steps are driven by the development tool. Keep in mind that whenever you create a new file that you want to be part of the repository (e.g., a screenshot), you have to instruct Git that this file has to be \"tracked\". This detail is also driven by development tools.</li> </ol> <p>An outline with the required steps with Visual Studio Code:</p> <ol> <li>Install the \"GitHub Pull Requests and Issues\" extension.</li> <li>From the \"Source Control\" view (look for it in the menus), clone your Github repository.</li> <li>Keep that view open while working (it will be on the left sidebar). You will see icons for staging, committing and syncing, as outlined above.</li> </ol> <p>There are a lot of tutorials on how to use Git, but they might be not easy to follow for a beginner because Git is very general and thus quite complex. The \"Introduction to GitHub in Visual Studio Code\" in the Microsoft Learn web site is quite simple and well structured.</p>"},{"location":"Access%20Control/Resources%20-%20Access%20Control/","title":"Access Control - Resources","text":""},{"location":"Access%20Control/Resources%20-%20Access%20Control/#saltzer-and-schroeder-principles","title":"Saltzer and Schroeder Principles","text":"<p>A masterpiece.</p> <p>The Protection of Information in Computer Systems, . Saltzer and Schroeder, Communications of the ACM 17, 7 (July 1974).</p> <p>Although this paper is very old, it is striking that many of the ideas in the introduction (Section I-A) are still valid today. The following was written 50 years ago. It could very well have been written today.</p> <p>In practice, producing a system at any level of functionality ... that actually does prevent all ... unauthorized acts has proved to be extremely difficult. ... Even in systems designed and implemented with security as an important objective, design and implementation flaws provide paths that circumvent the intended access constraints. Design and construction techniques that systematically exclude flaws are the topic of much research activity, but no complete method applicable to the construction of large general-purpose systems exists yet....</p> <p>In the absence of such methodical techniques, experience has provided some useful principles that can guide the design and contribute to an implementation without security flaws. Here are eight examples of design principles that apply particularly to protection mechanisms.</p> <p>I encourage everyone to read Section I-A-3: Design principles. Design principle 'C' is the core of access control today:</p> <p>Complete mediation: Every access to every object must be checked for authority...</p>"},{"location":"Access%20Control/Resources%20-%20Access%20Control/#example-application","title":"Example application","text":"<p>A superstar team of security and privacy experts has published in January 2024 an extremely insightful paper for analyzing (and strongly criticing) a technology being advocated by many police and intelligence agencies around the world for combating crime. They built many of their criticisms precisely on the fact that the proposed technology is in contrast with several of the design principles by Saltzer and Schroeder (first subsection of \"CSS cannot be deployed safely\").</p> <p>Bugs in our pockets: the risks of client-side scanning Journal of Cybersecurity, January 2024.</p> <p>Several other topics covered in our course are mentioned in their analysis. A really wonderful read also for everyone interested in privacy. </p>"},{"location":"Access%20Control/Resources%20-%20Access%20Control/#access-control-and-acl","title":"Access Control and ACL","text":"<ul> <li>Linux file permissions explained</li> <li>Linux permissions: SUID, SGID, and sticky bit</li> <li>Windows Access Control Overview Warning: this is a huge and complex topic, with terminology often incoherent.</li> <li>How a process can change its account:<ul> <li>Linux setuid system call</li> <li>Windows ImpersonateLoggedOnUser </li> </ul> </li> <li>Sudo Command in Linux. This site has a very nice Linux administration guide.</li> <li>A general, high-level discussion of the many flavors and facets of access control can be found in \"Authentication, Authorisation &amp; Accountability, Section 3 - Authorization\" Knowledgebase \u2013 CyBOK v1.1.</li> </ul>"},{"location":"Access%20Control/Resources%20-%20Access%20Control/#authentication","title":"Authentication","text":"<ul> <li>ChatGPT: where are accounts defined in Linux and in Windows?</li> <li>ChatGPT: which are the predefind account groups in Linux and in Windows?</li> </ul>"},{"location":"Access%20Control/Resources%20-%20Access%20Control/#active-directory-and-ldap","title":"Active Directory and LDAP","text":"<ul> <li>An Introduction to Manual Active Directory Querying with Dsquery and Ldapsearch</li> <li>All Active Directory attributes</li> <li>Using Lightweight Directory Access Protocol The topics in this section describe the steps a typical Lightweight Directory Access Protocol (LDAP) client application follows to interact with an LDAP server.</li> <li>Attacking Active Directory: 0 to 0.9 Nice description of many Windows topics, not necessarily related to attacks, including Active Directory, User Management, Access Rights and so on.</li> </ul>"},{"location":"Authentication%20-%20NTLM%20Kerberos/Authentication%20-%20Windows/","title":"Authentication - Windows","text":""},{"location":"Authentication%20-%20NTLM%20Kerberos/Authentication%20-%20Windows/#windows-protocol-specifications","title":"Windows Protocol Specifications","text":"<ul> <li>Microsoft specification of ALL the  protocols (more than 600MB compressed): Windows, Office, SQLServer, SharePoint, Exchange.</li> <li>For Windows Protocols, the documentation is split up into:<ul> <li>Windows Technology Overviews (always start from here)</li> <li>Windows Technical Specifications</li> <li>References</li> </ul> </li> <li>NT LAN Manager (NTLM) Authentication Protocol The original specification by Microsoft. Extremely complex. Too detailed to be useful (unless you are really an expert working on this very specific topic).</li> </ul>"},{"location":"Authentication%20-%20NTLM%20Kerberos/Authentication%20-%20Windows/#active-directory-ad","title":"Active Directory (AD)","text":"<ul> <li>See LDAP and Active Directory in the Access Control section</li> </ul>"},{"location":"Authentication%20-%20NTLM%20Kerberos/Authentication%20-%20Windows/#authentication-negotiation-in-windows","title":"Authentication Negotiation in Windows","text":"<ul> <li>Introduction to GSSAPI (Oracle) Generic Security Support API. SSPI Windows Security Support Provider Interface is the Windows GSSAPI implementation.</li> <li>Offensive Windows IPC Internals 2: RPC Explain in detail how Remote Procedure Calls (RPC) works in Windows. An essential issue in many protocols, including negotiation of the authentication protocol (for downgrading to NTLM when MITM).</li> <li>Downgrade SPNEGO Authentication The Windows protocol that client and server use for negotiating authentication, including the reason why a \"use Kerberos\" offer can be downgraded to \"let's use NTLM\".</li> </ul>"},{"location":"Authentication%20-%20NTLM%20Kerberos/Kerberos/","title":"Kerberos","text":""},{"location":"Authentication%20-%20NTLM%20Kerberos/Kerberos/#protocol-specification","title":"Protocol specification","text":"<ul> <li>Microsoft Kerberos All (i.e., too many) details.</li> <li>Kerberos tutorial Very clear and compact. More focussed on the non-Windows version.</li> <li>Kerberos v5 RFC  All (i.e., too many) details.</li> <li>Privilege Attribute Certificate (PAC) Many complex details.</li> <li>Abusing Kerberos Relatively old but still highly relevant for:<ul> <li>Salting in Windows Kerberos vs Standard Kerberos</li> <li>Golden ticket and ticket validation</li> </ul> </li> </ul>"},{"location":"Authentication%20-%20NTLM%20Kerberos/Kerberos/#storing-long-term-secrets","title":"Storing long term secrets","text":"<p>Where does a service store its password? There is no user typing that password at bootstrap.</p> <ul> <li>The Keytab File Where service keys are stored in MIT Kerberos.</li> <li>Windows LSA secrets LSA secrets is a special protected storage for important data used by the Local Security Authority (LSA) in Windows. LSA is designed for managing a system's local security policy, auditing, authenticating, logging users on to the system, storing private data. Users' and system's sensitive data is stored in secrets. Access to all secret data is available to system only. </li> <li>WINDOWS SECRETS EXTRACTION: A SUMMARY Post-exploitation in Windows environments often implies secrets collection. The collected secrets can be reused for lateral or vertical movement, making them high value assets. Most people already know the LSASS process, but other secrets such as LSA secrets and DPAPI ones could also allow privilege escalation or access to sensitive resources. This article will describe the different types of secrets that can be found within a Windows machine, and public tools that can be used to retrieve them. </li> </ul>"},{"location":"Authentication%20-%20NTLM%20Kerberos/Kerberos/#kerberos-attacks","title":"Kerberos attacks","text":"<ul> <li>Kerberos Authentication: A Wrap Up Very clear and concise summary of Kerberos, along with a detailed explanation of Kerberoasting and AS-REP-roasting.</li> <li>Kerberoasting revisited.</li> <li>Many more attacks in the section of this website about AD Abuse</li> </ul>"},{"location":"Authentication%20-%20NTLM%20Kerberos/NTLM/","title":"NTLM","text":"<ul> <li>NTLM Authentication: A Wrap Up Excellent and concise summary, with detailed explanation of:<ul> <li>offline cracking</li> <li>pass-the-hash</li> <li>NTLM relay</li> </ul> </li> <li>LM, NTLM, Net-NTLMv2, oh my! Some order in the very confusing terminology of Windows hashes: NTLM hash, NT hash,...</li> </ul>"},{"location":"Authentication%20-%20NTLM%20Kerberos/NTLM/#ntlm-relay","title":"NTLM Relay","text":"<p>There is a lot of existing material describing techniques and tools for executing NTLM Relay attacks. Such material may be hard to understand when the attack is used as part of a more complex chain, in particular, chains based on advanced Kerberos tricks and/or ACL paths in Active Directory. The links below are generally not based on such complex paths.</p> <ul> <li>SMB Relay This page deals with gaining code execution relaying NTLMv1/2 hashes in a very effective manner. Very basic.</li> <li>I\u2019M BRINGING RELAYING BACK: A COMPREHENSIVE GUIDE ON RELAYING ANNO 2022</li> <li>Relaying Everything: Coercing Authentications Episode 1 \u2013 MSSQL</li> <li>Other relaying examples in the section of this website about AD Abuse.</li> </ul>"},{"location":"Authentication%20-%20NTLM%20Kerberos/NTLM/#ntlm-relay-coerced-authentication-in-outlook","title":"NTLM Relay + Coerced authentication in Outlook","text":"<ul> <li>Microsoft fixes Outlook zero-day used by Russian hackers since April 2022</li> <li>CVE-2023-23397</li> <li>Nice video describing how to obtain full domain compromise. It only takes a meeting invite and a user simply opening outlook to exploit this vulnerability. Some details not easy to understand; it requires a bit of knowledge of Active Directory Certificate Services.</li> <li>From One Vulnerability to Another: Outlook Patch Analysis Reveals Important Flaw in Windows API Akamai realized that the patch issued by Microsoft was incorrect and a further patch was needed. Very well written. My summary and explanation of this mistake (Italian only).</li> </ul>"},{"location":"Authentication%20-%20NTLM%20Kerberos/NTLM/#update-2024","title":"Update 2024","text":"<ul> <li>Outlook Vulnerability Discovery and New Ways to Leak NTLM Hashes Varonis Threat Labs discovered a new Outlook vulnerability and three new ways to access NTLM v2 hashed passwords by exploiting Outlook, Windows Performance Analyzer (WPA), and Windows File Explorer.</li> </ul>"},{"location":"Defense/Defense%20-%20Resources/","title":"Defense - Resources","text":""},{"location":"Defense/Defense%20-%20Resources/#automated-attacks","title":"Automated Attacks","text":"<p>Also search for \"worms\" in this website: two major events hit the Internet in 2001, more than 20 years ago.</p>"},{"location":"Defense/Defense%20-%20Resources/#petya-notpetya","title":"Petya - NotPetya","text":"<ul> <li>Threat Brief: Petya Ransomware</li> <li>Maersk, me &amp; Notpetya \"Along with tens (if not hundreds) of others, I played a role in the recovery and cybersecurity response to the events of the well-publicised notPetya malware attack in 2017\"</li> <li>NonPetya ransomware forced Maersk to reinstall 4000 servers, 45000 PCs \"Imagine a company where a ship with 10 to 20 thousand containers is entering a port every 15 minutes, and for 10 days, you have no IT...It's almost impossible to even imagine.\"</li> </ul>"},{"location":"Defense/Defense%20-%20Resources/#wannacry","title":"Wannacry","text":"<ul> <li>Animated Map of How Tens of Thousands of Computers Were Infected With Ransomware (Wannacry)</li> <li>Wannacry Technical Analysis</li> <li>Everything you need to know about the WannaCry / Wcry / WannaCrypt ransomware Troy Hunt (the founder of haveibeenp0wned) More high level description.</li> </ul> <p>Non-technical analyses, very interesting.</p> <ul> <li>Bad malware, worse reporting Ross Anderson, University of Cambridge. \"In well over 90% of NHS organisations, the well-meaning amateurs managed perfectly well. What they did was to keep their systems patched up-to-date; simple hygiene, like washing your hands after going to the toilet.\"</li> <li>The need for urgent collective action to keep people safe online: Lessons from last week\u2019s cyberattack Brad Smith, Microsoft VicePresident. \"As cybercriminals become more sophisticated, there is simply no way for customers to protect themselves against threats unless they update their systems. Otherwise they\u2019re literally fighting the problems of the present with tools from the past. This attack is a powerful reminder that information technology basics like keeping computers current and patched are a high responsibility for everyone, and it\u2019s something every top executive should support\". </li> </ul>"},{"location":"Defense/Defense%20-%20Resources/#internet-wide-scans","title":"Internet-wide scans","text":"<ul> <li>MASSCAN: Mass IP port scanner This is an Internet-scale port scanner. It can scan the entire Internet in under 5 minutes, transmitting 10 million packets per second, from a single machine.</li> <li>Notes on Volt Typhoon (\"pull the plug\" ) \"somebody is assigned the ability to pull the plug purely on their own authority...I\u2019ve done that (metaphorically) a couple times, notified the CEO that there\u2019s an extreme situation and I\u2019m going to bypass all processes and piss off a lot of people in order to address it.\" Robert Graham is a sort of must-read author, mentioned multiple times in this website. His views are sometimes quite radical, but he definitely knows what he is talking about. BTW: he is the author and maintainer of masscan.</li> </ul>"},{"location":"Defense/Defense%20-%20Resources/#cisa-emergency-directives","title":"CISA Emergency directives","text":"<ul> <li>Mitigate Ivanti Connect Secure and Ivanti Policy Secure Vulnerabilities</li> <li>Mitigate SolarWinds Orion Code Compromise</li> </ul>"},{"location":"Defense/Defense%20-%20Resources/#defense-frameworks","title":"Defense Frameworks","text":"<ul> <li>MITRE D3FEND A knowledge graph of cybersecurity countermeasures.</li> <li>NIST Cybersecurity Framework 2.0</li> </ul>"},{"location":"Defense/Defense%20-%20Resources/#guides-and-best-practices","title":"Guides and best practices","text":"<p>Too many to list.</p>"},{"location":"Defense/Defense%20-%20Resources/#cisa","title":"CISA","text":"<ul> <li>NSA and CISA Red and Blue Teams Share Top Ten Cybersecurity Misconfigurations Discussed in the lectures.</li> <li>#StopRansomware Guide One-stop resource with best practices and ways to prevent, protect and/or respond to a ransomware attack.</li> <li>CISA Red Team Shares Key Findings to Improve Monitoring and Hardening of Networks List of mitigations suggested after an extremely interesting penetration exercise by CISA on a large critical infrastructure organization, with detailed attack steps (mapped to ATT&amp;CK). Very worth reading: one can understand the depth, length  and sophistication of such attacks.</li> </ul>"},{"location":"Defense/Defense%20-%20Resources/#italy","title":"Italy","text":"<ul> <li>Misure minime di sicurezza ICT per le pubbliche amministrazioni Riferimento pratico per valutare e migliorare il livello di sicurezza informatica delle amministrazioni, al fine di contrastare le minacce informatiche pi\u00f9 frequenti (chiamate anche \"misure minime AgiD\").</li> </ul>"},{"location":"Defense/Defense%20-%20Resources/#major-incidents-suggested-mitigations","title":"Major incidents: suggested mitigations","text":"<p>Many alerts and threat reports often include a final list of suggested mitigations. They do not reference any standard nor any systematic framework (a complete mess). Just a couple of examples:</p> <ul> <li>APT Cyber Tools Targeting ICS/SCADA Devices.</li> <li>Advanced Persistent Threat Compromise of Government Agencies, Critical Infrastructure, and Private Sector Organizations.</li> <li>Midnight Blizzard: Guidance for responders on nation-state attack  </li> </ul>"},{"location":"Defense/Defense%20-%20Resources/#siem-soc-log-analysis","title":"SIEM / SOC / Log analysis","text":""},{"location":"Defense/Defense%20-%20Resources/#machine-learning-and-ai","title":"Machine Learning and AI","text":"<ul> <li>Outside the Closed World:  On Using Machine Learning For Network Intrusion Detection </li> </ul> <p>There is a lot of academic research and a lot of industrial products based on the idea of detecting attacks by merely detecting anomalies or deviations from \"normal\" behavior (all the supposedly magic AI-based stuff is based on variations of this basic idea). This 2010 paper (yes, 2010) illustrates why those approaches are unlikely to work or, more precisely, under which conditions they might work.</p> <p>Everyone interested in \"automatic detection of attacks\" should read and understand this work before even starting. It has won the IEEE Security and Privacy \"Test of Time\" award, a very prestigious award given once a year \"to 10-12 year old papers whose influence grew over time\". Slides here. </p> <p>\"AI detects novel and previously unseen attacks\"</p> <ul> <li>The Many Faces of Undetected macOS InfoStealers | KeySteal, Atomic &amp; CherryPie Continue to Adapt Every major vendor is now \"AI-powered\" and AI can detect novel and previously unseen malware and attacks. This post illustrates that this is not the case: a known malware family changes slightly, which suffices to evade signatures (signatures? why signatures? everyone uses AI!). Interestingly, this post never mentions AI, not even once; maybe because it has been written by technicians, not by marketing people.</li> </ul>"},{"location":"Defense/Defense%20-%20Resources/#siemsoc","title":"SIEM/SOC","text":"<ul> <li>99% False Positives: A Qualitative Study of SOC Analysts' Perspectives on Security Alarms A scientific work whose title says it all. With slides and presentation video. 31st USENIX Security Symposium 2022.</li> <li>Global Security Operations Center Study Results by IBM and Morning Consult (2023). A survey that involved 1000 SOC  Team Members from 10 different countries.</li> </ul>"},{"location":"Defense/Defense%20-%20Resources/#log-analysis","title":"Log analysis","text":"<ul> <li>Applied Incident Response, a wonderful book by Steve Anson.<ul> <li>Have a look at chapter 8 \"Event Log Analysis\" and chapter 12 \"Lateral Movement Analysis\" to grasp some idea of the complexity of Windows logs. In particular, have a look at how many different \"low-level events\" may be involved in such a seemingly simple \"high-level event\" as a logon.</li> <li>Chapter 7 \"Network Security Monitoring\" is also particularly interesting.</li> </ul> </li> </ul>"},{"location":"Defense/Defense%20-%20Resources/#attack-categories","title":"Attack Categories","text":""},{"location":"Defense/Defense%20-%20Resources/#basic-hygiene","title":"Basic hygiene","text":"<ul> <li>Cybersecurity for Small Businesses Hearing before the New York City Council Committee on Technology, Steve Bellovin, University of Columbia, 2020 (My opinion: When Steve Bellovin speaks or writes, one should only try to listen or read very carefully). Basic \"security hygiene\" practices.</li> </ul>"},{"location":"Defense/Defense%20-%20Resources/#apt-advanced-and-persistent-threats","title":"APT - Advanced and Persistent Threats","text":"<ul> <li>NSA Hacker Chief Explains How to Keep Him Out of Your System A very interesting read for understanding the capabilities of APT groups (better said, the capabilities that this person, basically the Hacker in Chief of the USA, decided to make public).</li> <li>Disrupting Nation State Hackers The full transcript of his speech. Extremely interesting.</li> <li>Advanced Persistent Threats and Nation-State Actors Threat overviews and advisories maintained by CISA for: China, Russia, North Korea, Iran.</li> </ul>"},{"location":"Defense/Defense%20-%20Resources/#understanding-cybersecurity","title":"Understanding Cybersecurity","text":"<ul> <li>How CEOs think A must read for understanding cybersecurity in the real world. Its author, Robert Graham, is a well known person in the cybersec world.</li> <li>Microsoft Digital Defense Report 2022 Long and detailed, quite interesting. One of the final sections (Cyber resilience) contains the diagram summarizing the missing security controls detected by Microsoft in their impacted customers. My personal opinion: a product that in most cases is installed or deployed with so many problems is a product with many problems. Microsoft is telling us this fact about one of its most important products.</li> </ul>"},{"location":"Defense/Defense%20-%20Resources/#appendix-a-few-major-incidents","title":"APPENDIX: A few major incidents","text":""},{"location":"Defense/Defense%20-%20Resources/#solarwinds","title":"SolarWinds","text":"<ul> <li>U.S. Senate Intelligence Hearings - Solar Winds Hearings of CEOs of FireEye, Mandiant, SolarWinds, Microsoft, CrowdStrike. Extremely interesting.</li> <li>The SolarWinds Cyberattack A very interesting non-technical summary with a detailed timeline.</li> </ul>"},{"location":"Defense/Defense%20-%20Resources/#proxylogon-microsoft-exchange-mail-server","title":"ProxyLogon (Microsoft Exchange Mail server)","text":"<ul> <li>Mitigate Microsoft Exchange On-Premises Product Vulnerabilities Cybersecurity and Infrastructure Security Agency (CISA) Emergency Directive.</li> <li>Investigating ProxyLogon Attacks And How To Mitigate It A demo with screenshots.</li> <li>ProxyLogon The latest pre-authenticated Remote Code Execution vulnerability on Microsoft Exchange Server A detailed technical explanation by the researchers that notified Microsoft. \"An unauthenticated attacker can execute arbitrary commands on Microsoft Exchange Server through an only opened 443 port!\".</li> </ul>"},{"location":"Defense/Defense%20-%20Resources/#midnight-blizzard-attack-to-microsoft","title":"Midnight Blizzard attack to Microsoft","text":"<p>The \"Midnight Blizzard\" attack mentioned above is extremely interesting, for several reasons  (that name identifies a Russian state-sponsored threat actor, also known as Nobelium). </p> <p>Please read carefully the following excerpt from Microsoft Actions Following Attack by Nation State Actor Midnight Blizzard and then think about the very deep implications (italic is mine): </p> <p>The Microsoft security team detected a nation-state attack on our corporate systems on January 12, 2024. Beginning in late November 2023, the threat actor used a password spray attack to compromise a legacy non-production test tenant account and gain a foothold, and then used the account\u2019s permissions to access a very small percentage of Microsoft corporate email accounts, including members of our senior leadership team and employees in our cybersecurity, legal, and other functions, and exfiltrated some emails and attached documents.</p> <p>Two very interesting analyses of that incident, by very respected experts: one that criticises Microsoft, the other that defends it. Both really worth reading:</p> <ul> <li>Microsoft's Dangerous Addiction To Security Revenue by Alex Stamos.</li> <li>Notes on Microsoft's Midnight Blizzard attack by Robert Graham.</li> </ul>"},{"location":"Hacking%20Lab/Lab_Hacking_Metasploitable/","title":"Metasploitable3 Hacking Lab","text":"<p>This page is best understood after having attended the accompanying lecture.</p>"},{"location":"Hacking%20Lab/Lab_Hacking_Metasploitable/#preliminaries","title":"Preliminaries","text":"<p>For executing the suggested activities you need:</p> <ol> <li>VirtualBox (or another hypervisor) installed.</li> <li>Some minimal (really minimal) familiarity with virtual machines and VirtualBox usage.</li> <li>Two VMs installed, one acting as attacked machine (metasploitable3) and the other acting as attacker machine (Kali Linux). </li> </ol> <p>This accompanying page describes the required installation steps.</p>"},{"location":"Hacking%20Lab/Lab_Hacking_Metasploitable/#our-attack-tools","title":"Our Attack Tools","text":""},{"location":"Hacking%20Lab/Lab_Hacking_Metasploitable/#metasploit","title":"Metasploit","text":"<p>The main tool for attacking metasploitable3 is metasploit. This is a professional tool structured as a modular framework. There are a a number of modules available, each specialized for executing a specific attack to a specific software. Metasploit is a very powerful and complex tool. This document is based on a tiny subset of its capabilities.</p> <p>There are several ways for using metasploit, the most common one being a command-line interface.</p> <p>Broadly speaking, one should:</p> <ol> <li>Specify the module or the exploit to be used. This is done by typing a sort of path name for the module.</li> <li>Set every option of the module that is not set by default or whose default value is not appropriate. This is done by executing the <code>set option-name</code> command as many times as needed. For example, in most cases considered in this document, it is necessary to execute <code>set rhosts IP-address-target</code>.</li> <li>Run the module. This is done by typing <code>run</code> or <code>exploit</code>, depending on the specific module being used.</li> </ol>"},{"location":"Hacking%20Lab/Lab_Hacking_Metasploitable/#meterpreter","title":"Meterpreter","text":"<p>Metasploit contains a remote shell software called meterpreter.</p> <p>The default payload of many metasploit exploits is a meterpreter server. If the exploit injection succeeds, there will be a meterpreter session between the attacker machine and the attacked machine, that is:</p> <ul> <li>a meterpreter client running within metasploit, on the attacker machine; it is a shell client connected to the meterpreter server;</li> <li>a meterpreter server running on the attacked machine and launched with the exploit; it is a shell server;</li> </ul> <p>As a result, the attacker will be able to execute many powerful operations on the attacked machine with a simple command-line interface. The set of commands available with meterpreter are described in the documentation (see \"Useful links\" below).</p> <p>Meterpreter is a very sophisticated tool. Just to mention a few of its features (not discussed in this document):</p> <ul> <li>Communication between client and server may occur over several different transport protocols (http, https, tls).</li> <li>The meterpreter server side usually is not run as a separate process. It is instead executed in the context of an existing process, by overwriting its memory. This fact makes its detection by defenders more difficult than, e.g., when spawning a shell (i.e., a new process).</li> <li>The meterpreter server can be migrated from the process where it is being executed to another process in execution on the target machine.</li> </ul>"},{"location":"Hacking%20Lab/Lab_Hacking_Metasploitable/#very-brief-example","title":"Very brief example","text":"<p>The following screenshot shows:</p> <ol> <li>Launch metasploitn in command-line mode (<code>msfconsole -q</code>).</li> <li>Select a specific exploit for the elasticsearch server (<code>use</code>).</li> <li>Set the rhosts option, for targeting the metasploitable3 VM.</li> <li>Run the exploit. Since the payload has not been specified the default one will be used, i.e., a meterpreter server.</li> <li>Injection is successful and a meterpreter session is open (presence of the <code>meterpreter &gt;</code> prompt).</li> <li>Execute the meterpreter <code>shell</code> command for launching a shell on the attacked machine (this spawns a new process on that machine; as observed above, launching a shell is usually not necessary, one could obtain more or less the same functionality by executing only meterpreter commands). Interaction with this shell is not shown in the figure.</li> </ol> <p></p>"},{"location":"Hacking%20Lab/Lab_Hacking_Metasploitable/#key-references","title":"Key references","text":"<ul> <li>Metasploit full guide</li> <li>Metasploit module library</li> <li>Meterpreter basic commands</li> </ul>"},{"location":"Hacking%20Lab/Lab_Hacking_Metasploitable/#attacking-metasploitable3","title":"Attacking metasploitable3","text":""},{"location":"Hacking%20Lab/Lab_Hacking_Metasploitable/#preliminaries_1","title":"Preliminaries","text":""},{"location":"Hacking%20Lab/Lab_Hacking_Metasploitable/#how-to-use-tutorials","title":"How to use tutorials","text":"<p>Many pages on the web provide forms of walkthrough or tutorials or solutions to one or more of the vulnerabilities in metasploitable3. Although such pages may be useful for learning purposes, they are hardly useful for understanding and generalizing. They typically consist of a long sequence of \u201cuse this tool with those options\u201d steps. As a consequence, one may succeed in exploiting that specific vulnerability in that specific case, but without understanding why that approach works, whether other approaches would work as well, whether that approach may be applied to other scenarios and so on.</p> <p>My suggestion is to look at tutorials only for having a general idea of what should be done. One should then try to proceed autonomously, of course, with frequent interactions with search engines for finding examples of usage of the numerous hacking tools available.</p> <p>The indications below suggest attacks that could be useful for a beginner. Such indications do not take the form of a detailed, precise sequence of steps. They provide instead some general indications, sometimes with a few potentially useful links. One should understand autonomously what to do, by using search engines and, most importantly, by taking personal notes of what has been done, what worked, what did not work.</p>"},{"location":"Hacking%20Lab/Lab_Hacking_Metasploitable/#metasploitable3-vulnerabilities","title":"Metasploitable3 vulnerabilities","text":"<p>Vulnerabilities of metasploitable3 are listed in this Github page. The listing is very synthetic: it does not provide sufficient information for understanding the nature of a vulnerability, nor does it provide any indications for exploiting it.</p> <p>Many vulnerabilities are due to insecure default configuration of servers or to weak passwords.</p> <p>The credentials of (almost) all Windows users defined in metasploitable3 are provided in this Github page. These credentials may or may not be valid for accessing a given service of metasploitable3. For example, the SMB file-sharing service is accessed with credentials of Windows users while web servers or database servers usually are based on users and credentials stored and managed separately from those of Windows.</p> <p>Of course, one should pretend that credentials are not known. My suggestion is using this knowledge only as follows:</p> <ul> <li>When executing a password guessing attack, have a look at those credentials to have an idea of how long the attack might take (of course, in a real attack such an indication would not be available). You might want to prepare a dictionary containing the credentials that are known to be valid (again, in a real attack this knowledge in not available) and one of the dictionaries available in Kali Linux (see the wordlists package).</li> <li>If logging on the Windows VM were necessary for some reason, then use the credentials of the <code>vagrant</code> user (password <code>vagrant</code>);</li> </ul>"},{"location":"Hacking%20Lab/Lab_Hacking_Metasploitable/#enumeration","title":"Enumeration","text":"<p>The very first steps are as follows:</p> <ol> <li>Finding the IP address of the target machine.</li> <li>Listing the servers (i.e., port numbers and protocols) that can be accessed and attacked. </li> </ol> <p>One of the ways these steps may be executed is with the <code>nmap</code> command. The information obtained with these steps is necessary for the attacks described in the next sections.</p> <p>These steps are usually called \"enumeration\" (the MITRE ATT&amp;CK framework discussed later in this course uses a different term for the corresponding tactic, i.e., \"discovery\").</p> <p>Suggestions:</p> <ul> <li>First of all you need to find the IP address and network number of your Kali machine (<code>ifconfig</code> command).</li> <li>Then you need to determine which other hosts are connected to your network. This can be done with <code>nmap network-number-of-your-interface</code> (with /24 syntax). You will probably find 3 IP addresses: one for your Kali machine; one for the target (metasploitable3 VM) and the third one for what?</li> <li>How to determine which of the two addresses that do not belong to your Kali machine belongs to the target? (hints: which ports are open at those addresses?)</li> <li>Finally, execute a scan on IP-address-target by running <code>nmap</code>  with default options.</li> </ul> <p>Further suggestions: </p> <ul> <li>Execute another scan with <code>nmap -sV -p- IP-address-target</code>. This command takes much longer and generates much more network traffic but provides a more detailed description. Try to understand the difference in depth and coverage of the scan between the two cases.</li> <li>Metasploitable3 has a vulnerable service listening on ports 9200/9300. Is that service detected by <code>nmap</code> in both executions? If yes, is it identified correctly (search on the web what is the typical usage for those ports)?</li> <li>Capture the traffic generated by nmap with default options by running wireshark on the attacking machine. This is useful for understanding the amount of \u201cnoise\u201d that could be detected by a defender.</li> </ul> <p>Useful link: Running a quick NMAP scan to inventory my network.</p>"},{"location":"Hacking%20Lab/Lab_Hacking_Metasploitable/#smb-exploitation-eternalblue","title":"SMB Exploitation (EternalBlue)","text":"<p>SMB is a communication protocol for sharing files and printers. A service that can be accessed with this protocol runs on basically all Windows systems. It exposes functionalities for accessing files, navigating through directories and alike (e.g., search \u201csmb commands windows\u201d). As such, this service does not expose any functionality for executing arbitrary commands, launching a shell, managing users or devices and alike.</p> <p>Vulnerability CVE-2017-0144 affects the Windows SMB server. This vulnerability can be exploited by an unauthenticated remote attacker for executing arbitrary code on the machine running the server (see also Microsoft Security Bulletin MS17-010).</p> <p>An exploit for this vulnerability, developed by the NSA and secretly used for their attacks, was publicly released on 17/4/2017 by \"The Shadow Brokers\", a hacking group whose real identities are not known. This exploit is widely known as \u201cEternalBlue'' and was used in several large scale ransomware attacks a few months later (WannaCry / NotPetya). Interestingly, a patch for this vulnerability had already been made available by Microsoft at the time of those disrupting attacks. One of the reasons for the large-scale impact of those attacks is that hundreds of thousands of machines around the world had not applied the patch (a few notes by myself on this fact).</p> <p>The metasploitable3 Windows VM has this vulnerability (no longer present in modern Windows platforms). Metasploit has a module containing an exploit for that vulnerability, where the default payload launches a Metepreter session with SYSTEM privilege (i.e., a shell with full control on the attacked system).</p>"},{"location":"Hacking%20Lab/Lab_Hacking_Metasploitable/#understand-process-structure","title":"Understand process structure","text":"<p>The exploit payload is the meterpreter server. This payload is injected within the memory of the vulnerable program (SMB server). After injection, thus, the meterpreter client will be connected to the same process that runs the SMB server. No new process is created.</p> <p>The meterpreter commands issued by the client machine will be executed by the vulnerable process at the other side, i.e., on the attacked machine. The operating system on the attacked machine will execute only those commands for which the vulnerable process has sufficient access rights. Since that process is associated with the <code>SYSTEM</code> identity, that process has the highest privilege level possible and thus every command can be executed.</p> <p>One of the possible meterpreter commands is <code>shell</code>, which spawns a shell on the attacked machine. In this case a new process is created. The identity of that process is the same as the identity of its parent process (i.e., of the vulnerable process). Thus, the shell process will also have the SYSTEM identity.</p> <p>One of the possible meterpreter commands is <code>migrate</code>, which move the meterpreter server within the memory of another running process on the attacked machine. In this case, the identity of the meterpreter server after migration will be that of the \"destination process\".</p>"},{"location":"Hacking%20Lab/Lab_Hacking_Metasploitable/#suggestions","title":"Suggestions","text":"<p>Suggestions: </p> <ul> <li>Execute the metasploit <code>search</code> command of metasploit to have a look at the exploits available and possibly focus on those available for Windows targets.</li> <li>Use the exploit exploit/windows/smb/ms17_010_eternalblue for obtaining a meterpreter session on metasploitable3.</li> <li>Ascertain the user associated with that session (meterpreter <code>getuid</code> command).</li> <li>Take a moment to realize what has happened: by exploiting a mistake in a service for accessing files and printers, one has taken full control of the attacked machine.</li> </ul> <p>Then you can operate on metasploitable3 by playing with meterpreter from the attacker machine. Some suggestions:</p> <ul> <li>Have a look at which files might have interesting content (<code>search -f *.pdf</code>  or <code>jpg</code> or whatever). Search may be rooted at a specified directory with the <code>-d</code> option.</li> <li>Grab a screen of the desktop. To do so, there must be a user logged on metasploitable3, otherwise the screenshot will be fully black (no desktop); you might want to logon some user on metasploitable3, e.g., user <code>vagrant</code> with password <code>vagrant</code>. Details for grabbing the screenshot are described here: try to understand what you are doing and why.</li> <li>Have a look at the event logs in metasploitable3. You need to logon on metasploitable3 as user <code>vagrant\\vagrant</code> and then run the Windows \u201cevent viewer\u201d (i.e., not from the attacker machine). Understanding the meaning of those \"low-level\" events and mapping them to \"high-level\" activities to them is very difficult (we will touch this topic very briefly near the end of this course). Just have a look and see that there are many events. Then execute the meterpreter <code>clearev</code> command and look at the event logs again. Try to imagine the implications.</li> <li>Launch a shell on metasploitable3 with the meterpreter <code>shell</code> command and then execute some commands.</li> </ul> <p>Interesting commands to run from a meterpreter shell (the following suggestions require some simple web searches, or ChatGPT interactions, for figuring out the necessary details):</p> <ul> <li>Create a new user (search in the web for \u201cwindows create user command line\u201d or ask ChatGPT with a suitable prompt, as indicated in the index page)</li> <li>Assign administrator privilege to that user (search in the web for \u201cwindows modify user and account privileges command line\u201d or ask ChatGPT)</li> </ul> <p>Note that the newly created user will be visible on the logon screen of metasploitable3. If one wants to keep the newly created user hidden (in that screen), then a certain system attribute of that user should be modified. This is possible but not trivial, I do not think it is interesting in this context. It may be more interesting to identify the corresponding events that have been generated in the Security log of metasploitable3 and then clearing the log as suggested above.</p>"},{"location":"Hacking%20Lab/Lab_Hacking_Metasploitable/#online-password-guessing","title":"Online password guessing","text":"<p>There are many tools for executing an online password guessing attack, including <code>nmap</code>, <code>metasploit</code>, <code>Hydra</code> (all of them already installed in Kali). A tool of this kind must be able to execute the authentication exchange of the specific protocol considered and the tools mentioned above support many protocols. In general, one has to specify a list of users and a list of passwords as inputs. There are many such lists available and many possible ways for constructing them. Note that many web pages (somewhat improperly) use the term \u201cbrute force\u201d for describing this kind of guessing attacks.</p> <p>One could use some of the many wordlists available on Kali Linux (see the wordlists package), but those attacks would take a very long time. For simplicity, I suggest to proceed as follows:</p> <ul> <li>Use the Kali <code>cewl</code> command for constructing a new wordlist from the content of the metasploitable3 configuration page: <code>cewl -d 0 -w metasploitable3.txt https://github.com/rapid7/metasploitable3/wiki/Configuration</code> (option <code>-d 0</code> states that hyperlinks should not be followed)</li> <li>Construct a much smaller wordlist (<code>metasploitable3-short.txt</code>) containing:<ul> <li><code>vagrant</code>, <code>root</code>, <code>administrator</code>, <code>Administrator</code></li> <li>5-10 words taken from <code>metasploitable3.txt</code> constructed as above.</li> </ul> </li> <li>Use <code>metasploitable3-short.txt</code> in the attacks suggested below. This wordlist can be used as a user list or a password list, or both. </li> </ul> <p>In a real setting one could reasonably use <code>cewl</code> as indicated above for creating <code>metasploitable3.txt</code>. The step for shrinking this wordlist and obtaining <code>metasploitable3-short.txt</code> is obviously not realistic, though.</p> <p>Useful link: Detailed guide on Hydra.</p>"},{"location":"Hacking%20Lab/Lab_Hacking_Metasploitable/#ssh","title":"SSH","text":"<p>The SSH service is an attractive target for password guessing attacks because a success would provide a remote shell (whose level of privilege will depend on the privilege of the user whose credentials have been found).</p> <p>Metasploitable3 has weak credentials for this service (of course, in a real setting this knowledge is not available).</p> <p>Suggestions: </p> <ul> <li>Try to see whether the metasploitable3 SSH service is vulnerable to the exploit auxiliary/scanner/ssh/ssh_enumusers. This exploit takes a list of users as input and tells which of those users is a valid username for the targeted service.</li> <li>If the above exploit succeeds, use the corresponding user list with the password list obtained in a previous section for executing a guessing attack. Such an attack may be executed either with Hydra or with metasploit (auxiiary/scanner/ssh/ssh_login).</li> <li>Always make sure to set the necessary options for checking whether a null password works.</li> <li>If you manage to find valid credentials, you may connect to the SSH service with any SSH client or with the metasploit auxiiary/scanner/ssh/ssh_login module, by setting the options username and password.</li> </ul> <p>SSH is often configured with public key client authentication. With this configuration, a SSH client must prove knowledge of a password and of a certain private key; the SSH server must know the matching public key of that client. The mechanism is conceptually identical to TLS with mutual authentication (a topic no longer studied in \"Computer Networks\"): in the default TLS configuration, it is the server that proves knowledge of a private key; in the mutual TLS configuration, instead, each of the two sides prove knowledge of the respective private key to the other side.</p> <p>SSH in metasploitable3 is not configured this way, thus obtaining a client password suffices for impersonating that client. Note that a guessing attack for obtaining the private key of a client is not meaningful (why?).</p> <p>Useful link: What Is SSH: Understanding Encryption, Ports and Connection.</p>"},{"location":"Hacking%20Lab/Lab_Hacking_Metasploitable/#mysql","title":"MySQL","text":"<p>The MySQL service is an attractive target for password guessing attacks, because a success would provide access to the corresponding databases. The content of those databases may often be very valuable to the attacker.</p> <p>Furthermore, the content of a MySQL database is often useful for executing further attack steps. The reason is because services that store and manage credentials independent of the store of the operating system, often store their credentials in a database. This is usually the case of web applications, for example. A MySQL database, thus, often contain credentials of some other services running on the same machine as the MySQL server (section Password Stealing, MySQL). </p> <p>Metasploitable3 has weak credentials for the MySQL service (of course, in a real setting this knowledge is not available).</p> <p>Suggestions: </p> <ul> <li>Try to find credentials with Hydra or with metasploit (auxiliary/scanner/msysql/mysql_login). Use <code>metasploitable3-short.txt</code> as user list and password list. Make sure to set the necessary options for checking whether a null password works.</li> <li>If you manage to find valid credentials, you may connect to the MySQL service with any MySQL client (search the web for \u201ckali mysql client\u201d).</li> </ul>"},{"location":"Hacking%20Lab/Lab_Hacking_Metasploitable/#password-stealing","title":"Password stealing","text":""},{"location":"Hacking%20Lab/Lab_Hacking_Metasploitable/#windows","title":"Windows","text":"<p>Credentials of all Windows users are stored in a portion of secondary storage called SAM (Security Account Manager). Passwords are stored in hashed form. The SAM usually contains two different hashes for each password, one of them for compatibility reasons not discussed here. The SAM content may be read (i.e., password hashes may be stolen) by specialized programs executed on the target machine under an identity with SYSTEM privilege. Several such programs exist.</p> <p>Password hashes may be used for:</p> <ul> <li>Trying to obtain the corresponding password (offline guessing, also improperly called \u201cbrute force\u201d, section Offline Password Guessing ).</li> <li>Impersonating the corresponding users even without figuring out the respective passwords (the so-called pass the hash attack that can be executed on Windows machines, section Pass-the-Hash ).</li> </ul> <p>Suggestions:</p> <ul> <li>Having obtained a meterpreter session as described in section SMB Exploitation (EternalBlue), dump the SAM content with the meterpreter command <code>hashdump</code> and store its output in a text file on the attacking machine.</li> </ul>"},{"location":"Hacking%20Lab/Lab_Hacking_Metasploitable/#mysql_1","title":"MySQL","text":"<p>Services often manage accounts and credentials independently of the underlying operating system, i.e., Windows. The corresponding information must be stored in some secondary storage, usually on a database. This is usually the case of web applications, for example. A MySQL database, thus, often contain credentials of some other services running on the same machine as the MySQL server.</p> <p>The target machine has a MySQL service running. This database could store such credentials (hint: it does store Wordpress credentials; Wordpress is an open source content management system widely used for building web sites).</p> <p>Suggestions:</p> <ul> <li>Having obtained MySQL credentials as described in section MySQL password guessing, try to determine whether any such credentials have admin privilege on MySQL. Then, use those credentials for:<ul> <li>Listing the databases on the MySQL service and see whether there is anyone that could contain credentials of some service.</li> <li>Listing the tables of that database and see which one could contain credentials.</li> <li>Inspect the schema of that table and prepare a SQL query for extracting the relevant columns.</li> <li>Execute that query and store its output in a text file on the attacking machine.</li> </ul> </li> </ul> <p>Useful links: - Pwning WordPress Passwords (see first part) - Metasploitable 3 Windows Walkthrough: Part VI (see second part).</p>"},{"location":"Hacking%20Lab/Lab_Hacking_Metasploitable/#offline-password-guessing","title":"Offline password guessing","text":"<p>Offline password guessing is an attack that, given a password hash, attempts to obtain the corresponding password. Since hash functions are designed to be not invertible (an output value does not provide any information about the corresponding input), such attacks work by computing the hash of each password in an input password list until finding a value identical to the hash available. Of course, success of the attack depends on whether the password to be found is in the input password list and on the amount of computing resources available.</p> <p>This guessing attack is called \u201coffline\u201d because during its execution there is no communication at all with the service where the targeted credentials are used.</p> <p>Suggestions: </p> <ul> <li>Take the credentials extracted from MySQL in the previous section.</li> <li>Execute the Kali command <code>hash-identifier</code> on one of the hashes in order to have an indication of the hash function used, i.e., of the program that could have originated that hash (we already have such information: Wordpress).</li> <li>Use the password list constructed in section Online password guessing for executing an offline guessing on the Wordpress credentials. Suitable tools are <code>hashcat</code>and john the ripper (command <code>john</code>). In less than half an hour you should recover some password (in a real setting you would not know in advance whether the attack will succeed and how much time will be needed).</li> </ul> <p>The very same steps could be executed for an offline guessing attack on the Windows credentials extracted from the SAM. However, the hash of a Windows password suffices for impersonating the corresponding user, even without knowing the password (see also  section Pass the hash (pth) ).</p> <p>When using a tool for offline guessing keep in mind: - The input file containing the hashes must be structured as required by the tool (<code>hashcat</code> expects to receive only the hashes, <code>john</code> can receive a SAM line with the suitable input option). - The correct hash format is specified in input.  - Usage of both <code>hashcat</code> and <code>john</code> is quite complex (e.g., <code>john</code> maintains a hidden cache of recently cracked hashes, so in repeated executions those hashes are not cracked again; and, a VM might not have enough memory to run hashcat).</p>"},{"location":"Hacking%20Lab/Lab_Hacking_Metasploitable/#how-to-use-the-obtained-passwords","title":"How to use the obtained passwords","text":"<p>Assuming you obtained some wordpress credentials:</p> <ol> <li>Launch a browser and point it to http://IP-address-target:8585/wordpress (a website created with wordpress is usually available on the standard ports, i.e., 80/443; in metasploitable3 it has instead been configured to be available on port 8585 at that URL).</li> <li>Try to find the login page.</li> <li>Try to use one of the recovered credentials for becoming the admin of the web site.</li> </ol>"},{"location":"Hacking%20Lab/Lab_Hacking_Metasploitable/#pass-the-hash","title":"Pass-the-hash","text":"<p>Pass-the-hash is an attack in which an attacker impersonates a user against a Windows service by using only the password hash of that user (i.e., without knowing the password from which that hash was obtained).  This topic will be studied in depth later in this course. In a nutshell:</p> <ul> <li>Windows uses several authentication protocols, including one called NTLMv2 that exists in all Windows versions.</li> <li>NTLMv2 is such that the client must prove knowledge of the hash of a user password.</li> <li>A \u201clegitimate\u201d client software designed for Windows takes a password as input, computes its hash and then executes NTLMv2 when needed. Thus, knowledge of a password hash is not sufficient with this kind of software, because such a software will compute the hash of the password hash before executing NTLMv2.</li> <li>A client software for executing attacks, instead, takes instead a password hash as input and executes NTLMv2 directly, without computing a further hash of the input. There are many free tools that have been implemented for this purpose, one of them is shown below.</li> </ul> <p>Password hashes may be obtained by dumping the content of a SAM, as described in section \u201cPassword stealing\u201d.</p> <p>Suggestions: </p> <ul> <li>Take the hashes extracted from the SAM as in section Password stealing.</li> <li>Use a command from the <code>win-pth</code> suite available in Kali for executing a command on the targeted machine, by using one of those hashes.</li> </ul> <p>Useful link: https://www.puckiestyle.nl/pass-the-hash/</p>"},{"location":"Hacking%20Lab/Lab_Hacking_Metasploitable/#important-remark-on-windows-password-hashes","title":"Important remark on Windows password hashes","text":"<p>There are other ways for obtaining Windows password hashes, i.e., by reading them from the memory of a certain system process called LSASS that contains the password hash of all the users that are currently logged in.</p> <p>Several tools exist for executing this operation and they have to be executed under an identity with SYSTEM privilege. The one that is most widely known is called <code>mimikatz</code>.</p> <p>This kind of attack may be particularly disruptive in enterprise environments. The reason is because system administrators often execute maintenance operations from a remote location by using credentials with high privilege (which is a very bad practice). If a malicious program with SYSTEM privilege happens to be in execution on the machine where such operations are being executed, that malicious program will steal password hashes of an identity with high privilege; such hash may be typically used on every other machine of the enterprise, again with high privilege.</p> <p>This simple fact may lead to total compromise of a large organization.</p>"},{"location":"Hacking%20Lab/Lab_Virtual_Machines/","title":"Metasploitable3 Hacking Lab - Installation","text":"<p>A short but very useful guide to installing everything you need on Windows can be found in section Windows setup in a nutshell.</p>"},{"location":"Hacking%20Lab/Lab_Virtual_Machines/#attacked-machine-metasploitable3","title":"Attacked machine (Metasploitable3)","text":"<p>Metasploitable3 is a freely available virtual machine (VM) that contains a number of security vulnerabilities and has been designed for learning purposes. It comes in two flavors: Linux Ubuntu and Windows Server 2008.</p> <p>This document assumes metasploitable3 Windows Server 2008, running on VirtualBox. In order to follow the exercises suggested in this document, there is no need to obtain the Linux Ubuntu version. </p> <p>In order to create a metasploitable3 VM, one can either download a prebuilt image already configured for VirtualBox or construct one. Instructions can be found in this Github repository and . </p> <p>Downloading a prebuilt image configured for VirtualBox is simpler and quicker (\u201cquick start\u201d in the Github repo); however, in this case the Windows Server VM will warn that the 30 days evaluation period has elapsed and the Windows copy is not genuine.</p>"},{"location":"Hacking%20Lab/Lab_Virtual_Machines/#attacking-machine","title":"Attacking machine","text":"<p>This document assumes that the attacker uses Kali Linux. All the suggested attack tools are already installed in Kali.</p> <p>Kali can be used in one of these ways:</p> <ol> <li>Native operating system. This is the less hardware-demanding option. In this case the network configuration for the metasploitable3 VM is more complex (see below).</li> <li>VM in VirtualBox. This is the scenario used as a reference in this document.  Many websites describe how to install a Kali VM on VirtualBox (see also section Useful links below).</li> <li>VM in WSL2 (Windows subsystem for Linux). This is similar to 2 except that some of the suggested attack tools (e.g., metasploit, hashcat) will have to be installed separately, because the Kali distribution available for WSL2 is a minimal distribution.</li> </ol> <p>Parrot OS is an alternative to Kali. It is a Linux distribution very similar to Kali that requires less memory and less secondary storage.</p>"},{"location":"Hacking%20Lab/Lab_Virtual_Machines/#virtualbox-configuration","title":"VirtualBox configuration","text":"<p>My suggested configuration is as follows:</p> <ul> <li>VirtualBox</li> <li>Metasploitable3 Windows VM as attacked machine.</li> <li>Kali (or Parrot OS) VM as attacker machine.</li> </ul> <p>Both VMs should be configured as \u201cNAT network\u201d and part of the same network. With this network configuration the VMs (guests) will be able to communicate between themselves. Their servers will not be reachable from the PC running VirtualBox (host) nor from the external network. The VMs will be able to access the host and the external network as clients.</p> <p>Special cases:</p> <ul> <li>A better network configuration for the VMs would be \u201cinternal network\u201d with both VMs connected to the same (internal) network. In this way, the VMs would be fully isolated from the host and from the external network. Configuring the metasploitable3 VM for this network configuration is more difficult, though, because the scripts available in the Github repository configure the VM for the \u201cNAT network\u201d case and would have to be modified (which is not straightforward).</li> <li>If the attacker machine is not a VM running on VirtualBox (that is, options 1 or 3 above) the VirtualBox network configuration for metasploitable3 should enable \u201cport forwarding\u201d, to make their services visible to the attacker (i.e., to make the servers on the guest o.s. reachable from the host o.s.). There are many ports that will have to be enabled. To find the corresponding list, search for \u201cmetasploitable3 enumeration\u201d or a similar term.</li> </ul>"},{"location":"Hacking%20Lab/Lab_Virtual_Machines/#useful-links","title":"Useful links","text":"<ul> <li>VirtualBox network configuration manual.</li> <li>Guides and tutorials on VirtualBox network configuration: one and two.</li> <li>Lab - Virtual Machines on this website about VirtualBox and VirtualBox networking.</li> <li>Installing Kali Linux on a VM on VirtualBox.</li> <li>WSL2 (Windows Linux Subsystem): best practice and Kali Metapackages.</li> </ul>"},{"location":"Hacking%20Lab/Lab_Virtual_Machines/#virtualbox-in-a-nutshell","title":"VirtualBox in a nutshell","text":""},{"location":"Hacking%20Lab/Lab_Virtual_Machines/#virtual-machines","title":"Virtual Machines","text":"<p>A virtual machine (VM) is a computer emulated in software. This computer has a filesystem, RAM memory, keyboard, network interfaces and so on. All these resources are emulated in software by a dedicated program called hypervisor. The hypervisor runs on a (real) computer. VirtualBox, discussed in more detail below, is a freely available hypervisor that can run on Windows, Linux, MacOS.</p> <p>A VM runs an operating system, like any other computer. Creation, bootstrap and shutdown of a VM is done through the hypervisor. </p> <p>For example, you could run VirtualBox on Windows and then have a Linux VM running on that VirtualBox. You could have many VMs defined in VirtualBox and run them at different times. You may also run several VMs simultaneously, the performance being obviously limited by the hardware resources of the machine that runs the hypervisor.</p> <p>Before creating a VM you need a file in ISO format containing the installation image of an operating system. This file must be stored on the machine where the hypervisor runs. The first time you launch the VM you install the operating system on that VM from this image.</p> <p>While a VM is running, its screen will be shown in a window of the machine where the hypervisor runs. Upon a bootstrap, all the permanent state of the VM (files, configurations) will be the same as it was upon the last shutdown. </p> <p>The filesystem of a VM, as well as any secondary storage required by its operating system, is stored on the filesystem of the machine that runs the hypervisor, in a (large) file managed by the hypervisor itself.</p> <p>Resources of VMs are fully isolated from each other, like real machines. For example, a malware on a VM may encrypt the entire filesystem of that VM; it cannot operate on files of other VMs or on files of the machine that runs the hypervisor. The technical details for ensuring this isolation, implemented through the hypervisor, are very complex.</p> <p>Each VM is called guest; the physical machine that runs the hypervisor is called host.</p> <p></p> <p>VirtualBox. Two VMs defined, both not running.</p> <p></p> <p>Two VMs running on a Windows PC. Kali VM on the left (desktop shows a shell window and a Wireshark window), Metasploitable3 Windows Server 2008 on the right (desktop shows a shell window and a file explorer window).</p>"},{"location":"Hacking%20Lab/Lab_Virtual_Machines/#networks-in-virtualbox","title":"Networks in VirtualBox","text":"<p>In VirtualBox each VM can have up to 4 network interfaces. Usually, each interface has a private IP address, dynamically allocated by a DHCP server implemented by VirtualBox.</p> <p>The VMs defined in a given VirtualBox installation can be organized in many different networking architectures, by associating each network interface with one of the available networking modes. This operation is done through the \u201cNetwork settings\u201d of the VM.  Networking modes in VirtualBox are quite complex, we provide here only the background necessary for the  Hacking Lab.</p> <p>By default, a VM uses one network interface in \u201cNAT mode\u201d (this configuration is described at the end of this section).</p> <p>The default configuration is not suggested for the Hacking Lab. The suggested configuration is:</p> <ul> <li>network interface of each VM in \u201cNAT network mode\u201d;</li> <li>one \"NAT network\" defined in VirtualBox (VirtualBox requires each such network to have a name; I have used \"NATNetwork\" in the screenshot below);</li> <li>both VMs connected to that network (see next image).</li> </ul> <p></p> <p>Network settings of the Kali VM. Those of the metasploitable3 VM are identical.</p> <p>With this configuration, </p> <ul> <li>Each VM has client access to the host and to the external network, through a NAT module implemented by VirtualBox.</li> <li>VMs can communicate between themselves.</li> </ul> <p></p> <p>NAT network (two VMs connected to the same network).</p> <p>With the default network configuration (not suggested), each VM is in \"NAT mode\". In this way VMs cannot communicate between themselves. Furthermore:</p> <ul> <li>All VMs are given the same IP address and the respective default gateways all have the same IP address.</li> <li>Server access to a VM is possible only by enabling port forwarding in the NAT module of VirtualBox. Port forwarding defines whether a given port number is managed by the host or by one of the VMs. Port forwarding is defined in the network settings of each VM rather than globally. If a given port number is forwarded to multiple VMs then malfunctioning will occur (usually the traffic will reach only the VM that starts first).</li> </ul> <p></p> <p>NAT mode (default). </p>"},{"location":"Hacking%20Lab/Lab_Virtual_Machines/#windows-setup-in-a-nutshell","title":"Windows setup in a nutshell","text":"<p>(Courtesy of Mauro Farina)</p>"},{"location":"Hacking%20Lab/Lab_Virtual_Machines/#metasploitable3","title":"Metasploitable3","text":"<ol> <li>Download and install Vagrant: https://developer.hashicorp.com/vagrant/docs/installation<ol> <li>260 MB download</li> </ol> </li> <li> <p>Once installed:</p> <pre><code># Windows\nmkdir metasploitable3-workspace\ncd metasploitable3-workspace\nInvoke-WebRequest -Uri \"https://raw.githubusercontent.com/rapid7/metasploitable3/master/Vagrantfile\" -OutFile \"Vagrantfile\"\n# Linux\nmkdir metasploitable3-workspace\ncd metasploitable3-workspace\ncurl -O https://raw.githubusercontent.com/rapid7/metasploitable3/master/Vagrantfile\n</code></pre> </li> <li> <p>To create the Metasploitable Windows Server VM, run</p> <pre><code>vagrant up win2k8\n</code></pre> </li> <li> <p>Once that\u2019s done, you should see a metasploitable3 VM within Oracle VM VirtualBox</p> </li> <li>Windows Server VM username/pwd: vagrant/vagrant</li> </ol>"},{"location":"Hacking%20Lab/Lab_Virtual_Machines/#kali-linux","title":"Kali Linux","text":"<ol> <li>Download Kali Linux VM image https://www.kali.org/get-kali/#kali-virtual-machines<ol> <li>3 GB download</li> </ol> </li> <li>Extract files<ol> <li>might take a couple of minutes</li> </ol> </li> <li>Move folder to <code>C:/users/YOUR_NAME/VirtualBox VMs</code></li> <li>From Oracle VM VirtualBox: Add \u2192 kali-linux-folder \u2192 file .vbox</li> <li>Kali Linux VM user/pwd: kali/kali</li> </ol>"},{"location":"Hacking%20Lab/Lab_Virtual_Machines/#vm-virtualbox-create-nat-network","title":"VM VirtualBox - Create NAT Network","text":"<ol> <li>File \u2192 Tools \u2192 Network Manager</li> <li>NAT Networks</li> <li>Create</li> </ol>"},{"location":"Hacking%20Lab/Vulnerable%20Platforms/","title":"Vulnerable Platforms","text":"<p>Investing time on the topics listed below may be very useful and very interesting.</p> <p>It is certainly very dangerous for a student whose priority is to pass exams, though.</p> <p>Keep track of your time carefully.</p>"},{"location":"Hacking%20Lab/Vulnerable%20Platforms/#learning-labs","title":"Learning labs","text":"<p>There are many platforms on the web for learning and practicing attack skills, at various complexity levels. Some of them are free, some others require paid subscriptions.</p> <ul> <li>Tryhackme</li> <li>Hack The Box</li> <li>Vulnhub Labs</li> <li>Vulnlab</li> <li>Root-me</li> </ul>"},{"location":"Hacking%20Lab/Vulnerable%20Platforms/#writeups","title":"Writeups","text":"<p>You might want to search on the web writeups specific to some of the vulnerable VMs available. A writeup is a written summary of the steps taken for attacking a certain VM. In many cases reading such writeups provides an interesting and useful learning experience.</p> <p>Reading such writeups may often be complex and frustrating, however: they are often written with a very concise style, assuming that the reader is an expert; there are many technical details very important in practice but irrelevant for understanding the underlying problem.</p> <ul> <li>Vulnhub-CTF-Writeups This cheatsheet is aimed at beginners to help them sort Vulnhub Labs. This list contains all the writeups available. </li> <li>Hack the Box Write-ups A collection of write-ups and walkthroughs of my adventures on Hack the Box.</li> <li>Large collection of writeups for VMs on Tryhackme, Hack The Box, Vulnhub, Vulnlabs and other platforms.</li> <li>Metasploitable 3: Ubuntu walkthrough and Windows walkthrough.</li> </ul>"},{"location":"Labs/Automated%20Malware%20Analysis/","title":"Automated Malware Analysis","text":"<ul> <li>Create an account on Triage and an account on MalwareBazaar.</li> <li>Malware samples are usually zipped and protected by a password. The password conventionally used in this context is 'infected'.</li> <li>Keep in mind that malware samples may be dangerous. Make sure you do not give them any opportunity to run (the best approach is to use a local virtual machine, handle malware samples only in that VM and then dispose the VM at the end).</li> </ul>"},{"location":"Labs/Automated%20Malware%20Analysis/#triage","title":"Triage","text":"<p>Triage is a platform for automated malware analysis. You:</p> <ol> <li>upload a malware sample;</li> <li>select an architecture for the sandbox (a virtual machine whose input and output devices are automatically instrumented and observed);</li> <li>select other analysis parameter, e.g., a time interval for observing the execution behavior;</li> <li>start the automated analysis.</li> </ol> <p>Execution lasts for a predefined amount of time. By default it runs unattended, i.e., without any user interaction. It is possible to select a random mouse movement as well as to interact directly with the running malware.</p> <p>At the end of the execution you will obtain:</p> <ul> <li>A detailed report. Understanding all details of those reports is difficult and requires very specific knowledge. Be prepared to spend some time with search engines and do not expect to understand everything.  </li> <li> <p>A set of numerical scores.</p> <ul> <li>A static score, based on an analysis of the file content, without executing it.</li> <li>A dynamic score for each selected sandbox. This score is based on an analysis of the file execution behavior in the selected sandbox. The analysis looks at predefined behavioral signatures, reputation of contacted domains/IPs and so on. </li> <li>A global score that summarizes all the assigned scores.</li> </ul> </li> </ul> <p>Keep in mind that automated execution of a malware sample may or may not trigger the malicious behavior:</p> <ul> <li>A malware may try to detect whether it is running within a sandbox, in which case it might not activate its malicious behavior.</li> <li>A malware may activate its malicious behavior depending on the occurrence of specific input events. For example, if a user is not clicking on certain buttons, nothing is typed on the keyboard and so on, then the malicious behavior is not triggered.</li> </ul>"},{"location":"Labs/Automated%20Malware%20Analysis/#analyze-malwarebazaar-samples","title":"Analyze MalwareBazaar samples","text":""},{"location":"Labs/Automated%20Malware%20Analysis/#agenttesla","title":"AgentTesla","text":"<p>Have a look at this report, publicly available from Triage (the static and the sandbox reports are listed in the upper part of the page).</p> <p>Try to understand:</p> <ul> <li>Which attack campaigns have been linked to the name that Triage has associated with the malware sample (just use a search engine).</li> <li>Which \"signatures\", i.e., malicious/suspicious behaviors have been observed.</li> <li>Which tactics/techniques are associated have been associated with this sample.</li> <li>Which domains/IPs have been contacted (you may want to investigate these domains/IPs on Alienvault and/or Greynoise; see Malware - Resources)</li> </ul>"},{"location":"Labs/Automated%20Malware%20Analysis/#a-less-known-malware","title":"A less known malware","text":"<ul> <li>Download from MalwareBazaar the sample whose hash is <code>8404d3dc32b0555bc3b076d7fc080d2a341508b4a2c84805a1d5ffc0057e2b39</code></li> <li>Upload that sample to Triage.</li> <li>Execute an analysis and try to understand its output.</li> </ul>"},{"location":"Labs/Automated%20Malware%20Analysis/#another-less-known-malware","title":"Another less known malware","text":"<ul> <li>Repeat the above for this MalwareBazaar sample:  <code>a43e0864905fe7afd6d8dbf26bd27d898a2effd386e81cfbc08cae9cf94ed968</code></li> <li>If the score is not very high (&gt;9) then execute the analysis again, this time by interacting with the execution and click 'Next' when OneNote asks you to do so.</li> </ul>"},{"location":"Labs/Automated%20Malware%20Analysis/#compare-to-another-analysis-platform","title":"Compare to another analysis platform","text":"<p>Maybe the malware samples above have been submitted to other platforms... - Search one or more of the above file hashes in VirusTotal (search tab). - Compare the outcome of the analysis to those you obtained on Triage.</p>"},{"location":"Labs/BURP/","title":"BURP","text":""},{"location":"Labs/BURP/#burp-in-a-nutshell","title":"Burp in a nutshell","text":"<p>Burp is a tool for web application security testing. It comes in three versions, one of them (\u201cCommunity\u201d) is free. It is installed on the local desktop and consists of an HTTP proxy with a graphical interface for  analyzing and modifying traffic.</p>"},{"location":"Labs/BURP/#browsing-through-burp","title":"Browsing through Burp","text":"<p>You can use the browser embedded in Burp (Proxy\u2192Intercept\u2192Open browser) or use an external browser. If using an external browser, then some manual configuration steps are needed on the device where Burp is installed:</p> <ol> <li>Web navigation has to pass through Burp proxy.</li> <li>A self-signed certificate for Burp has to be installed in the certificate store of the device where Burp has been installed in order to enable Burp to act as a certification authority. Upon connecting to an HTTPS website, the browser will connect to Burp, that Burp will generate a public-private keypair and a certificate for the public key just generated.</li> </ol>"},{"location":"Labs/BURP/#basic-usage","title":"Basic usage","text":"<p>While browsing, Burp records all the HTTP traffic.</p> <p>Whenever you see an HTTP request in any section of the Burp interface, you can send that HTTP request to the web site again, by right clicking on the mouse. You can also select groups of requests and, in some sections of the interface, edit the HTTP request before sending it again.</p> <p>Burp constructs a map of the web site based on the recorded HTTP traffic (Target\u2192Site map). Black items are those that have been actually requested while gray items are those that have been inferred from the observed traffic, e.g., links not yet clicked. The professional versions have functionalities for automatic spidering, i.e., for automatically visiting the entire web site and constructing the corresponding site map. </p> <p>When faced with an unknown application, the common workflow consists of:</p> <ol> <li>Interacting with the application in order to collect HTTP traffic and populate the site map.</li> <li>Analyze the traffic in search of potentially critical issues that deserve further analysis and investigation.</li> </ol> <p>Many videos and tutorials on Burp can be found on YouTube. They all assume some basic knowledge of web application security. A video that I think is quite good as an introductory resource is Testing for IDOR Vulnerabilities with Burpsuite.</p>"},{"location":"Labs/BURP/#key-functionalities","title":"Key functionalities","text":"<ul> <li>Proxy\u2192Intercept can be toggled on or off. When off, you can browse normally. When on, each request is stopped by Burp and sent to the web site only upon clicking the Forward button, possible after modifying the request content.</li> <li>Proxy\u2192HTTP history keeps track of all the traffic passed through Burp, even while Intercept is off.</li> <li>Proxy\u2192Options allows specifying rules for defining:</li> <li>Which requests or responses are stalled for viewing and editing.<ul> <li>Example: stall only requests that contain parameters.</li> </ul> </li> <li>Which of a set of predefined modifications are to be applied to responses automatically.<ul> <li>Example: replace HTTPS links with HTTP links.</li> </ul> </li> <li>Match-Replace rules for modifying requests or responses automatically.<ul> <li>Example: modify the value of User-Agent headers in requests; strip the Strict-Transport-Security headers from responses.</li> </ul> </li> <li>Inspector allows analyzing messages and items found in messages, e.g., for decoding content as well as for editing and applying the relevant encoding automatically.</li> <li>Repeater allows modifying and sending selected HTTP requests repeatedly. An HTTP request is used as a template; modifications can be described by specifying a portion of the template to be modified at each iteration and the set of values to be used for that portion (e.g., a range of numerical integers, a set of predefined words and alike).</li> </ul>"},{"location":"Labs/BURP/#my-introductory-slides","title":"My introductory slides","text":"<p>You can find them here</p>"},{"location":"Labs/MITRE_ATTACK_Navigator/","title":"MITRE ATT&amp;CK NAVIGATOR.","text":"<p>We will use the hosted webapp. The webapp sources are public domain. The webapp could be hosted locally, which may be useful if one did not want to disclose any analysis to anyone.</p> <p>We will assess the defensive usage of multi-factor authentication (MFA) against two recent and highly relevant campaigns:</p> <ul> <li>CUBA ransomware campaign: CISA alert</li> <li>HIVE ransomware campaign: CISA alert</li> </ul> <p>The <code>help</code> button of NAVIGATOR seems quite useful.</p>"},{"location":"Labs/MITRE_ATTACK_Navigator/#demo-and-report","title":"Demo and report","text":"<p>In the lectures I pointed out that some \"analysis\" of \"some manually constructed layers\" may be enough for the demo and report required for the exam. Such a simple demo is very unlikely to be assigned a grade increment.</p> <p>Idea for a more complex activity (which would likely receive a significant grade increment): development of a tool that:</p> <ol> <li>Takes a technical report or blog post as input (perhaps its URL);</li> <li>Extracts the mentioned ATT&amp;CK techniques (for example by means of a regular expression that matches technique identifiers)</li> <li>Construct a Navigator layer that summarizes the corresponding report (layers are internally represented in <code>json</code>);</li> </ol> <p>Automated activities of this kind, with a much higher level of scale and complexity, are often used by specialized companies. </p>"},{"location":"Labs/MITRE_ATTACK_Navigator/#layers","title":"Layers","text":"<p>A layer is a set of annotated techniques, where an annotation can consist of one or more of: background color; textual description, possibly including an URL; numerical score and more.</p> <p>Such a set may describe the techniques relevant for a specific attack campaign, for a specific software, for a specific data source, for a specific mitigation, as well as any combination of them.</p> <p>One can instruct the NAVIGATOR webapp to:</p> <ul> <li>start from an empty layer;</li> <li>load a layer from a file or from an URL;</li> <li>construct a layer by combining the numerical scores assigned to techniques of other layers already loaded in the webapp.</li> <li>select all the techniques relevant to a specific category of the ATT&amp;CK framework (threat group, software, mitigation and alike; magnifying glass button in the \"selection controls\" section).</li> </ul> <p></p> <p>After working on a layer, one can save the resulting layer in a file for later usage or distribution.</p> <p>Each technique is linked to the corresponding page of the MITRE ATT&amp;CK framework, that describes the technique along with detections, mitigations and alike. The link can be found in the menu that appears by clicking the right button on the technique.</p>"},{"location":"Labs/MITRE_ATTACK_Navigator/#understanding-background-colors","title":"Understanding background colors","text":"<p>Background colors can be assigned to techniques in two ways:</p> <ol> <li>Individually, to each mouse-selected(s) technique (color button in the \"technique controls\" section).</li> <li>Globally, based on the numerical score possibly assigned to a technique (gradient color button in the \"layer controls\" section).</li> </ol> <p>The gradient color button allows selecting:</p> <ul> <li>a minimum and maximum score values;</li> <li>a number of intervals;</li> <li>a color for each interval;</li> </ul> <p>This way, one can grasp quickly how scores are distributed across techniques.</p> <p>Criterion 1 takes priority over criterion 2: if a background color has been chosen for a technique, then the gradient color based on the score will not be applied to that technique.</p>"},{"location":"Labs/MITRE_ATTACK_Navigator/#lab","title":"Lab","text":""},{"location":"Labs/MITRE_ATTACK_Navigator/#load-existing-layers","title":"Load existing layers","text":"<p>To save time, the layers required for this activity have been prepared already and can be uploaded in the webapp (read the Warning section below!).</p> <ul> <li>Create new layer from existing CUBA layer (CUBA json)</li> <li>Create new layer from existing HIVE layer (HIVE json)</li> <li>Create new layer from existing MFA layer (MFA json)</li> </ul> <p>Each layer consists of a set of techniques annotated with a background color and without any score.</p> <p>After loading a layer, click on the \"expand annotated sub-techniques\" button in the layer controls section. You will see that some layers use sub-techniques that would not be visible without such an expansion </p>"},{"location":"Labs/MITRE_ATTACK_Navigator/#define-scores-for-each-layer","title":"Define scores for each layer","text":"<p>In each layer, assign a score to each technique selected in that layer. This can be done with the score button in the \u201ctechnique controls\u201d section. You may want to select multiple techniques (mouse+shift) and then assign the same score to all the selected techniques.</p> <p>In general, one could assign different scores to different techniques. In this exercise we will assign the same score to all the selected techniques in a given layer:</p> <ul> <li>CUBA 5</li> <li>HIVE 5</li> <li>MFA 20</li> </ul> <p>Note that numerical scores are not immediately visible: to see the score of a specific technique, one has to select that technique with the mouse and the click on the score button in the \"technique controls\" section.</p>"},{"location":"Labs/MITRE_ATTACK_Navigator/#create-new-layer-from-the-three-existing-layers","title":"Create new layer from the three existing layers","text":"<p>Create a new tab (press +).</p> <p></p> <p>Then select \u201ccreate layer from other layers\u201d and in the \u201cscore expression\u201d field define a sum of the three previously loaded layers (probably it will be \u201ca + b + c\u201d and probably you will need to insert a space in between operands and operators).</p> <p>Do not insert anything in the other fields (in particular, do not define any gradient or coloring at this stage).</p> <p></p> <p>At this point you will have a new layer in which each technique will be automatically given a score that is the sum of the score of the three other layers.</p> <p>With the values suggested in the previous section there will be these possible scores:</p> <ul> <li>5 Technique used by one attack campaign and not mitigated by MFA</li> <li>10 Technique used by both attack campaigns and not mitigated by MFA</li> <li>20 Technique not used by any of the attack campaigns and mitigated by MFA</li> <li>25 Technique used by one attack campaign and mitigated by MFA</li> <li>30 Technique used by both attack campaign and mitigated by MFA</li> </ul>"},{"location":"Labs/MITRE_ATTACK_Navigator/#define-a-gradient-color-in-the-newly-created-layer","title":"Define a gradient color in the newly created layer","text":"<p>Define a gradient color criterion that allows understanding the scores of interest quickly :</p> <ul> <li>5 or 10:  used in the attack campaigns but uncovered by MFA</li> <li>20:       covered by MFA but not used in the attack campaigns</li> <li>25 or 30: used in the attack campaigns and covered by MFA</li> </ul> <p>Save layer for later use (buttons in \u201clayer controls\u201d section; excel or json, the latter can be loaded in the tool later).</p>"},{"location":"Labs/MITRE_ATTACK_Navigator/#analyze-results","title":"ANALYZE RESULTS","text":"<p>You will see that MFA does provide some mitigation against several of the techniques used in the considered attack campaigns but not all.</p> <ol> <li>Consider the uncovered technique in \u201cCommand and Control\u201d.</li> <li>Locate that technique in https://attack.mitre.org/matrices/enterprise/.</li> <li>Read the suggested detections and mitigations carefully.</li> <li>For each of them<ol> <li>Do you know it?</li> <li>Is it implemented in our environment?</li> <li>If yes, to which degree?</li> </ol> </li> <li>Consider the uncovered technique in \u201cPrivilege Escalation\u201d.</li> <li>Repeat the above analysis.</li> </ol>"},{"location":"Labs/MITRE_ATTACK_Navigator/#further-activities-if-you-want","title":"Further activities, if you want\u2026","text":"<ol> <li>Create and save  a layer for describing the Uber breach (shown in the slides).</li> <li>Analyze effectiveness of MFA for this specific breach.</li> <li>Analyze effectiveness of MFA for this breach, CUBA and HIVE together.</li> </ol>"},{"location":"Labs/MITRE_ATTACK_Navigator/#attck-calculator","title":"ATT&amp;CK CALCULATOR","text":"<p>Objective: Grasp an idea of which mitigations and detections could be most needed in our environment.</p> <p>We will use the hosted webapp. The webapp sources are not public domain.</p> <ol> <li>Select the input combination that, in your opinion, is most relevant to our environment (or to your view of our environment).</li> <li>Generate results (results can be downloaded in json, but the format is not recognized by the Navigator).</li> <li>Consider the 3 detections and 3 mitigations that are suggested as being most relevant. Read their definitions carefully.</li> <li>For each of them:<ol> <li>Do you know it?</li> <li>Is it implemented in our environment?</li> <li>If yes, to which degree?</li> </ol> </li> </ol>"},{"location":"Labs/OWASP%20Juice%20Shop/","title":"OWASP Juice Shop","text":""},{"location":"Labs/OWASP%20Juice%20Shop/#owasp-juice-shop","title":"OWASP Juice Shop","text":"<p>It is a web application that has been developed by the OWASP consortium for practicing web application security testing. It ontains many vulnerabilities of different nature. It also contains detection code that displays a \u201cvulnerability found\u201d banner whenever it detects that the user has managed to exploit one of the numerous vulnerabilities of the webapp.</p> <p>OWASP has made the sources available and the webapp itself has to be installed and deployed on a web server in order to be actually used. An almost one-click and free deployment on a cloud platform can be obtained quite easily (see \u201cResources\u201d below).</p>"},{"location":"Labs/OWASP%20Juice%20Shop/#resources","title":"Resources","text":"<p>Many videos and tutorials are available on the web that describe this webapp. Keep in mind that these resources:</p> <ul> <li>Do not describe the internal architecture of the webapp.</li> <li>Assume some basic knowledge of web application security.</li> <li>Do not provide a full step-by-step guide for detecting all the vulnerabilities of the webapp.</li> <li>Have an extremely (excessive) practical orientation: the focus is not \u201cunderstand what you are doing\u201d; it is \u201clet the application display the \u201cvulnerability found\u201d banner\u201d.</li> </ul>"},{"location":"Labs/OWASP%20Juice%20Shop/#general-descriptions","title":"General descriptions","text":"<ul> <li>Official companion of the OWASP Juice Shop webapp General overview of the webapp.</li> <li>List of vulnerabilities along with their difficulty and hints about how to discover them.</li> <li>Detailed solutions</li> <li>Instructions for running the webapp <ul> <li>One-click deployment on the free cloud platform Heroku. If you do so, remember to deactivate the webapp on Heroku while it is not used, in order to not use Heroku resources unnecessarily (Resources section of your Heroku account; just stop the corresponding \u201cDyno\u201d)</li> <li>UPDATE DECEMBER 2022: Heroku is no longer free but requires a small subscription fee. Gitpod provides the same functionality of one-click deployment with a free tier that is renewed each month automatically. Follow the instructions above; remember to \u201cstop\u201d the workspace while not in use (to not consume your credits) and to \u201cpin\u201d the workspace (otherwise it will be deleted after 30 days of inactivity).</li> </ul> </li> </ul>"},{"location":"Labs/OWASP%20Juice%20Shop/#writeups","title":"Writeups","text":"<p>Blog posts listing solutions to some of the challenges (vulnerabilities found):</p> <ul> <li>Tryhackme - OWASP Juice Shop walkthrough</li> <li>Tryhackme - OWASP Juice Shop walkthrough (2)</li> <li>Tryhackme - OWASP Juice Shop walkthrough (3)</li> </ul>"},{"location":"Labs/OWASP%20Juice%20Shop/#technical-notes","title":"Technical notes","text":""},{"location":"Labs/OWASP%20Juice%20Shop/#authentication-in-owasp-juice-shop","title":"Authentication in OWASP Juice Shop","text":""},{"location":"Labs/OWASP%20Juice%20Shop/#bearer-tokens-explained","title":"Bearer Tokens Explained","text":"<p>Authentication in the OWASP Juice Shop webapp is managed differently from how we described it in \u201cComputer Networks 1\u201d and is based on JSON Web Tokens. This is a widely used mechanism specified by a  web standard called OAuth and briefly summarized below.</p> <p>Web sessions are associated with cookies. In principle, once a session is authenticated (i.e., a correct username-password pair has been provided in the login form), the cookie identifier should suffice to prove the identity of the user. That is, a webapp that receives a request determines the identity of the sending user based on the value of the <code>Cookie</code>header, by using this value as a key for accessing a table stored in the webapp that contains the full session state including the username. Many webapps implement authentication based on cookies.</p> <p>Many other webapps encode instead the authentication information in an additional header called <code>Authorization</code>, whose value is <code>Bearer</code>followed by a bearer token.</p> <p>A bearer token is a \u201cvery long string\u201d constructed by a webapp upon receiving a successful login request. The content of this string is not meaningful to clients. Whenever the webapp receives an HTTP request, it determines the identity of the user from the web token in the <code>Authorization</code>header, rather than from the value of the <code>Cookie</code>header. The validity time interval of a bearer token is independent of the lifetime of the HTTP session, thus of the cookie.</p> <p>Of course, bearer tokens must be managed so that users cannot forge or modify them arbitrarily (i.e., bearer tokens must have authenticity and integrity; and, the webapp must be able to verify these security properties of each received bearer token).</p> <p>Based on this description, one might think of bearer tokens as just cookies sent with a different header. There are actually many deep but complex differences between the two mechanisms that are beyond the scope of this document.</p>"},{"location":"Labs/OWASP%20Juice%20Shop/#bearer-tokens-in-owasp-juice-shop","title":"Bearer Tokens in OWASP Juice Shop","text":"<p>The OWASP Juice Shop webapp uses bearer tokens for authentication. However, this use does not follow the OAuth specification completely  and is insecure. In detail:</p> <ol> <li>Data inserted in the login form are not sent with the standard HTML mechanism, i.e., as an entity that consists of query string encoded as <code>Content-Type: x-www-form-urlencoded</code>; the entity consists instead of JSON data (<code>Content-Type: application/json</code>). This is managed by Javascript code in the browser, i.e., clicking on the form button results in invoking some Javascript code; this code will collect the user-provided data, assemble it in a JSON entity and send this entity to the webapp.</li> <li>Bearer tokens are returned in the response to the request containing the credentials inserted in the login form (rather than with a standard, more complex OAuth flow).</li> <li>Bearer tokens contain the username of the token owner and the corresponding password hash.</li> </ol> <p>Regarding point 2, there is no reason whatsoever for including username and password hash in the token. At first glance, this might not seem a risk: the token for a user will be visible only to that user, because the traffic is on HTTPS and the bearer token is only sent in response to a login form.</p> <p>However, if the webapp had a vulnerability allowing a user A to login as user B, then user A would access the bearer token for user B. Thus, user A would obtain the password hash for user B and would thus be able to impersonate user B forever.</p> <p>As it turns out, OWASP Juice Shop has this vulnerability (see Question #1 here): A can login as B (because of this vulnerability) and thus A can impersonate B forever (because of the insecure implementation of bearer tokens).</p>"},{"location":"Labs/OWASP%20Juice%20Shop/#example-traffic","title":"Example traffic","text":""},{"location":"Labs/OWASP%20Juice%20Shop/#login","title":"Login","text":"<p>Credentials are sent as a JSON resource in the request. The response contains a bearer token.</p> <p>*Request*</p> <pre><code>POST /rest/user/login HTTP/1.1\nHost: owasp-juice-shop-alberto.herokuapp.com\nCookie: language=en; welcomebanner_status=dismiss; cookieconsent_status=dismiss; continueCode=KQabVVENkBvjq9O2xgyoWrXb45wGnmTxdaL8m1pzYlPQKJMZ6D37neRqyn3x\n...\nContent-Type: application/json\n...\n\n{\"email\":\"1@1.com\",\"password\":\"11111\"}\n</code></pre> <p>Response</p> <pre><code>HTTP/1.1 200 OK\n...\nContent-Type: application/json; charset=utf-8\nContent-Length: 808\nEtag: W/\"328-+1bdmcgdtIFfafMn3oEmj38Axmo\"\n...\n\n{\n\"Authentication\":\n    {\"token\":\n    \"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJzdGF0dXMiOiJzdWNjZXNzIiwiZGF0YSI6eyJpZCI6MjEsInVzZXJuYW1lIjoiIiwiZW1haWwiOiIxQDEuY29tIiwicGFzc3dvcmQiOiJiMGJhZWU5ZDI3OWQzNGZhMWRmZDcxYWFkYjkwOGMzZiIsInJvbGUiOiJjdXN0b21lciIsImRlbHV4ZVRva2VuIjoiIiwibGFzdExvZ2luSXAiOiIwLjAuMC4wIiwicHJvZmlsZUltYWdlIjoiL2Fzc2V0cy9wdWJsaWMvaW1hZ2VzL3VwbG9hZHMvZGVmYXVsdC5zdmciLCJ0b3RwU2VjcmV0IjoiIiwiaXNBY3RpdmUiOnRydWUsImNyZWF0ZWRBdCI6IjIwMjEtMDgtMjkgMTc6NDE6MDIuNTY2ICswMDowMCIsInVwZGF0ZWRBdCI6IjIwMjEtMDgtMjkgMTc6NDE6MDIuNTY2ICswMDowMCIsImRlbGV0ZWRBdCI6bnVsbH0sImlhdCI6MTYzMDI1ODg3MiwiZXhwIjoxNjMwMjc2ODcyfQ.vMIu5yD-VJux8FspwslykpET009gEYsIoYhb1azL62dIoeRIYFd2AX8wR6_RJrXDPgluwB9ra0QO2Wk9GA5LhadfCkfxxXB-Kgb7XjXzIWo6sxqDfAjza_Yt8mUevv3yIU84RHHpxDFFn0jtZnIAY90ZE5gmxvChOWIwWvLg3XA\",\n\n    \"bid\":6,\n    \"umail\":\"[1@1.com](mailto:1@1.com)\"\n    }\n}\n</code></pre>"},{"location":"Labs/OWASP%20Juice%20Shop/#shopping-basket","title":"Shopping Basket","text":"<p>The request carries a cookie and a bearer token (encoded in a certain format). The response contains the corresponding shopping basket described in JSON.</p> <p>Request</p> <pre><code>GET /rest/basket/6 HTTP/1.1\nHost: owasp-juice-shop-alberto.herokuapp.com\nCookie: language=en; welcomebanner_status=dismiss; cookieconsent_status=dismiss; continueCode=KQabVVENkBvjq9O2xgyoWrXb45wGnmTxdaL8m1pzYlPQKJMZ6D37neRqyn3x; ...\nAccept: application/json, text/plain, */*\nAuthorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJzdGF0dXMiOiJzdWNjZXNzIiwiZGF0YSI6eyJpZCI6MjEsInVzZXJuYW1lIjoiIiwiZW1haWwiOiIxQDEuY29tIiwicGFzc3dvcmQiOiJiMGJhZWU5ZDI3OWQzNGZhMWRmZDcxYWFkYjkwOGMzZiIsInJvbGUiOiJjdXN0b21lciIsImRlbHV4ZVRva2VuIjoiIiwibGFzdExvZ2luSXAiOiIwLjAuMC4wIiwicHJvZmlsZUltYWdlIjoiL2Fzc2V0cy9wdWJsaWMvaW1hZ2VzL3VwbG9hZHMvZGVmYXVsdC5zdmciLCJ0b3RwU2VjcmV0IjoiIiwiaXNBY3RpdmUiOnRydWUsImNyZWF0ZWRBdCI6IjIwMjEtMDgtMjkgMTc6NDE6MDIuNTY2ICswMDowMCIsInVwZGF0ZWRBdCI6IjIwMjEtMDgtMjkgMTc6NDE6MDIuNTY2ICswMDowMCIsImRlbGV0ZWRBdCI6bnVsbH0sImlhdCI6MTYzMDI1ODg3MiwiZXhwIjoxNjMwMjc2ODcyfQ.vMIu5yD-VJux8FspwslykpET009gEYsIoYhb1azL62dIoeRIYFd2AX8wR6_RJrXDPgluwB9ra0QO2Wk9GA5LhadfCkfxxXB-Kgb7XjXzIWo6sxqDfAjza_Yt8mUevv3yIU84RHHpxDFFn0jtZnIAY90ZE5gmxvChOWIwWvLg3XA\n...\nAccept-Language: en-US,en;q=0.9\n</code></pre> <p>Response</p> <pre><code>HTTP/1.1 200 OK\n...\nContent-Type: application/json; charset=utf-8\nContent-Length: 154\nEtag: W/\"9a-1IBRCZ5Q9/JL7raf23dCq8reO7A\"\n...\n\n{\n    \"status\":\"success\",\n    \"data\":\n    {\n    \"id\":6,\n    \"coupon\":null,\n    \"createdAt\":\"2021-08-29T17:41:11.950Z\"\n    \"updatedAt\":\"2021-08-29T17:41:11.950Z\"\n    \"UserId\":21,\n    \"Products\":[]\n    }\n}\n</code></pre>"},{"location":"Labs/OWASP%20Juice%20Shop/#bearer-token-in-decoded-form","title":"Bearer token in decoded form","text":"<p>By copying the above bearer token on the decoding facility on https://jwt.io/ we obtain the JSON Web Token in decoded form as indicated below. Note the hash of the user password.</p> <p></p>"},{"location":"Labs/OWASP%20Juice%20Shop/#idor-vulnerability","title":"IDOR vulnerability","text":"<p>The description of IDOR (Insecure Direct Object Reference) vulnerabilities is beyond the scope of this document. Many documents can be found on the web.  A simple and quick introduction can be found here. Some real world examples:</p> <ul> <li>\"I know what you did last summer - and also what you will be doing this one\" 8 Jul. 2018.</li> <li>\"Uno studente riesce ad hackerare il sito di 18app, poi decide di collaborare\" 28 Nov. 2016</li> <li>\"Giggle; laughable security\"  10 Sep 2020.</li> </ul> <p>The OWASP Juice Shop webapp has an IDOR vulnerability: any authenticated user may read the shopping basket of any other user.</p> <p>The target shopping basket is identified by a numerical identifier. The association of a specific username with a shopping basket identifier cannot be found by exploiting this vulnerability and it may or may not be possible. In other words, one might read shopping basket <code>8</code> but determining what is the username that owns this basket or what is the shopping basket of user <code>clay@cornell.edu</code> is a different problem.</p>"},{"location":"Labs/OWASP%20Juice%20Shop/#detecting-the-vulnerability","title":"Detecting the vulnerability","text":"<p>Essentially, the procedure is as follows:</p> <ol> <li>Create two users A and B.</li> <li>Insert some items in the respective shopping baskets.</li> <li>Identify the request sent by B for reading the shopping basket. Does the request contain a parameter that probably identifies B\u2019s shopping basket?</li> <li>Identify the request sent by A for reading the shopping basket. Modify the request with the parameter found at the previous step and send the request.</li> <li>Can A see the shopping basket of B?</li> </ol> <p>This procedure can be executed in Burp easily:</p> <ul> <li>Set Intercept off.</li> <li>Open an embedded browser and create two users, say A and B (Login\u2192Not yet a customer).</li> <li>Login as A and add some items to the shopping basket.</li> <li>Inspect the HTTP history (Proxy\u2192HTTP history) and identify the HTTP request that shows the shopping basket. It is a \\ <code>GET</code> <code>/rest/basket/small-integer-A</code> \\ (e.g., <code>small-integer-A</code> might be 1 or 3 or something alike).</li> <li>Logout and then login as B</li> <li>Click on the shopping basket. Note that the shopping basket of B is empty.</li> <li>Set Intercept on.</li> <li>Reload the shopping basket</li> <li>Forward each request one by one (Proxy\u2192Intercept) until seeing \\ <code>GET /rest/basket/small-integer-B</code>.</li> <li>Replace <code>small-integer-B</code> by <code>small-integer-A.</code></li> <li>Forward this request and set Intercept off.</li> <li>You will now see the shopping basket of A although you are logged as B.</li> </ul> <p>I emphasize that this is a mistake in the code of the webapp, i.e., a vulnerability: a user must not be able to see data private of another user.</p> <p>The specific kind of this vulnerability belongs to the class described by the OWASP consortium as \u201cBroken Access Control\u201d. In the past, vulnerabilities in this class were categorized in two separate classes: \u201cInsecure Direct Object Reference (IDOR)\u201d and \u201cMissing Function Access Control\u201d.</p>"},{"location":"Labs/OWASP%20Juice%20Shop/#exploiting-the-vulnerability","title":"Exploiting the vulnerability","text":"<p>If an attacker wanted to exploit this vulnerability in a practical setting, the attacker would not know how many users are logged in and what the corresponding \u201csmall integer\u201d values are. In such a setting, thus, the attacker would have to repeatedly send <code>GET /rest/basket/small-integer-X</code>, with many different values for <code>small-integer-X</code>.  Essentially, the procedure is as follows:</p> <ol> <li>Login as A.</li> <li>Identify the request for reading the shopping basket.</li> <li>Instruct Burp to repeatedly send this request, specifying which part of the request to modify at each iteration and how.</li> <li>A will see the shopping basket of the other users currently logged in.</li> </ol> <p>This operation can be done automatically in Burp with the Intrudermodule, as follows.</p> <ul> <li>Set intercept off</li> <li>Login and click on the shopping basket.</li> <li>Inspect the HTTP history (Proxy\u2192HTTP history) and identify the HTTP request that shows the shopping basket.</li> <li>Send this request to Intruder(right-click).</li> <li>Go to the Intruder module of Burp. Select the Positions tab. A window will appear with the request just sent to this module.</li> <li>Click \u201cclear \u00a7\u201d (this is because Intruder assumes by default that the iteration should be done on cookie values).</li> <li>Specify which part of the request has to be modified at each iteration:</li> <li>Select the small integer portion of the URL; replace it with any letter (e.g., \u2018s\u2019) and click  \u201cadd \u00a7\u201d. At this point Intruder knows that it is this part of the request that has to be modified at each iteration (Figure Intruder 1).</li> <li>Specify how to modify the specified part at each iteration:</li> <li>Click on the Payloads tab and insert a set of integer values in the Payload options section (either by preparing a text file in advance or by inserting the values one by one; the professional version of Burp has more options in this respect)  (Figure Intruder 2).</li> <li>Click \u201cstart attack\u201d. At this point Intruder will repeatedly send the selected request to the webapp and will collect the corresponding responses. This traffic will notreach the browser. The traffic is shown in a new window and can be analyzed interactively  (Figure Intruder 3). Each message can be saved on a file.</li> </ul> <p> Figure Intruder 1: Request with portion to modified</p> <p> Figure Intruder 2: Payload set configured as a list of integers</p> <p></p> <p>Figure Intruder 3: Part of the response for payload 5 (shopping basket of user id 16). In this execution, all the responses have returned a status code 200, thus corresponding to an existing shopping basket. Some of those baskets are empty.</p>"},{"location":"Labs/OWASP%20Juice%20Shop/#another-idor-vulnerability","title":"Another IDOR vulnerability","text":"<p>The IDOR vulnerability previously discussed allows any authenticated user to read the shopping basket of any other user. The web app has a further IDOR vulnerability: any authenticated user may modify the shopping basket of any other user. The same limitations previously discussed regarding the difference between shopping basket identifier and username apply to this vulnerability as well.</p> <p>The steps for detecting and exploiting this vulnerability are very similar to those previously discussed, the only difference being this: rather than using the HTTP request that shows a shopping basket, one has to use the HTTP request that adds an item to a shopping basket. We omit the detailed steps for brevity.</p> <p>The two IDOR vulnerabilities discussed here are associated with different URLs and requests, thus it is not possible to tell whether they are provoked by the same coding mistake or by two different mistakes in different portions of the web app code.</p>"},{"location":"Labs/OWASP%20Juice%20Shop/#a-few-further-simple-vulnerabilities","title":"A few further simple vulnerabilities","text":""},{"location":"Labs/OWASP%20Juice%20Shop/#online-password-guessing","title":"Online password guessing","text":"<p>The admin username is <code>admin@juice-sh.op</code> (this information can be found with another vulnerability, not discussed in this document for brevity). Online password guessing can be done against this username, as follows.  </p> <ul> <li>Search \u201c<code>best1050.txt from Seclists</code>\u201d on a search engine and download the corresponding text file (a list of 1050 frequently used passwords).</li> <li>Set Intercept on</li> <li>Attempt to login by inserting the username admin@juice-sh.op and any password.</li> <li>Inspect the HTTP history and identify the HTTP request that sends the credentials (note that these are sent as a JSON resource rather than as a query string).</li> <li>Send this request to Intruder (right-click).</li> <li>Define the password as an Intruder parameter.</li> <li>Click on the Payloads tab and load <code>best1050.txt</code> in the Payload options section.</li> <li>Click \u201cstart attack\u201d. At this point Intruder will repeatedly send the selected request to the webapp by changing the password at each iteration and will collect the corresponding responses. It will take some time to try all the passwords in the selected file.</li> </ul> <p>It can be seen in Figure Intruder 4 that the request number 117 obtained a status code 200, meaning that the correct password (admin123) was found.</p> <p> Figure Intruder 4: Summary of the traffic sent by Intruder.</p> <p>This vulnerability is not a mistake in the code. It is a configuration flaw.</p>"},{"location":"Labs/OWASP%20Juice%20Shop/#sql-injection-in-login-page","title":"SQL Injection in login page","text":"<ul> <li>Open the login page.</li> <li>Insert <code>' or 1=1--</code> as username (note the single quote character <code>'</code>at the very beginning of the username) and any string as password.</li> </ul> <p>The webapp will show a successful login and the username happens to be the administrator.</p> <p>This vulnerability can be found and exploited even without using Burp. The reason is because:</p> <ol> <li>The string to be inserted in the username field is very simple: it is one of the basic SQL injection payloads that any pentester would try at the very beginning.</li> <li>The Javascript code of the login page on the browser does not constrain or modify in any way the string inserted as username.</li> </ol> <p>In a real setting, usage of Burp would be advisable in order to try many SQL injection payloads and to detect whether the string inserted as username indeed corresponds to the string actually sent by the browser to the webapp.</p>"},{"location":"Labs/OWASP%20Juice%20Shop/#sql-injection-explained","title":"SQL Injection explained","text":"<p>Irrespective of the programming language used for developing the web app, the code that validates the received credentials on the web app must execute a SQL query on its database containing usernames and passwords. To this end, the code typically executes an IF-THEN-ELSE construct in which the IF condition is a boolean expression that must evaluate TRUE only when the username in the request is a valid username and the password in the request is a valid password.</p> <p>Such an expression is often programmed in a form like this: \\ <code>IF \\ (SQL_QUERY(SELECT 'username-in-the-request' FROM \u2026 AND \u2026)) \\ THEN \u2026 ELSE ...</code></p> <p>The part of the SQL query before the AND operator makes sure the username exists, the part after the AND (not shown for brevity) makes sure the provided password is indeed the password for that username.</p> <p>The SQL semantics is such that if the SQL query returns an empty result set then it corresponds to the boolean FALSE, otherwise it corresponds to the boolean TRUE. Thus, the boolean expression will behave as expected.</p> <p>The vulnerability (coding mistake) is when the web app code takes the data inserted in the HTTP request without any prior control or \u201csanitization\u201d. Without such a control, carefully selected input strings (SQL injection payloads) might change the logical structure of the SQL query and provoke a behavior different from what expected by the developer of the web app.</p> <p>As it turns out, the OWASP Juice Shop suffers from this vulnerability in the login page. The value <code>' or 1=1--</code>  for the username has the effect of changing the structure of the the SQL_QUERY:</p> <pre><code>IF\n(SQL_QUERY(SELECT '' or 1=1--' FROM \u2026 AND \u2026))\nTHEN \u2026 ELSE ...\n</code></pre> <p>The query actually executed by the SQL engine will be:</p> <pre><code>SELECT '' or 1=1\n</code></pre> <p>because characters -- correspond to the line comment in SQL syntax, thus the query portion <code>' FROM \u2026 AND \u2026</code>will be ignored by the SQL interpreter. The query will return the boolean value TRUE irrespective of the actual content of the database, hence the check made by the web app will be satisfied and the session will be authenticated.</p> <p>The username that will be associated with the session depends on the structure of the code surrounding the query. In this case, the user id turns out to be 0 (probably the default value) and this id happens to be associated with the administrator account.</p> <p>The appendix of \u201cThe Official Companion of the OWASP Juice Shop\u201d (see section Resources) illustrates how to extract the credentials of all users and how to exfiltrate the entire database of the application by means of SQL injection.</p>"},{"location":"Labs/OWASP%20Juice%20Shop/#more-sql-injection-in-login-page","title":"More SQL Injection in login page","text":"<p>In case a username is known, it is possible to login with that username as follows:</p> <ul> <li>Open the login page.</li> <li>Insert <code>username'--</code> as username (note the single quote character <code>'</code>at the end of the username) and any string as password.</li> </ul> <p>The webapp will show a successful login with the selected username.</p> <p>In this case the SQL injection payload need not contain <code>1=1</code>. As it turns out, the code of the web app is such that the provided payload suffices to satisfy the check and to impersonate the target username.</p>"},{"location":"Lateral%20Movement%20and%20AD%20Abuse/AD_abuse/","title":"AD Abuse","text":""},{"location":"Lateral%20Movement%20and%20AD%20Abuse/AD_abuse/#ad-attack-paths","title":"AD Attack paths","text":"<ul> <li>The Phantom Menace: Exposing hidden risks through ACLs in Active Directory (Part 1) An excellent and concise description of ACLs in Active Directory (starting from what a Securable Object is) from an offensive point of view.</li> <li>BloodHound Edges Perhaps the best way for understanding the breadth and depth of AD Attack paths is looking at how many edge types exist in BloodHound. This page is very interesting because it describes how the edge could be abused, the associated technical difficulty and some operational security (OpSec) consideration.</li> <li>LDAP Queries for Offensive and Defensive Operations Basic queries for targeted Active Directory information gathering used in penetration testing (\u201clow and slow\u201d approach without BloodHound).</li> <li>Internal All The Things Active Directory and Internal Pentest Cheatsheets. Lots of useful step-by-step examples.</li> <li>Attacking Active Directory: 0 to 0. Nice description of many Windows topics, including Active Directory, Access Rights and so on.</li> </ul>"},{"location":"Lateral%20Movement%20and%20AD%20Abuse/AD_abuse/#defense-guidance","title":"Defense guidance","text":"<ul> <li>Top 10 ways of securing AD. List of most common misconfigurations that can be exploited and how to fix them. </li> <li>Total Identity Compromise: Microsoft Incident Response lessons on securing Active Directory Across all industry verticals, Microsoft Incident Response often finds similar issues within Active Directory environments. In this blog, we will be highlighting some of the most common issues seen in on-premises Active Directory environments and provide guidance on how to secure those weaknesses.</li> </ul>"},{"location":"Lateral%20Movement%20and%20AD%20Abuse/AD_abuse/#ad-security-assessment","title":"AD security assessment","text":"<p>Tools for checking common AD misconfigurations and obtain synthetic reports. - PingCastle  - Trimarc ADChecks  - Checklist A self-assessment checklist by CERT France.</p>"},{"location":"Lateral%20Movement%20and%20AD%20Abuse/AD_abuse/#bloodhound","title":"BloodHound","text":"<ul> <li>Here Be Dragons The Unexplored Land of Active Directory ACLs The original 45-minutes video at DerbyCon 2017 that introduced this tool.</li> <li>BloodHound \u2013 Sniffing Out the Path Through Windows Domains One of the many tutorials available.</li> <li>BloodHound: Six Degrees of Domain Admin The official site.</li> <li>Adalanche a tool similar to BloodHound.</li> <li>BlueHound another tool similar to BloodHound. It collects metrics similar to some available only in the paid version of BloodHound.</li> <li>Introducing Slinky Cat - Living off the AD Land Help security and IT teams reduce their AD exposures and uncover quick wins and fixes designed for pen-testers and defenders alike.</li> </ul>"},{"location":"Lateral%20Movement%20and%20AD%20Abuse/AD_abuse/#bloodhound-tools","title":"BloodHound Tools","text":"<ul> <li>Dealing with large BloodHound datasets. Discusses other tools similar to BloodHound, including BlueHound.</li> <li> <p>BloodHound tools.</p> <ul> <li>ShotHound: Validate practical paths discovered by BloodHound.</li> <li>Ransomulator: Simulate ransomware-like infection in your dataset.</li> <li>DBCreator: Simulate BloodHound dataset, along with \"Open\" network access edges and unpatched vulnerabilities information.</li> <li>CustomQueries: A list of common queries that reflect the network dimension, if it is integrated into the dataset.</li> <li>VulnerabilitiesDataImport: Parse Vulnerability Scanners reports and enrich host nodes with information about unpatched vulnerabilities</li> </ul> </li> <li> <p>FoxTerrier : On the trail of vulnerable Active Directory objects and a report. You use Sharphound/Bloodhound to collect data/audit your AD and you would like to generate report of vulnerable objects in your AD? You should give a look to FoxTerrier!</p> </li> </ul>"},{"location":"Lateral%20Movement%20and%20AD%20Abuse/AD_abuse/#kerberos-abuse","title":"Kerberos Abuse","text":"<ul> <li>Exploring S4U Kerberos Extensions in Windows Server 2003 Microsoft explanation of S4U.</li> <li>Shadow Credentials: Abusing Key Trust Account Mapping for Account Takeover. Easy and reliable takeover primitive against Users and Computers. Based on Kerberos authentication with PKINIT (public key crypto).</li> <li>Krbrelayup A 30-sec video showing usage of the DavRelayUp tool.</li> <li>Detecting and preventing privilege escalation attacks leveraging Kerberos relaying (KrbRelayUp) Description and recommendations by Microsoft.</li> <li>Kerberosity Killed the Domain: An Offensive Kerberos Overview This article is intended to give an overview of how Kerberos works and some of the more common attacks associated with it.</li> </ul>"},{"location":"Lateral%20Movement%20and%20AD%20Abuse/AD_abuse/#relaying","title":"Relaying","text":"<ul> <li>A guide to relaying credentials everywhere in 2022 </li> <li>How to Exploit Active Directory ACL Attack Paths Through LDAP Relaying Attacks</li> </ul>"},{"location":"Lateral%20Movement%20and%20AD%20Abuse/AD_abuse/#other-ad-attack-paths","title":"Other AD Attack Paths","text":"<ul> <li>Certified Pre-Owned Abusing Actice Directory Certificate Services (8 insecure certificate templates). Accompanied by a +140-pages report including some prevention and detection guidance.</li> <li>Exploiting Outlook CVE-2023-23397 to Relay Credentials Based on a coerced authentication vulnerability of Outlook. It uses PKINIT and credential relay. Nice and focussed video.</li> <li>Dumping Domain Password Hashes (from domain controllers). These hashes are stored in a database file in the domain controller (NTDS.DIT). Step-by-step examples with several software tools (Mimikatz, Empire and others)</li> <li>Active Directory Abuse Primitives and Operation Security: Demo of four different AD attack paths, with considerations about their OPSEC (i.e., ability to remain undetected). Slides and one hour video.</li> <li>ADCS + PetitPotam NTLM Relay: Obtaining krbtgt Hash with Domain Controller Machine Certificate Lab that starts from misconfigured ADCS (which it is by default), to effectively escalate privileges from a low privileged domain user to Domain Admin.</li> </ul>"},{"location":"Lateral%20Movement%20and%20AD%20Abuse/Discovery/","title":"Discovery","text":""},{"location":"Lateral%20Movement%20and%20AD%20Abuse/Discovery/#websites","title":"Websites","text":"<ul> <li>Logsensor Given a list of URLs, it applies a set of heuristics for discovering login panels and/or for attempting SQL injection on POST forms.</li> </ul>"},{"location":"Lateral%20Movement%20and%20AD%20Abuse/Discovery/#windows-domains","title":"Windows Domains","text":""},{"location":"Lateral%20Movement%20and%20AD%20Abuse/Discovery/#enumeration","title":"Enumeration","text":"<p>All the commands below can be downloaded from Github.</p> <ul> <li>Command username-anarchy can be used for constructing lists of potential usernames based on predefined criteria or input files.</li> <li>Command kerbrute takes a list of usernames and checks which of those usernames are valid in a specified domain. It also can perform password stuffing/spraying to the specified domain controller.</li> <li>Command Impacket-GetNPUsers (script GetNPUsers of the Impacket framework) takes a list of usernames, selects those that can be attacked with AS-Rep-Roast and obtain the corresponding domain controller response in a format suitable to John the ripper or Hashcat.</li> <li>Command NTLMRecon takes a DNS domain name as input and looks for NTLM enabled HTTP endpoints in that domain. It returns information describing the AD infrastructure, if some HTTP endpoints indeed exist. A detailed example of usage is given in Password spraying and MFA bypasses in the modern security landscape.</li> </ul>"},{"location":"Lateral%20Movement%20and%20AD%20Abuse/Discovery/#exploration","title":"Exploration","text":"<ul> <li>Snaffler it takes a list of Windows computers from Active Directory as input; it figures out which ones have file shares, and whether you can read them. It also enumerates the files in these shares and searches passwords (that should not be stored there) with some heuristics.</li> <li>Scraping kit Tools for scraping services, domain controllers, Outlook email client based on a provided list of keywords.</li> <li>There\u2019s Something About Service Accounts Discover (SPN scanning) Discover service accounts (user accounts with SPN). Useful for Kerberoasting. Discover probable AD Admin accounts.</li> </ul>"},{"location":"Lateral%20Movement%20and%20AD%20Abuse/Lateral%20Movement/","title":"Lateral Movement","text":""},{"location":"Lateral%20Movement%20and%20AD%20Abuse/Lateral%20Movement/#logon-types","title":"Logon types","text":"<ul> <li>Administrative tools and logon types A nightmare of variant and details. Practically important for understanding which network operations leave credentials in memory of the remote node.</li> </ul>"},{"location":"Lateral%20Movement%20and%20AD%20Abuse/Lateral%20Movement/#offensive-lateral-movement","title":"Offensive Lateral Movement","text":"<ul> <li>Offensive Lateral Movement The difficulty with lateral movement is doing it with good operational security (OpSec) which means generating the least amount of logs as possible, or generating logs that look normal, i.e. hiding in plain sight to avoid detection. The purpose of this blog post is to not only show the techniques, but to show what is happening under the hood and any high-level indicators associated with them.</li> <li>The L in Linux Stands for Lateral Movement Only one protocol comes to mind \u2014 SSH. In this blog post, we\u2019ll look at other protocols in Linux that can be used to achieve (or to help achieve) lateral movement.</li> </ul>"},{"location":"Lateral%20Movement%20and%20AD%20Abuse/Lateral%20Movement/#lab-examples","title":"Lab Examples","text":"<p>Fantastic resources with many attacks explained with clear step-by-step instructions.</p> <ul> <li>Red Team Notes A collection of techniques that exploit and abuse Active Directory, Kerberos authentication, Domain Controllers and similar matters.<ul> <li>Unconstrained delegation </li> <li>Constrained delegation </li> <li>Resource-based constrained delegation (RBCD)</li> <li>Kerberoasting </li> <li>AS-Rep Roasting </li> <li>Golden Tickets </li> <li>Silver Tickets </li> <li>and more</li> </ul> </li> <li>GOAD - Go Active Directory It would be nice to have time and skills for setting up their (free) lab, but it is too complex. Reading their numerous examples is very useful, though, in particular:<ul> <li>Delegations</li> <li>ACL based on BloodHound</li> <li>Lateral Movement</li> </ul> </li> <li>Hack The Box - Absolute Writeup (i.e., written summary) of how to get Administrator access on a virtual machine named Absolute (available on Hack The Box). Based on Kerberos abuse, showing both KrbRelay to add a user to the administrators group, and KrbRelayUp to get the machine account hash and do a DC sync attack.</li> </ul>"},{"location":"Lateral%20Movement%20and%20AD%20Abuse/Lateral%20Movement/#offensive-tools","title":"Offensive tools","text":"<ul> <li>Rubeus Ticket requests and renewals; Ticket Forgery; Ticket Management; Ticket Extraction and Harvesting; Brute force and spray; Constrained delegation abuse; Roasting; S4U.</li> <li>CrackMapExec (a.k.a CME) is a post-exploitation tool that helps automate assessing the security of large Active Directory networks. Built with stealth in mind, CME follows the concept of \"Living off the Land\": abusing built-in Active Directory features/protocols to achieve its functionality and allowing it to evade most endpoint protection/IDS/IPS solutions. CME makes heavy use of the Impacket library for working with network protocols and performing a variety of post-exploitation techniques.</li> <li>Certipy Offensive tool for enumerating and abusing Active Directory Certificate Services (AD CS).</li> <li>Mimikatz The father of modern Windows attacks. Many tutorials out there, including this one.</li> </ul>"},{"location":"MITRE%20ATTACK/ATTACK%20-%20MITRE/","title":"MITRE ATT&amp;CK","text":""},{"location":"MITRE%20ATTACK/ATTACK%20-%20MITRE/#framework-description","title":"Framework description","text":"<ul> <li>MITRE ATT&amp;CK Enterprise Matrix. Official database.</li> <li> <p>ATT&amp;CK Navigator Web-based tool for annotating and exploring ATT&amp;CK matrices. It can be used to visualize defensive coverage, red/blue team planning, the frequency of detected techniques, and more. Linked to the official database (but search results for Threat Groups, Software etc are not perfectly aligned with those on the official site). Video tutorial. See also my lab notes.</p> </li> <li> <p>Very nice (unofficial) dashboard for easier and better navigation.</p> </li> <li>TOP ATT&amp;CK TECHNIQUES for Ransomware and Calculator for your environment: a starting point for prioritizing defense when planning to defend against ransomware attacks. Methodology explained in Where to begin? Prioritizing ATT&amp;CK Techniques.</li> </ul>"},{"location":"MITRE%20ATTACK/ATTACK%20-%20MITRE/#statistics","title":"Statistics","text":"<ul> <li>European Repository of Cyber Incidents (EuRepoC) Daily updated database of cyber incidents worldwide.</li> <li>CISA Risk and Vulnerability Assessments CISA analyzes and maps, to the MITRE ATT&amp;CK framework, the findings from the Risk and Vulnerability Assessments (RVA) we conduct each year.  Infographics break out the most successful techniques for each tactic and includes the success rate percentage for each tactic and technique. </li> <li>2022 Year in Review - DFIR Report Intrusion statistics aligned to the MITRE ATT&amp;CK framework.</li> </ul>"},{"location":"MITRE%20ATTACK/ATTACK%20-%20MITRE/#alerts-examples","title":"Alerts examples","text":"<p>Most alerts of important threats reference the MITRE ATT&amp;CK tactics and techniques.</p> <ul> <li>Cuba Ransomware (see Table 6). The FBI and the Cybersecurity and Infrastructure Security Agency (CISA) are releasing this joint CSA to disseminate known Cuba ransomware IOCs and TTPs associated with Cuba ransomware actors</li> <li>Understanding Ransomware Threat Actors: LockBit In 2022, LockBit was the most deployed ransomware variant across the world and continues to be prolific in 2023. Due to the large number of unconnected affiliates in the operation, LockBit ransomware attacks vary significantly in observed tactics, techniques, and procedures (TTPs).</li> </ul>"},{"location":"MITRE%20ATTACK/ATTACK%20-%20MITRE/#tools-based-on-mitre-attck","title":"Tools based on MITRE ATT&amp;CK","text":"<p>Many tools and projects build on the MITRE ATT&amp;CK framework. Just a few examples.</p> <ul> <li>DeTT&amp;CT aims to assist blue teams in using ATT&amp;CK to score and compare data log source quality, visibility coverage, detection coverage and threat actor behaviours.</li> <li>An excel-centric approach for managing the MITRE ATT&amp;CK tactics and techniques A simple and portable way to get a sort of awareness about which attackers' tactics/techniques a customer is able to detect and, more important, what is missing.</li> <li>Emulation libraries. Library of adversary emulation plans to allow organizations to evaluate their defensive capabilities against the real-world threats they face.</li> </ul>"},{"location":"MITRE%20ATTACK/ICS/","title":"ICS - Industrial Control Systems","text":"<ul> <li>Industrial Control Systems: Engineering Foundations and Cyber-Physical Attack Lifecycle A technical white paper that provides an introduction to cyber-physical security science and the art of cyber-physical attacks from the adversarial perspective. The major objective of the white paper is to give the readers comprehensive yet sufficiently concise (90 pages!) background on the engineering foundations of industrial control systems and their security requirements as well as to introduce the cyber-physical attack lifecycle.</li> <li>What is OT malware? The purpose of OT malware can range from modifying how an industrial process operates, through to disruptive or destructive attacks </li> <li>Guide to Operational Technology (OT) Security - NIST</li> </ul>"},{"location":"MITRE%20ATTACK/ICS/#case-studies","title":"Case studies","text":"<ul> <li>Deep Dive Into PIPEDREAM\u2019s OPC UA Module, MOUSEHOLE Very interesting because it describes the role of the Open Platform Communications Unified Architecture (OPC UA). Simply put, OPC UA is an industrial and Internet of things (IoT) communication standard and can directly impact how critical systems function.  </li> <li>INCONTROLLER: New State-Sponsored Cyber Attack Tools Target Multiple Industrial Control Systems</li> <li>TRITON Actor TTP Profile, Custom Attack Tools, Detections, and ATT&amp;CK Mapping</li> <li>APT Cyber Tools Targeting ICS/SCADA Devices (Alert AA22-103A) Cybersecurity and Infrastructure Security Agency (CISA) Advisory.</li> </ul>"},{"location":"Malware/Basic%20Malware%20Concepts/","title":"Basic Malware Concepts","text":"<p>Some of these \"concepts\" can be mapped more or less easily on MITRE ATT&amp;CK; some other \"concepts\" are much harder to map (and maybe such a mapping is not even useful). </p>"},{"location":"Malware/Basic%20Malware%20Concepts/#shellcodes","title":"Shellcodes","text":"<p>This is roughly related to the Execution Tactic. </p> <ul> <li>Wikipedia has a nice description of shellcodes (i.e., first-stage malware).</li> <li>msfvenom is a payload generator (part of Metasploit) for writing shellcodes in a specified format, given an input program. Another example of usage below in this page</li> </ul>"},{"location":"Malware/Basic%20Malware%20Concepts/#reverse-shells","title":"Reverse shells","text":"<p>This is a \"thing\" not mapped easily on MITRE ATT&amp;CK Techniques.</p> <ul> <li>Reverse Shell Cheat Sheet: PHP, Python, Powershell, Bash, NC (netcat), JSP, Java, Perl collection of Windows and Linux reverse shells that use commonly installed programming languages. </li> </ul>"},{"location":"Malware/Basic%20Malware%20Concepts/#web-shells","title":"Web shells","text":"<p>This is a technique mapped in MITRE ATT&amp;CK as Persistence (sub-technique of Server Software Component).</p> <ul> <li>Build A Simple Web shell (PHP)</li> <li>Breaking Down the China Chopper Web Shell Part I and Part II. This web shell is one of those included in the Joint report on publicly available hacking tools mentioned above.</li> </ul> <p>Some of the many alerts about web shell implants.</p> <ul> <li>Threat Actors Exploiting Citrix CVE-2023-3519 to Implant Webshells An alert by CISA to notify of the explolitation of a certain unauthenticated remote code execution (RCE) vulnerability to drop a webshell in critical infrastructure organizations.</li> <li>Tomcat Under Attack: Exploring Mirai Malware and Beyond Not particularly sophisticated and much less relevant and surprising than claimed in the post...just a few hundreds web shells planted by using default Tomcat credentials. Nice to read and well written, though. </li> </ul>"},{"location":"Malware/Basic%20Malware%20Concepts/#persistence-windows","title":"Persistence - Windows","text":"<ul> <li>PERSISTENCE A list of 39 (thirty nine) different techniques for obtaining Persistence in Windows.</li> </ul>"},{"location":"Malware/Basic%20Malware%20Concepts/#privilege-escalation-linux","title":"Privilege Escalation - Linux","text":"<ul> <li>Part 1 and Part 2.</li> <li>CVE-2021-4034 A local privilege escalation vulnerability was found on polkit\u2019s pkexec utility. The pkexec application is a setuid tool designed to allow unprivileged users to run commands as privileged users according predefined policies. The current version of pkexec doesn\u2019t handle the calling parameters count correctly and ends trying to execute environment variables as commands. An attacker can leverage this by crafting environment variables in such a way it\u2019ll induce pkexec to execute arbitrary code. When successfully executed the attack can cause a local privilege escalation given unprivileged users administrative rights on the target machine.</li> </ul>"},{"location":"Malware/Basic%20Malware%20Concepts/#dll-abuse","title":"DLL Abuse","text":"<p>This is a \"thing\" not mapped easily on MITRE ATT&amp;CK techniques (it corresponds to several of them).</p> <ul> <li> <p>Dynamic-link libraries (DLLs) are code modules that contain sets of functions that other executables can call. Unlike statically linked libraries, which become part of an executable during the compilation process, DLLs can live on their own outside of the application that uses them. There are two ways to perform linking with DLLs: </p> <ul> <li>In implicit linking, during the compilation phase, the application links with an import library file provided by the developer of the DLL. When the application is loaded, the Windows loader will identify that there is a dynamically linked reference and load the DLL into the application\u2019s address space.</li> <li>explicit linking involves the application loading the DLL with the use of the LoadLibrary function, and resolving pointers to functions that it would like to call by calling GetProcAddress.</li> </ul> </li> <li> <p>DLL Injection: Background &amp; DLL Proxying. The first of a 5-part and in-depth analysis of DLL injection in Windows. Next parts are: Windows Hooks, Remote Threads, Thread Context Hijacking, Manual Mapping. </p> </li> </ul>"},{"location":"Malware/Basic%20Malware%20Concepts/#examples","title":"Examples","text":"<ul> <li>Technical Advisory: Vulnerabilities Identified within ListServ ListServ is a widely used email list management application. In October 2023 a DLL hijacking vulnerability was identified (section \"Local Privilege Escalation via DLL Hijacking\"). </li> <li>Writeup of hacking a vulnerable machine called Bruno in VulnLab. One the steps (SampleScanner APP) is based on a form of DLL hijacking. A malicious DLL is written in a folder determined with process monitor and dnspy. Actual writing occurs with a path traversal in unzipping.</li> </ul>"},{"location":"Malware/Basic%20Malware%20Concepts/#tools","title":"Tools","text":"<ul> <li>A listing of the DLLs loaded by an executable can be obtained with Process Monitor from sysinternals.</li> <li>Decompilation of a specified DLL (in order to see which files are possibly loaded by that DLL from which directory) can be done with dnspy. This conversation with ChatGPT colink explains how to use DNSpy for DLL analysis.</li> <li>List of DLL Hijacking candidates: A mapping between DLLs and vulnerable executables is kept and can be searched via this website. For defenders, this project can provide valuable information when trying to detect DLL Hijacking attempts.</li> </ul>"},{"location":"Malware/Initial%20Access/","title":"Initial Access","text":""},{"location":"Malware/Initial%20Access/#phishing","title":"Phishing","text":"<p>Just two resources (I am not even trying to provide a link to relevant incidents; I would not know where to start):</p> <ul> <li>Internet Crime Complaint Center (IC3) - FBI Have a look at the annual reports: which is the most prevalent crime type by victim count?</li> <li>\"phishing\" search on Computers and Security This is a prestigious scientific journal. The list of papers published in the last year suffices to realize that there is still a lot of ongoing research on this seemingly irrelevant topic. Full text available only from internal UniTS network.</li> </ul>"},{"location":"Malware/Initial%20Access/#case-studies","title":"Case Studies","text":"<p>The MITRE ATT&amp;CK website contains a number of real cases where each technique has been used. The examples listed here are just a bunch of further examples, particularly interesting because they illustrate all the intrusion steps that followed Initial Access.</p> <ul> <li>Exploit Public-Facing Application: Threat Actors Exploiting Citrix CVE-2023-3519 to Implant Webshells</li> <li>Valid Accounts: Threat Actor Leverages Compromised Account of Former Employee to Access State Government Organization</li> <li>Supply Chain Compromise: Compromise Software Supply Chain: Advanced Persistent Threat Compromise of Government Agencies, Critical Infrastructure, and Private Sector Organizations (this was a huge incident; search for \"SolarWinds\" in the search box above).</li> </ul>"},{"location":"Malware/Initial%20Access/#appendix-secure-email-spf-dkim-dmarc","title":"Appendix: Secure email (SPF, DKIM, DMARC)","text":"<ul> <li>Tackling Email Spoofing and Phishing High-level description, by Cloudflare.</li> <li>Trustworthy Email Technical guide by NIST. In-depth explanation.</li> </ul>"},{"location":"Malware/Malware%20detection/","title":"Malware detection","text":""},{"location":"Malware/Malware%20detection/#malware-analysis-platforms","title":"Malware analysis platforms","text":"<ul> <li>Triage Analyze malware samples free. A state-of-the\u2013art malware analysis sandbox, with all the features you need. This is an example analysis of cryptominer for Linux (see Automated Malware Analysis for an introduction to the Triage platform).</li> <li>Any.run Interactive malware analysis.</li> <li>Virustotal Analyse suspicious files, domains, IPs and URLs.</li> <li>MobSF Specialized for mobile apps. Still in beta (Github repo). </li> <li>A Beginner\u2019s Guide to Tracking Malware Infrastructure A blog post describing how to use Censys for that purpose (Censys is not a malware analysis platform; it is an \"exposure search engine\" similar to Shodan; this blog post illustrates very basic Censys queries that can be useful for tracking malware infrastructure; I think similar techniques can be applied to Shodan as well). </li> <li>Malpulse A simple platform that keeps track of IP addresses associated with C&amp;C infrastructures.</li> </ul>"},{"location":"Malware/Malware%20detection/#threat-intelligence","title":"Threat Intelligence","text":""},{"location":"Malware/Malware%20detection/#indicators-of-compromise-ioc","title":"Indicators of Compromise (IoC)","text":"<ul> <li>Indicators of Compromise (IoCs) and Their Role in Attack Defence (RFC 9424) An excellent description of what IoCs are and how they can be used.</li> </ul>"},{"location":"Malware/Malware%20detection/#public-repositories-and-feeds","title":"Public repositories and feeds","text":"<ul> <li>MalwareBazaar sharing malware samples with the infosec community, AV vendors and threat intelligence providers.</li> <li>Alienvault The World\u2019s First Truly Open Threat Intelligence Community (IoC, Malware families and other).</li> <li>Greynoise We collect, analyze, and label data on IPs that scan the internet and saturate security tools with noise. This unique perspective helps analysts spend less time on irrelevant or harmless activity, and more time on targeted and emerging threats.</li> <li>VirusTotal Intelligence VirusTotal Intelligence allows you to search through our dataset in order to identify files that match certain criteria (hash, antivirus detections, metadata, submission file names, file format structural properties, file size, etc.). We could say that it is pretty much like the \"Google\" of malware.</li> </ul>"},{"location":"Malware/Malware%20detection/#programmatic-tools","title":"Programmatic tools","text":"<ul> <li>YARA documentation</li> <li>Awesome YARA A curated list of awesome YARA rules, tools, and resources. </li> <li>STIX and TAXII Sharing threat intelligence</li> <li>A conversation with ChatGPT that may be useful as a broad overview.</li> </ul>"},{"location":"Malware/Malware%20detection/#analyses","title":"Analyses","text":"<p>Scientific papers that assess usage and effectiveness of threat intelligence services (with video of the conference presentations):</p> <ul> <li>Reading the Tea leaves: A Comparative Analysis of Threat Intelligence </li> <li>A different cup of TI? The added value of commercial threat intelligence USENIX Security 2020</li> </ul>"},{"location":"Malware/Malware%20detection/#av-edr-antivirus-endpoint-detection-and-response","title":"AV / EDR (Antivirus / Endpoint Detection and Response)","text":"<ul> <li>AntiViruses under the microscope: A hands-on perspective Computers &amp; Security, January 2022. Everything you wanted to know about antiviruses. An excellent analysis of commercial antiviruses (68 pages: quite complex). Available only from UniTS internal network.</li> <li>All You Always Wanted To Know About AntiViruses A 35-minutes video by one of the authors of the above paper (slides). Very useful and interesting.</li> <li>A conversation with ChatGPT that provides a general overview of the two behavioral detections mentioned in the slides (reflective DLL injection and process hollowing).</li> </ul>"},{"location":"Malware/Malware%20detection/#appendix-evasion","title":"Appendix: Evasion","text":"<p>This is out of scope (not discussed in the course) but may be interesting.</p> <ul> <li>Avoiding Detection with Shellcode Mutator A tool that mutates exploit source code without affecting its functionality, changing its signature and making it harder to reliably detect as malicious.</li> <li>Killer: A Tool Created To Evade AVs And EDRs Or Security Tools</li> <li>List of techniques for bypassing AV and EDR, with a nice graphic.</li> <li>Let's create an EDR and bypass it.</li> <li>Meterpreter vs Modern EDR(s) describes experiments for injecting payloads with Meterpreter while bypassing EDR (Endpoint Detection and Response: the modern term for indicating an \"Antivirus\"). Section \"Meterpreter Reference Dropper\" contains an example of usage of msfvenom.</li> </ul>"},{"location":"Malware/Malware_Case_Studies/","title":"Intrusions and Malware - Case studies","text":"<p>This topic would deserve a full encyclopedia and is close to impossible to maintain. Just very few examples below, selected mainly for the clarity of description.</p> <p>Almost every article indicated below include IoC (indicators of compromise) and TTP (techniques, tactics and procedures described in terms of MITRE ATT&amp;CK).</p>"},{"location":"Malware/Malware_Case_Studies/#ransomware","title":"Ransomware","text":"<ul> <li>The five-day job: A BlackByte ransomware intrusion case study We found that the threat actor progressed through the full attack chain, from initial access to impact, in less than five days, causing significant business disruption for the victim organization (Microsoft).</li> <li>Black Basta Ransomware | Attacks Deploy Custom EDR Evasion Tools Tied to FIN7 Threat Actor</li> <li>Clop We take a closer look at the operations of Clop, a prolific ransomware family that has gained notoriety for its high-profile attacks. We review this ransomware group\u2019s constantly changing schemes and infection chains.</li> <li>IcedID Macro Ends in Nokoyawa Ransomware An incident taking place during Q4 of 2022 consisting of threat actors targeting Italian organizations with Excel maldocs that deploy IcedID.</li> <li>REvil/Sodinokibi Ransomware. The REvil (also known as Sodinokibi) ransomware was first identified on April 17, 2019. It is used by the financially motivated GOLD SOUTHFIELD threat group, which distributes ransomware via exploit kits, scan-and-exploit techniques, RDP servers, and backdoored software installers. The ransomware group REvil was itself hacked and forced offline by a multi-country operation (see Governments turn tables on ransomware gang REvil by pushing it offline) .</li> </ul>"},{"location":"Malware/Malware_Case_Studies/#exfiltration","title":"Exfiltration","text":"<ul> <li>Public Opinion Survey Results: You\u2019re Pwned I observed an intrusion that originated from the direct distribution of a Cobalt Strike beacon via phishing email. Although I have seen phishing campaigns delivering Cobalt Strike directly in the past, they are generally not as common. This short blog will highlight the hands-on-keyboard activity of the threat actors five hours after the initial infection.</li> <li>A glimpse into the shadowy realm of a Chinese APT: detailed analysis of a ShadowPad intrusion This post explores some of the TTPs employed by a threat actor who was observed deploying ShadowPad during an incident response engagement. ShadowPad is a modular remote access trojan (RAT) which is thought to be used almost exclusively by China-Based threat actors.</li> <li>A Truly Graceful Wipe Out In this intrusion, dated May 2023, we observed Truebot. Exfiltration of data and the deployment of the MBR Killer wiper. The threat actors deployed the wiper within 29 hours of initial access.</li> </ul>"},{"location":"Malware/Malware_Case_Studies/#command-and-control-cc","title":"Command and Control (C&amp;C)","text":"<ul> <li>Joint report on publicly available hacking tools Research provided by the cyber security authorities of five nations: Australia, Canada, New Zealand, the UK and USA (the so called \"five eyes\"). It mentions HTRAN \"a tool that proxies connections through intermediate hops and aids users in disguising their true geographical location\" (HTRAN sources on Github).</li> </ul>"},{"location":"Malware/Malware_Case_Studies/#initial-access-backdoor-or-vulnerability","title":"Initial Access: Backdoor or Vulnerability?","text":"<ul> <li>CVE-2021-44529 A code injection vulnerability in the Ivanti EPM Cloud Services Appliance (CSA) allows an unauthenticated user to execute arbitrary code with limited permissions. \"why this is added to the code? It is a left-over from testing or more likely, a backdoor to get access to the appliances? I do know the answer...\". If it is a backdoor, its usage would correspond to \"Supply chain compromise\" in MITRE ATT&amp;CK; if it is a vulnerability, its usage would instead correspond to \"Exploit Public-Facing Application\". The author of that analysis seems to believe it is a backdoor. Very interesting from a technical point of view (PHP commands encoded in cookie values).</li> </ul>"},{"location":"Malware/Malware_Case_Studies/#botnets","title":"Botnets","text":"<ul> <li>Keeping Up with the Emotets: Tracking a Multi-Infrastructure Botnet Emotet is arguably one of the most notorious advanced persistent threats. Fantastic analysis.</li> <li>Understanding the Mirai Botnet The Mirai botnet, composed primarily of embedded and IoT devices, took the Internet by storm in late 2016 when it overwhelmed several high-profile targets with massive distributed denial-of-service (DDoS) attacks. Still an active menace in 2023:  Mirai botnet loves exploiting your unpatched TP-Link routers, CISA warns.</li> <li>Analysis of a Botnet Takeover  A fascinating in-depth description of a botnet takeover: for 10 days, a group of researchers managed to take control of Torpig, one of the early large scale botnets. </li> <li>Top Zeus Botnet Suspect \u201cTank\u201d Arrested in Geneva The \"author note\" at the end is quite interesting from an economic point of view: it makes it evident why ransomware is a much more attractive business model for criminals than bot rentals and alike.</li> <li>Botnet of Thousands of MikroTik Routers Abused in Glupteba, TrickBot Campaigns Just one of the many botnets still out there.</li> <li>FBI-led Operation Duck Hunt shoots down Qakbot In August 2023, an operation led by the FBI and that involved six more countries led to dismantling Qakbot, a botnet and malware loader responsible for more than $8.6 million losses (more than 700.000 infected computers worldwide). </li> <li> <ul> <li>Deobfuscating Emotet v4 Downloader This is a tutorial on the usage of Cyberchef as a support for infosec analyses. The \"medium\" example illustrates in detail the deobfuscation of a Powershell command hidden within a Microsoft Word macro. The corresponding Microsoft Word document was sent as an email attachment in Emotet campaigns.</li> </ul> </li> </ul>"},{"location":"Malware/Malware_Case_Studies/#clickjacking","title":"Clickjacking","text":"<p>A very lucrative usage of botnets is clickjacking, i.e., fraudulent clicks by bots on ads published by criminals. At 10 cents per click, it is easy to imagine the amount of money involved in this kind of frauds. Botnets specialized on this activity are thus particularly sophisticated.  </p> <ul> <li>How 3ve\u2019s BGP hijackers eluded the Internet\u2014and made $29M Perhaps the most sophisticated botnet ever developed.</li> <li>The Hunt for 3ve&gt; Taking down a major ad fraud operation through industry collaboration The full technical report. Have a look at the infohgraphic on one of the first pages to have an idea of its size.</li> <li>The ZeroAccess Auto-Clicking and Search-Hijacking Click Fraud Modules An older yet very sophisticated and dangerous botnet specialized in clickjacking.</li> <li>Operation: Disruption of the ZeroAccess botnet A short summary by the United Nations Office on Drugs and Crime summarizing the (partly) successful efforts for disrupting the ZeroAccess botnet.</li> </ul>"},{"location":"Memory%20Corruption/Memory%20Corruption%20-%20Case%20studies/","title":"Memory corruption - Case studies","text":""},{"location":"Memory%20Corruption/Memory%20Corruption%20-%20Case%20studies/#very-high-profile-example","title":"Very high-profile example","text":"<p>Chaining of several vulnerabilities, circumvention of hardware mitigations (including pointer authentication). Many people believe these shouyld be attributed to the NSA; some believe that Apple somehow helped them. I do not have any element in support.</p> <ul> <li>New iPhone Exploit Uses Four Zero-Days Kaspersky researchers are detailing \u201can attack that over four years backdoored dozens if not thousands of iPhones, many of which belonged to employees of Moscow-based security firm Kaspersky.\u201d It\u2019s a zero-click exploit that makes use of four iPhone zero-days.</li> <li>4-year campaign backdoored iPhones using possibly the most advanced exploit ever.</li> </ul>"},{"location":"Memory%20Corruption/Memory%20Corruption%20-%20Case%20studies/#not-very-difficult-to-understand","title":"Not very difficult to understand","text":"<ul> <li>Technical Advisory: Vulnerabilities Identified within ListServ ListServ is a widely used email list management application. In October 2023 a stack overflow vulnerability was identified (section \"Stack Based Overflow Vulnerability\"). Easy to understand but hardly exploitable.</li> <li>Citrix Bleed: Leaking Session Tokens with CVE-2023-4966 Citrix NetScaler is a network device providing load balancing, firewall and VPN services. A buffer overflow in a variable filled with the <code>Host</code> header of a received HTTP request (thus a variable indirectly controlled by the attacker) allow dumping portions of memory in the matching HTTP response, including currently valid session cookies. </li> </ul>"},{"location":"Memory%20Corruption/Memory%20Corruption%20-%20Case%20studies/#more-difficult-to-understand","title":"More difficult to understand","text":"<p>Understanding all the details in the following analyses is difficult and often some details are not reported. In particular, the steps for obtaining RCE from the overflow are rarely shown (the descriptions only illustrate the overflow).</p> <ul> <li>CVE-2021-3156: Heap-Based Buffer Overflow in Sudo (Baron Samedit) Heap-based buffer overflow in sudo, a near-ubiquitous utility available on major Unix-like operating systems. Any unprivileged user can gain root privileges on a vulnerable host using a default sudo configuration. The vulnerability itself has been hiding in plain sight for nearly 10 years. It was introduced in July 2011.</li> <li>TALOS-2023-1734 Microsoft Office Excel WebCharts out-of-bounds write vulnerability  An access violation vulnerability exists in the WebCharts functionality of Microsoft Office Excel 2019 Plus version 2302 build 16130.20332. A specially crafted malformed file can lead to a heap buffer overflow. An attacker can use arbitrary code execution to trigger this vulnerability.</li> <li>Akamai 2023 - Exploring Three Remote Code Execution Vulnerabilities in RPC Runtime Important vulnerabilities in Microsoft Windows RPC runtime that can lead to remote code execution. Since the RPC runtime library is loaded into all RPC servers, and these are commonly used by Windows services, all Windows versions (Desktop and Server) are affected. The vulnerabilities are integer overflows in three data structures used by the RPC runtime.</li> <li>The Equation Group's Firewall Exploit Chain In August 2016 a near-complete exploit kit targeting all major firewall manufacturers (including CISCO ASA) was released by a group known as the ShadowBrokers. This exploit kit has been widely attributed as belonging to a group in the NSA known as the Tailored Access Operations Unit (also commonly referred to as \"The Equation Group\u201d). Description of an exploit chain consisting of 6 elements: the two first steps exploit a buffer overflow; the other steps do not exploit any vulnerability: secondary stage loading, persistence, C&amp;C.</li> <li>A short video explaining at a very high level the Heartbleed vulnerability in OpenSSL. This is an old vulnerability in OpenSSL that affected a lot of web servers around the world (many HTTPS servers use OpenSSL). It allowed stealing the private key of a web server, as well as username and passwords of users currently logged in, from a remote location. The slides on Heartbleed on this page describe the code problem in detail.</li> </ul>"},{"location":"Memory%20Corruption/Resources%20-%20Memory%20corruption_/","title":"Memory Corruption","text":""},{"location":"Memory%20Corruption/Resources%20-%20Memory%20corruption_/#general-considerations","title":"General considerations","text":""},{"location":"Memory%20Corruption/Resources%20-%20Memory%20corruption_/#abandon-c-and-c","title":"Abandon C and C++!","text":"<ul> <li>The Urgent Need for Memory Safety in Software Products by CISA (September 2023). \"In what other industry would the market tolerate such well-understood and severe dangers for users of products for decades?\"</li> <li>The Case for Memory Safe Roadmaps   (Why Both C-Suite Executives and Technical Experts  Need to Take Memory Safe Coding Seriously) by CISA, NSA, FBI, Cybersecurity agencies of several countries (December 2023). An excellent technical summary.</li> <li>Future Software Should Be Memory Safe Office of the National Cyberdirector - The White House (February 2024). Just to emphasize the relevance of this issue.</li> <li>Secure by Design: Google\u2019s Perspective on Memory Safety (March 2024) Very interesting. It describes memory safety issues in a rigorous and systematic way. Furthermore, since \"we will likely be operating a very substantial  C++ codebase for quite some time\", it also describes the Google strategy for coping with this very difficult problem in the next years.</li> </ul>"},{"location":"Memory%20Corruption/Resources%20-%20Memory%20corruption_/#statistics","title":"Statistics","text":"<ul> <li>Introduction to Memory Unsafety for VPs of Engineering Links to statistics for different platforms and for 0-days.</li> <li>Trends, challenge, and shifts in software vulnerability mitigation Microsoft presentation at BlueHat 2019. Very interesting data and statistics over a decade.</li> <li>Memory Safety in Chromium More than 70% of \"serious security bugs\" are memory safety problems.</li> <li>USENIX Enigma 2021 - Quantifying Memory Unsafety and Reactions to It Interesting statistics on the prevalence of memory safety vulns across all vulns in different platforms (including 0days),</li> <li>Memory Safe Languages in Android 13 Android 13 is the first Android release where a majority of new code added to the release is in a memory safe language. While correlation doesn\u2019t necessarily mean causation, it\u2019s interesting to note that the percent of vulnerabilities caused by memory safety issues seems to correlate rather closely with the development language that\u2019s used for new code. To date (1/12/2022), there have been zero memory safety vulnerabilities discovered in Android\u2019s Rust code.</li> <li>Secure by Design: Google\u2019s Perspective on Memory Safety (March 2024, mentioned above). </li> </ul>"},{"location":"Memory%20Corruption/Resources%20-%20Memory%20corruption_/#technical","title":"Technical","text":""},{"location":"Memory%20Corruption/Resources%20-%20Memory%20corruption_/#memory-management-and-function-calling","title":"Memory management and function calling","text":"<ul> <li>Slides and textbook chapter from Computer Security at Berkeley (CS161)</li> </ul>"},{"location":"Memory%20Corruption/Resources%20-%20Memory%20corruption_/#more-in-depth","title":"More in depth","text":"<ul> <li>Slides and textbook chapter from Computer Security at Berkeley (CS161). Discusses format string and integer conversion vulnerabilities.</li> <li>Slides on memory corruption from Software Security at Radboud University (prof. Erik Poll). Discusses format string and integer conversion vulnerabilities (as well as many subtle C bugs).</li> <li>A short video explaining how to write an exploit for a toy application: a C program (compiled and run without any mitigation) where a password is read with <code>gets()</code>. By overflowing the <code>password</code> variable, execution flow bypass the password check (stack smashing, code reuse; no shellcode is injected). It provides an idea of how to determine the correct address values to overwrite on the return address on the stack. Running this toy example requires disabling stack canary.</li> <li>Handout Slides on Security from Cambridge University (2020-2021). Much material on various topics, including memory safety vulnerabilities examples and mitigations.</li> <li>An Introduction to Exploit Reliability A big consideration when you're writing exploits professionally is exploit reliability: a measure of an exploit's failure rate. If your exploit is 100% reliable, you know it's always going to succeed. If it's 90% reliable, then your exploit will fail in one in ten cases, and so on. Take a look at the CISA KEV database or the CISA/FBI most exploited CVEs list -- most of the issues listed are not memory corruption vulnerabilities. Instead, we commonly see logic issues like command injection, path traversal, and deserialization bugs, all of which typically have extremely high exploit reliability.</li> </ul>"},{"location":"Memory%20Corruption/Resources%20-%20Memory%20corruption_/#some-fundamental-papers","title":"Some fundamental papers","text":"<ul> <li>Smashing the stack for fun and for profit \"the\" reference, written in 1996.</li> <li>Smashing the Stack in the 21st Century A look from 64-bit architectures (not considering mitigations)</li> <li>SoK: Eternal war in memory: a 2014 paper that \"systematizes the current knowledge about various protection techniques by setting up a general model for memory corruption attacks\". Still very interesting (quite complex).</li> <li>ASLR Smack &amp; Laugh Reference: a 2008 paper that discusses many exploitation strategies for circumventing ASLR. Still very interesting (quite complex).</li> </ul>"},{"location":"Memory%20Corruption/Resources%20-%20Memory%20corruption_/#mitigations","title":"Mitigations","text":"<ul> <li>Slides and textbook chapter from Computer Security at Berkeley (CS161). Discusses mitigations and corresponding circumventions (slightly) more in depth than in our lectures (heavily based on these slides, though).</li> <li>Slides on memory corruption from Software Security at Radboud University (prof. Erik Poll). The final part of the slides mentions many more defenses than those in our lectures. Not in depth, but a broad coverage to have an idea.</li> <li>Use compiler flags for stack protection in GCC and Clang. This article discusses the major stack protection mechanisms in the GNU Compiler Collection (GCC) and Clang, typical attack scenarios, and the compiler's attempts to prevent attacks.</li> </ul>"},{"location":"Memory%20Corruption/Resources%20-%20Memory%20corruption_/#software-security","title":"Software security","text":"<ul> <li>The Cyber Security Body Of Knowledge has several high-level documents on many topics in Cybersecurity. Those on \"Software Security\" and on \"Secure Software Lifecycle\" may be interesting.</li> <li>The Software Security course at Radboud University (prof. Erik Poll) has lot of very interesting material.</li> </ul>"},{"location":"Memory%20Corruption/Resources%20-%20Memory%20corruption_/#appendix-reverse-engineering","title":"Appendix - Reverse engineering","text":"<p>This topic is out of scope. These links may be useful for grasping an idea of how to analyze the internals and memory layout of an existing program or device.</p> <ul> <li>A curated list of reverse engineering resources</li> <li>How to Use Ghidra to Reverse Engineer Malware  There are numerous tools freely available to cybersecurity professionals to assist in analyzing malware. Ghidra was first released a couple of years ago and has proved to be relatively popular due to it being a free tool that can be used to disassemble malware. </li> <li>IDA disassembler Many tutorials out there.</li> <li>I Hacked into my Son's Baby Monitor, for Safety Nice video, part of a longer playlist devoted to reverse engineering.</li> <li>Frida Dynamic code instrumentation toolkit. It lets you inject snippets of JavaScript or your own library into native apps on Windows, macOS, GNU/Linux, iOS, watchOS, tvOS, Android, FreeBSD, and QNX. Frida also provides you with some simple tools built on top of the Frida API. These can be used as-is, tweaked to your needs, or serve as examples of how to use the API.</li> </ul>"},{"location":"Passwords%20and%20MFA/MFA/","title":"MFA","text":""},{"location":"Passwords%20and%20MFA/MFA/#why-mfa","title":"Why MFA","text":"<ul> <li>All your creds are belong to us! Analysis of MFA impact on password attacks by Microsoft Threat Intelligence.</li> <li>It's Time to Hang Up on Phone Transports for Authentication Microsoft Threat Intelligence advice: use MFA; do not use smartphones for MFA.</li> <li>Account takeover prevention rate by challenge type. A slide summarizing the (estimated) effectiveness of various MFA techniques (challenge type) as a function of the attack type (automated bot, bulk phishing, targeted). It can be seen that security keys are \"perfect\" even for targeted attacks (i.e., the most sophisticated ones).</li> </ul>"},{"location":"Passwords%20and%20MFA/MFA/#notable-incidents-mostly-due-to-lack-of-mfa","title":"Notable incidents mostly due to lack of MFA","text":"<ul> <li>How 50% of telco Orange Spain\u2019s traffic got hijacked \u2014 a weak password</li> </ul>"},{"location":"Passwords%20and%20MFA/MFA/#mfa-attacks","title":"MFA attacks","text":"<p>Always keep in mind that everything but security keys can be phished (e.g., with specialized proxies like Evilginx).</p> <ul> <li>The Rise of One-Time Password Interception Bots</li> <li>SIM Swap at Krebs on Security</li> <li>Real-World SS7 Attack \u2014 Hackers Are Stealing Money From Bank Accounts SMS redirection in the phone network (SS7 vulnerability).</li> <li>Lapsus$ and SolarWinds hackers both use the same old trick to bypass MFA \"MFA bombing\".</li> <li>3 Examples of Typical Smishing and Vishing Attacks in 2022</li> </ul> <p>Misuse of phone number: - FTC fines Twitter $150M for using 2FA info for targeted advertising</p>"},{"location":"Passwords%20and%20MFA/MFA/#passwordless","title":"Passwordless","text":"<ul> <li>Passwordless login with passkeys at Google. Less technical description: So long passwords, thanks for all the phish.  User experience: Sign in with a passkey instead of a password.</li> <li>Google passkeys are a no-brainer. You\u2019ve turned them on, right?</li> <li>Passwordless authentication options for Azure Active Directory Microsoft scenario (very complex, as always).</li> <li>Passkeys vs Security Keys FAQ by Yubico, manufacturer of security keys.</li> <li>Passkeys.dev Description of passkey support across browsers and operating systems.</li> </ul>"},{"location":"Passwords%20and%20MFA/Passwords/","title":"Passwords","text":""},{"location":"Passwords%20and%20MFA/Passwords/#password-attacks-analyses","title":"Password Attacks - Analyses","text":"<ul> <li>PWDB - New generation of Password Mass-Analysis Interesting facts and statistics from the analysis of hundreds of millions of leaked passwords.</li> <li>Your Pa$$word doesn't matter (2019) An analysis of password attacks observed by Microsoft Threat Intelligence.</li> <li>STRONTIUM: Detecting new patterns in credential harvesting (2023) Rates of spraying observed in this particular campaign (4 per hour and account, each attempt from a different IP address). Microsoft Threat Intelligence.</li> <li>Haveibeenpnwed Free resource for anyone to quickly assess if they may have been put at risk due to an online account of theirs having been compromised or \"pwned\" in a data breach. Highly recommended. </li> </ul>"},{"location":"Passwords%20and%20MFA/Passwords/#password-choice","title":"Password Choice","text":"<ul> <li>Password Best Practice - NIST No complexity, no expiration, use password managers. The original NIST document is here.</li> <li>Password policy: updating your approach - NCSC UK Advice for system owners responsible for determining password policies and identity management within their organisations. </li> <li>Password policy recommendations - Microsoft</li> <li>Trusted by Millions, Yet So Wrong - Password Strength Tools Ever trusted a password strength tool online? You might be surprised to see how far off the mark some of the most popular password strength tools are.</li> </ul>"},{"location":"Passwords%20and%20MFA/Passwords/#password-storage","title":"Password Storage","text":"<ul> <li> <p>14.7. Password hashing from Computer Security at Berkeley (CS161). Everything in this book is more than ok. </p> </li> <li> <p>Salted Password Hashing - Doing it Right</p> </li> <li>Password Storage Cheat Sheet - OWASP This cheat sheet provides guidance on the various areas that need to be considered related to storing passwords.</li> <li>Rainbow tables download Tables of hashed passwords.</li> <li>Cyberchef Online webapp for executing many infosec-related calculations, including bcrypt hashes and NT hashes.</li> </ul>"},{"location":"Passwords%20and%20MFA/Passwords/#benchmarks-cracking-speed","title":"Benchmarks / Cracking speed","text":"<ul> <li>Nvidia RTX4080 FE latest Hashcat benchmark (2023) Includes results for each hashcat benchmark (on this particular hw, 2023).<ul> <li>Decrypting the Selection of Supported Kerberos Encryption Types Decrypting Kerberos RC4 tickets (encryption types 0x17,0x18 dec 23,24) is much faster than decrypting default AES tickets (0x11,0x12 dec 17,18). This is why in roasting attacks RC4 tickets are requested rather than AES tickets. The above benchmark indicates approximately 3 orders of magnitude difference in speed (see \"TGS-REP\").</li> </ul> </li> <li>John the Ripper benchmarks Not easy to interpret and understand.</li> </ul> <p>The resources below estimate the time required for completing a brute force attack over a predefined password space. Always keep in mind that this kind of calculations do not reflect what attackers usually do as a first step, i.e., trying commonly used passwords (see the link on password strength tools above).</p> <ul> <li>Hive Systems Password Table Colorful infographic table (released every year) that showed the relative strength of a hashed password against a cracking attempt, based on:<ul> <li>the password\u2019s length,</li> <li>complexity,</li> <li>hashing algorithm used by the victim,</li> <li>and the hardware used by the attacker.</li> </ul> </li> <li>Password cracking speed (2020)</li> <li>Entropy vs Password length vs Cracking speed</li> <li>Brute force calculator</li> </ul>"},{"location":"Vulnerabilities/Resources%20-%20Vulnerabilities%20Intro/","title":"Vulnerabilities Introduction - Resources","text":""},{"location":"Vulnerabilities/Resources%20-%20Vulnerabilities%20Intro/#cve","title":"CVE","text":""},{"location":"Vulnerabilities/Resources%20-%20Vulnerabilities%20Intro/#catalogs","title":"Catalogs","text":"<ul> <li>NIST NVD National Vulnerability Database, \"the\" reference for CVE.</li> <li>CVEdetails Indexed and browsable in many different ways (by vendor, product and alike).</li> <li>CISA - Industrial Control Systems / Medical Systems Filter the advisories in this page.</li> </ul>"},{"location":"Vulnerabilities/Resources%20-%20Vulnerabilities%20Intro/#statistics-and-analyses","title":"Statistics and Analyses","text":"<ul> <li>2023 CVE Data Review Statistics since year 2000.</li> <li>The Evolving CVE Landscape We examine the universe of vulnerabilities (defined by the CVE) and how it\u2019s changed in the last 20 years.</li> </ul>"},{"location":"Vulnerabilities/Resources%20-%20Vulnerabilities%20Intro/#exploits","title":"Exploits","text":"<ul> <li>ExploitDB A list of public exploits, free to download.</li> <li>CVExploits Search Your comprehensive database for CVE exploits from across the internet.</li> <li>Comprehensive list of all Metasploit Windows exploits that are currently available in the open source version (&gt;1300 exploits). Issued in 2021.</li> <li>Rhino CVE Proof-of-Concept Exploits A collection of proof-of-concept exploit scripts written by the team at Rhino Security Labs for various CVEs. It may be useful for understanding many different kinds of vulnerabilities.</li> <li>CVE-2017-0199 Practical exploitation ! (PoC) File Word that downloads a malware upon opening (shown in the slides).</li> </ul>"},{"location":"Vulnerabilities/Resources%20-%20Vulnerabilities%20Intro/#notable-worms-injection","title":"Notable Worms (Injection)","text":"<p>Malware that propagates automatically over a network by exploiting vulnerabilities with: Impact: Command Execution; Injection: Remote, No user interaction</p> <ul> <li>2017 WannaCry</li> <li>2016-2018 Petya / NotPetya</li> <li>2001 CodeRed</li> <li>2001 Nimda</li> </ul>"},{"location":"Vulnerabilities/Resources%20-%20Vulnerabilities%20Intro/#cwe-cvss","title":"CWE, CVSS","text":"<ul> <li>Common Weakness Enumeration (CWE) is a community-developed list of software and hardware weakness types.</li> <li>Common Vulnerability Scoring System (CVSS) All versions, including description, calculator and faqs. I suggest to have a look at v2 FAQ: an old version but a very useful reading.</li> </ul>"},{"location":"Vulnerabilities/Resources%20-%20Vulnerability%20Management/","title":"Vulnerability Management - Resources","text":""},{"location":"Vulnerabilities/Resources%20-%20Vulnerability%20Management/#vulnerability-lifecycle","title":"Vulnerability Lifecycle","text":"<ul> <li>Vulnerability Disclosure Policy and  A walk through Project Zero metrics (how vendors reacted to vulnerability disclosure by Google Project Zero).</li> <li>Microsoft Security Update Guide List of all vulnerabilities and patches of Microsoft product. By suitable usage of filters in \"Deployments\", one can see how each \"Patch Tuesday\" looks like (e.g., January 2024).</li> <li>PatchaPalooza A comprehensive tool that provides an insightful analysis of Microsoft's monthly security updates (sources on Github).</li> </ul>"},{"location":"Vulnerabilities/Resources%20-%20Vulnerability%20Management/#zero-days","title":"Zero days","text":""},{"location":"Vulnerabilities/Resources%20-%20Vulnerability%20Management/#market-and-researchers","title":"Market and Researchers","text":"<ul> <li>Zerodium (\"WE PAY BIG BOUNTIES\"). From their FAQ: \"Zerodium customers are government institutions (mainly from Europe and North America) in need of advanced zero-day exploits and cybersecurity capabilities\". Think a little about what this really means.</li> <li>Zero Day Initiative (ZDI) buys software vulnerabilities from independent security researchers, and then discloses these vulnerabilities to their original vendors for patching before making such information public. </li> <li>Pwn2Own a computer hacking contest aimed at exploiting widely used software and mobile devices with previously unknown vulnerabilities. Winners receive a cash prize (supported by ZDI).</li> <li>Project Zero is a team of security researchers at Google who study zero-day vulnerabilities in the hardware and software systems that are depended upon by users around the world.</li> </ul>"},{"location":"Vulnerabilities/Resources%20-%20Vulnerability%20Management/#data","title":"Data","text":"<ul> <li>Zero Days, Thousands of Nights: The Life and Times of Zero-Day Vulnerabilities and Their Exploits This report provides findings from real-world zero-day vulnerability and exploit data.</li> <li>0day \"In the Wild\"  We're sharing our tracking spreadsheet for publicly known cases of detected zero-day exploits, in the hope that this can be a useful community resource (by Project Zero team at Google).</li> <li>2022 0-day In-the-Wild Exploitation\u2026so far by Project Zero team at Google.</li> <li>With 0-days hitting Chrome, iOS, and dozens more this month, is no software safe? \"The number of apps being patched for zero-day vulnerabilities has skyrocketed this month...One other thing to remember regarding zero-days: Most of us aren\u2019t likely to be targeted by one. Exploits for this class of vulnerability often cost $1 million or more, and once they\u2019re unleashed on the Internet, it\u2019s generally only a matter of days until they become public knowledge and lose their value. That means zero-days are likely to be used only on a very small base of targets deemed to be high-value, such as government officials, dissidents, large companies, and holders of large amounts of cryptocurrency.\"</li> </ul>"},{"location":"Vulnerabilities/Resources%20-%20Vulnerability%20Management/#outbreaks-exploitation-immediately-after-disclosure","title":"Outbreaks (exploitation immediately after disclosure)","text":"<ul> <li>The Numbers Behind Log4j Vulnerability CVE-2021-44228 Twenty-four hours after the initial outbreak our sensors recorded almost 200,000 attempts of attack across the globe.</li> <li>Approximately 2000 Citrix NetScalers backdoored in mass-exploitation campaign An adversary appears to have exploited CVE-2023-3519 in an automated fashion, placing webshells on vulnerable NetScalers to gain persistent access. The adversary can execute arbitrary commands with this webshell, even when a NetScaler is patched and/or rebooted. At the time of this exploitation campaign, 31127 NetScalers were vulnerable. One month after, 1828 NetScalers remain backdoored even though 1248 of them are patched.</li> <li>CVE-2023-20198 \u2013 Cisco IOS-XE ZeroDay (Censys) On October 16, Cisco released an advisory regarding a critical zero day privilege escalation vulnerability in their IOS XE Web UI software. On October 18th, we have seen an increase in the number of infections from 34,140 to 41,983 hosts.</li> </ul>"},{"location":"Vulnerabilities/Resources%20-%20Vulnerability%20Management/#epss","title":"EPSS","text":"<ul> <li>Exploit Prediction Scoring System (EPSS) is a data-driven effort for estimating the likelihood (probability) that a software vulnerability will be exploited in the wild.</li> <li>Enhancing Vulnerability Prioritization: Data-Driven Exploit Predictions with Community-Driven Insights A scientific paper describing how version 3 was constructed (March 2023). An extremely interesting and useful reading, as well as a brilliant example of how machine learning can be used in practical settings. All the numbers related to Efficiency vs Coverage for exploitation prediction in the lectures have been taken from this work.</li> </ul>"},{"location":"Vulnerabilities/Resources%20-%20Vulnerability%20Management/#exploitation-prediction","title":"Exploitation Prediction","text":"<ul> <li>Prioritization to Prediction Volume 8: Measuring and Minimizing Exploitability (Jan. 2022) We create a simulation that seeks to minimize organizational exploitability under varying scenarios combining vulnerability prioritization strategies and remediation capacity.</li> <li>Prioritization to Prediction, Vol. 9: Role of the CISA-KEV catalog in risk-based vulnerability management (August 2023) Actionable recommendations on integrating the CISA-KEV into risk-based vulnerability management programs.</li> <li>CISA - Known Exploited Vulnerabilities Catalog (KEV). For the benefit of the cybersecurity community and network defenders\u2014and to help every organization better manage vulnerabilities and keep pace with threat activity\u2014CISA maintains the authoritative source of vulnerabilities that have been exploited in the wild. The criteria behind this catalog are described in Reducing the Significant Risk of Known Exploited Vulnerabilities.</li> <li>cvecrowd A nice experiment: it summarizes ongoing discussions on Mastodon about the most recent CVEs (a sort of threat intelligence).</li> </ul>"},{"location":"Vulnerabilities/Resources%20-%20Vulnerability%20Management/#asset-management","title":"Asset management","text":"<ul> <li>Improving Asset Visibility and Vulnerability Detection on Federal Networks Cybersecurity and Infrastructure Security Agency (CISA) Binding Operational Directive.</li> <li>Implementing asset management for good cyber security by the National Cyber Security Centre (NCSC) UK.</li> </ul>"},{"location":"Vulnerabilities/Resources%20-%20Vulnerability%20Management/#software-dependencies","title":"Software Dependencies","text":"<ul> <li>Software Bill of Materials (SBOM) A \u201csoftware bill of materials\u201d (SBOM) has emerged as a key building block in software security and software supply chain risk management. A SBOM is a nested inventory, a list of ingredients that make up software components.</li> </ul>"},{"location":"Vulnerabilities/Resources%20-%20Vulnerability%20Management/#societal-problems","title":"Societal problems","text":"<p>These essays, all by respected technologists or researchers, do an excellent job of highlighting some of the fundamental issues in cybersecurity. I think they are all worth reading for anyone with an interest in technology.</p> <ul> <li>The Internet of (Vulnerable) Things: On Hypponen's Law, Security Engineering, and IoT Legislation Mikko Hypponen, Linus Nyman.</li> <li>Software Liability for Armchair Quarterbacks \"People who have never coded beyond the equivalent level of high-school football nonetheless have strong opinions about how the game of professional software engineering should be played.\", by Robert Graham.</li> <li>Who Pays? Steve Bellovin, University of Columbia (My opinion: When Steve Bellovin speaks or writes, one should only try to listen or read very carefully).</li> <li>Making Security Sustainable Can there be an Internet of durable goods? Ross Anderson, University of Cambridge.</li> <li>IoT Cybersecurity: What's Plan B? by Bruce Schneier.</li> <li>My Password Is \u201cPassword\u201d (first section of a longer newsletter). \"cybersecurity risk is akin to pollution, a cost that the business itself doesn\u2019t fully bear, but that the rest of society does\" by Matt Stoller.</li> <li>Notes from NANOG 89: BGP Error Handling The four last paragraphs give very deep insights. By Geoff Houston, a member of the Internet Hall of Fame.</li> <li>Unsafe at Any CPU Speed: The Designed-in Dangers of Technology and What We Can Do About It Speech by CISA Director Easterly at Carnegie Mellon University (transcript and video).</li> </ul>"},{"location":"Vulnerabilities/Vulnerability%20-%20Case%20studies/","title":"Vulnerabilities - Case Studies","text":""},{"location":"Vulnerabilities/Vulnerability%20-%20Case%20studies/#idor","title":"IDOR","text":"<ul> <li>Preventing Web Application Access Control Abuse (by CISA and other agencies) IDOR vulnerabilities are access control vulnerabilities enabling malicious actors to modify or delete data or access sensitive data by issuing requests to a website or a web application programming interface (API) specifying the user identifier of other, valid users. These requests succeed where there is a failure to perform adequate authentication and authorization checks.</li> <li>Fertility tracker Glow fixes bug that exposed users\u2019 personal data A bug in the online forum for the fertility tracking app Glow exposed the personal data of around 25 million users.</li> </ul>"},{"location":"Vulnerabilities/Vulnerability%20-%20Case%20studies/#ics-iot-medical-and-so-on","title":"ICS / IoT / Medical and so on...","text":"<ul> <li>Web Hackers vs. The Auto Industry: Critical Vulnerabilities in Ferrari, BMW, Rolls Royce, Porsche, and More During our engagement, we found the following vulnerabilities in the companies listed below...</li> <li>Commercial Flights Are Experiencing 'Unthinkable' GPS Attacks and Nobody Knows What to Do New \"spoofing\" attacks resulting in total navigation failure have been occurring above the Middle East for months, which is \"highly significant\" for airline safety.</li> <li>CAN Injection: keyless car theft This is a detective story about how a car was stolen - and how it uncovered an epidemic of high-tech car theft. </li> <li>Hackers can infect network-connected wrenches to install ransomware Researchers identify 23 vulnerabilities, some of which can exploited with no authentication. These vulnerabilities could allow hackers to sabotage or disable a popular line of network-connected wrenches that factories around the world use to assemble sensitive instruments and devices.</li> <li>CISA Advisories: \"health\"</li> </ul>"},{"location":"Vulnerabilities/Vulnerability%20-%20Case%20studies/#more-traditional-application-domains","title":"More traditional application domains","text":""},{"location":"Vulnerabilities/Vulnerability%20-%20Case%20studies/#extreme-networks-aerohive-wireless-ap","title":"Extreme Networks / Aerohive Wireless AP","text":"<p>Buffer overflow whose exploitation requires circumventing ASLR. An excellent description that explains all the steps in a very clear and easy to understand style. - Bee-yond Capacity: Unauthenticated RCE in Extreme Networks/Aerohive Wireless APs - Fully unauthenticated Remote Code Execution (RCE) vulnerability. This blog post details the discovery and exploitation of the vulnerability, which is a buffer overflow in a service. Proof-of-Concept (PoC) available.</p>"},{"location":"Vulnerabilities/Vulnerability%20-%20Case%20studies/#moveit","title":"MOVEit","text":"<p>A service for secure file transfer within large organizations. On May 31, 2023, Progress released a security advisory for their MOVEit Transfer application which detailed a SQL injection leading to remote code execution and urged customers to update to the latest version. The vulnerability, CVE-2023-34362, at the time of release was believed to have been exploited in-the-wild as a 0-day dating back at least 30 days. - Deep Dive and Indicators of Compromise analyzes the vulnerability in detail; it is caused by a set of bugs in the code that parses HTTP requests. - Understanding CVE-2023-34362: A critical MOVEit Transfer vulnerability</p>"},{"location":"Vulnerabilities/Vulnerability%20-%20Case%20studies/#fortinac-secure-network-access-control","title":"FortiNAC (Secure Network Access Control)","text":"<p>FortiNAC is an appliance for protecting networks.</p> <ul> <li>Fortinet FortiNAC CVE-2022-39952 Deep-Dive and IOCs Critical vulnerability CVE-2022-39952 allows an unauthenticated attacker to write arbitrary files on the system and as a result obtain remote code execution in the context of the root user. Description not difficult  to follow and understand. Basically, there is an URL that allows unauthenticated file upload at an arbitrary position in the filesystem. They upload a file that, when written in the filesystem, provokes the definition of a new cron job (launch of a specified process at a specified time) where the job is a reverse shell. \"We first create a zip that contains a file and specify the path we want it extracted. Then, we send the malicious zip file to the vulnerable endpoint in the key field. Within a minute, we get a reverse shell as the root user.\" </li> <li>FortiNAC - Just a few more RCEs Two more vulnerabilities discussed in June 2023. The first of them is easy to follow and understand. Basically, there is an URL that allows unauthenticated upload of an arbitrary JAR file that will be executed automatically (CVE-2023-33299, Untrusted Deserialization). They prepare a JAR with a reverse shell and uploads it at that URL. The other vuln is also interesting and not particularly difficult to understand, but much longer and more tricky to follow (CVE-2023-33300, Command Injection).</li> </ul>"},{"location":"Vulnerabilities/Vulnerability%20-%20Case%20studies/#oauth-in-microsoft-azure","title":"OAuth in Microsoft Azure","text":"<ul> <li>Anyone in the world is able to access your apps AS YOU with MS OAuth if the app is configured to use email as the account identifier (video). Since the email field is arbitrary for Azure AD users, there's nothing stopping an attacker from using their own free Azure tenant to create a user with your email address.</li> <li>Migrate away from using email claims for user identification or authorization Microsoft guidance.</li> </ul>"},{"location":"Vulnerabilities/Vulnerability%20-%20Case%20studies/#java-digital-signatures","title":"Java Digital Signatures","text":"<ul> <li>CVE-2022-21449: Psychic Signatures in Java An ECDSA signature consists of two values, called r and s. To verify an ECDSA signature, the verifier checks an equation involving r, s and a lot of other stuff. The very first check in the ECDSA verification algorithm is to ensure that r and s are both <code>&gt;= 1</code>. They forgot this check, so you could produce a signature value in which they are both 0 and Java would accept it as a valid signature for any message and for any public key. The digital equivalent of a blank ID card.</li> </ul>"}]}